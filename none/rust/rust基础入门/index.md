---
title: rust åŸºç¡€å…¥é—¨
---

## 3.æ•°æ®

### 3.1 å˜é‡ä¸å¯å˜æ€§

- å£°æ˜å˜é‡ä½¿ç”¨ let å…³é”®å­—ã€‚
- é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ˜¯ä¸å¯å˜çš„(immutable)ã€‚
- å£°æ˜å˜é‡æ—¶ï¼Œåœ¨å˜é‡å‰é¢åŠ ä¸Š mutï¼Œå°±å¯ä»¥ä½¿å˜é‡å¯å˜ã€‚

**å˜é‡ä¸å¸¸é‡**

- å¸¸é‡(constant)ï¼Œå¸¸é‡ç»‘å®šä»¥åä¹Ÿæ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯å®ƒä¸ä¸å¯å˜çš„å˜é‡æœ‰å¾ˆå¤šåŒºåˆ«ï¼š
  - ä¸å¯ä»¥ä½¿ç”¨ mutï¼Œå¸¸é‡æ°¸è¿œéƒ½æ˜¯ä¸å¯å˜çš„
  - å£°æ˜å¸¸é‡ä½¿ç”¨ const å…³é”®å­—ï¼Œå®ƒçš„ç±»å‹å¿…é¡»è¢«æ ‡æ³¨
  - å¸¸é‡å¯ä»¥åœ¨ä»»ä½•ä½œç”¨åŸŸå†…åŠè¿›è¡Œå£°æ˜ï¼ŒåŒ…æ‹¬å…¨å±€ä½œç”¨åŸŸ
  - å¸¸é‡åªå¯ä»¥ç»‘å®šåˆ°å¸¸é‡è¡¨è¾¾å¼ï¼Œæ— æ³•ç»‘å®šåˆ°å‡½æ•°çš„è°ƒç”¨ç»“æ„æˆ–åªèƒ½åœ¨è¿è¡Œæ—¶æ‰èƒ½è®¡ç®—å‡ºçš„å€¼
- åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œå¸¸é‡åœ¨å…¶å£°æ˜çš„ä½œç”¨åŸŸå†…ä¸€ç›´æœ‰æ•ˆ
- å‘½åè§„èŒƒï¼šRust é‡Œå¸¸é‡ä½¿ç”¨å…¨å¤§å†™å­—æ¯ï¼Œæ¯ä¸ªå•è¯ä¹‹é—´ç”¨ä¸‹åˆ’çº¿åˆ†å¼€ï¼Œä¾‹å¦‚
  - MAX_POINTS

**éšè—(shadowing)**

- å¯ä»¥ä½¿ç”¨ç›¸åŒçš„åå­—å£°æ˜æ–°çš„å˜é‡ï¼Œæ–°çš„å˜é‡å°±ä¼š shadow(éšè—)ä¹‹å‰å£°æ˜çš„ç›¸åŒå˜é‡
  - åœ¨åç»­çš„ä»£ç ä¸­è¿™ä¸ªå˜é‡åå°±æ˜¯å¿ƒçš„å˜é‡

```rust
fn main(){
  let x = 5;
  let x = x + 1;
  println!("{}",x);// 6
}
```

- shadow å’ŒæŠŠå˜é‡æ ‡è®°ä¸º mut æ˜¯ä¸ä¸€æ ·çš„ï¼š
  - å¦‚æœä¸é€‚ç”¨ let å…³é”®ä¹‹ï¼Œé‚£ä¹ˆé‡æ–°ç»™é mut çš„å˜é‡èµ‹å€¼ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯
  - è€Œä½¿ç”¨ let å£°æ˜çš„åŒåæ–°å˜é‡ï¼Œä¹Ÿæ˜¯ä¸å¯å˜çš„ã€‚
  - ä½¿ç”¨ let å£°æ˜çš„åŒåæ–°å˜é‡ï¼Œå®ƒçš„ç±»å‹å¯ä»¥ä¸ä¹‹å‰ä¸åŒ

```rust
fn main() {
    let spaces = "    ";
    let spaces = spaces.len();
    print!("{}", spaces);
}
```

### 3.2 æ•°æ®ç±»å‹

- æ ‡é‡å’Œå¤åˆç±»å‹
- Rust æ˜¯é™æ€ç¼–è¯‘è¯­è¨€ï¼Œåœ¨ç¼–è¯‘æ—¶å¿…é¡»ç›´åˆ°æ‰€æœ‰å˜é‡çš„ç±»å‹
  - åŸºäºä½¿ç”¨çš„å€¼ï¼Œç¼–è¯‘å™¨é€šå¸¸èƒ½å¤Ÿæ¨æ–­å‡ºå®ƒçš„å…·ä½“ç±»å‹
  - ä½†å¦‚æœå¯èƒ½çš„ç±»å‹æ¯”è¾ƒå¤š(ä¾‹å¦‚æŠŠ String è½¬ä¸ºæ•´æ•°çš„ parse æ–¹æ³•)ï¼Œå°±å¿…é¡»æ·»åŠ ç±»å‹çš„æ ‡æ³¨ï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™
  ```rust
  fn main() {
   // ä¸å†™ u32 ç±»å‹å°±æŠ¥é”™
   let guess: u32 = "42".parse().expect("Not a number");
  }
  ```

**æ ‡é‡ç±»å‹**

- ä¸€ä¸ªå˜é‡ç±»å‹ä»£è¡¨ä¸€ä¸ªå•ä¸ªçš„å€¼
- Rust æœ‰å››ä¸ªä¸»è¦çš„æ ‡é‡ç±»å‹
  - æ•´æ•°ç±»å‹
  - æµ®ç‚¹ç±»å‹
  - å¸ƒå°”ç±»å‹
  - å­—ç¬¦ç±»å‹

**æ•´æ•°ç±»å‹**

- æ•´æ•°ç±»å‹æ²¡æœ‰å°æ•°éƒ¨åˆ†
- ä¾‹å¦‚ u32 å°±æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„æ•´æ•°ç±»å‹ï¼Œå æ® 32 ä½çš„ç©ºé—´
- æ— ç¬¦å·æ•´æ•°ç±»å‹ä»¥ u å¼€å¤´
- æœ‰ç¬¦å·æ•´æ•°ç±»å‹ä»¥ i å¼€å¤´
- Rust çš„æ•´æ•°ç±»å‹ ï¼š8 16 32 64 128 arch(size)
  - æ¯ç§éƒ½åˆ† i å’Œ uï¼Œä»¥åŠå›ºå®šçš„ä½æ•°
  - æœ‰ç¬¦å·èŒƒå›´:
    - -(2^n-1)åˆ° 2^(n-1)-1
  - æ— ç¬¦å·èŒƒå›´ï¼š
    - 0 åˆ° 2^n - 1

**isize å’Œ usize ç±»å‹**

- isize å’Œ usize ç±»å‹çš„ä½æ•°ç”±ç¨‹åºè¿è¡Œçš„è®¡ç®—æœºçš„æ¶æ„æ‰€å†³å®šï¼š
  - å¦‚æœæ˜¯ 64 ä½è®¡ç®—æœºï¼Œé‚£å°±æ˜¯ 64 ä½çš„
  - (å…¶ä½™åŒç†)....
- ä½¿ç”¨ isize æˆ– usize çš„ä¸»è¦åœºæ™¯æ˜¯å¯¹æŸç§é›†åˆè¿›è¡Œç´¢å¼•æ“ä½œã€‚

**æ•´æ•°å­—é¢é‡**

- é™¤äº† byte ç±»å‹å¤–ï¼Œæ‰€æœ‰çš„æ•°å€¼å­—é¢å€¼éƒ½å…è®¸ä½¿ç”¨ç±»å‹åç¼€ã€‚
  - ä¾‹å¦‚ 57u8
- å¦‚æœä½ ä¸å¤ªæ¸…æ¥šåº”è¯¥ä½¿ç”¨å“ªç§ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ Rust ç›¸åº”çš„é»˜è®¤ç±»å‹
- æ•´æ•°çš„é»˜è®¤ç±»å‹å°±æ˜¯ u32

**æ•´æ•°æº¢å‡º**

- ä¾‹å¦‚ï¼š u8 çš„èŒƒå›´æ˜¯ 0-255ï¼Œå¦‚æœä½ æŠŠä¸€ä¸ª u8 å˜é‡çš„å€¼è®¾ä¸º 256ï¼Œé‚£ä¹ˆï¼š
  - è°ƒè¯•æ¨¡å¼ä¸‹ç¼–è¯‘ï¼šRust ä¼šæ£€æŸ¥æ•´æ•°æº¢å‡ºï¼Œå¦‚æœå‘ç”Ÿæº¢å‡ºï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶å°±ä¼š panic
  - å‘å¸ƒæ¨¡å¼ä¸‹(-release)ç¼–è¯‘ï¼šRust ä¸ä¼šæ£€æŸ¥å¯èƒ½å¯¼è‡´ panic çš„æ•´æ•°æº¢å‡º
    - å¦‚æœæº¢å‡ºå‘ç”Ÿï¼šRust ä¼šæ‰§è¡Œâ€œç¯ç»•â€æ“ä½œï¼š
      - 256 å˜æˆ 0 ï¼Œ257 å˜æˆ 1 ...
    - ä½†æ˜¯ç¨‹åºä¸ä¼š panic

**æµ®ç‚¹ç±»å‹**

- Rust æœ‰ä¸¤ç§åŸºç¡€çš„æµ®ç‚¹ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å«æœ‰å°æ•°éƒ¨åˆ†çš„ç±»å‹
  - f32ï¼Œ32 ä½ï¼Œå•ç²¾åº¦
  - f64ï¼Œ64 ä½ï¼ŒåŒç²¾åº¦
- Rust çš„æµ®ç‚¹ç±»å‹ä½¿ç”¨äº† IEEE-754 æ ‡å‡†æ¥è¡¨è¿°
- f64 æ—¶é»˜è®¤å†…å¿ƒï¼Œå› ä¸ºåœ¨ç°ä»£ CPU ä¸Š f64 å’Œ f32 çš„é€Ÿåº¦å·®ä¸å¤šï¼Œè€Œä¸”ç²¾åº¦æ›´é«˜ã€‚

```rust
fn main() {
   let x = 2.0; // f64
   let y: f32 = 3.0; // f32
}

```

**æ•°å€¼æ“ä½œ**

åŠ å‡ä¹˜é™¤æ²¡å•¥å¥½è¯´çš„

**å¸ƒå°”ç±»å‹**

å’Œå…¶å®ƒè¯­è¨€ä¹Ÿä¸€æ ·ï¼Œæ²¡å•¥å¥½è¯´çš„

**å­—ç¬¦ç±»å‹**

- Rust è¯­è¨€ä¸­ char ç±»å‹è¢«ç”¨æ¥æè¿°è¯­è¨€ä¸­æœ€åŸºç¡€çš„å•ä¸ªå­—ç¬¦ã€‚
- å­—ç¬¦ç±»å‹çš„å­—é¢å€¼ä½¿ç”¨å•å¼•å·
- å ç”¨ 4 å­—èŠ‚å¤§å°
- æ˜¯ Unicode çš„æ ‡é‡å€¼ï¼Œå¯ä»¥è¡¨ç¤ºæ¯” ASCII å¤šå¾—å¤šçš„å­—ç¬¦å†…å®¹ï¼šæ‹¼éŸ³ã€ä¸­æ—¥éŸ©æ–‡ã€é›¶é•¿åº¦ç©ºç™½å­—ç¬¦ã€emoji è¡¨æƒ…ç­‰
  - U+0000 åˆ° U+D7FF
  - U+E000 åˆ° U+10FFFF
- ä½† Unicode ä¸­å¹¶æ²¡æœ‰â€œå­—ç¬¦â€çš„æ”¹è‰¯ï¼Œæ‰€ä»¥ç›´è§‰ä¸Šè®¤ä¸ºçš„å­—ç¬¦ä¹Ÿè®¸ä¸ Rust ä¸­çš„æ¦‚å¿µå¹¶ä¸ç›¸ç¬¦

### 3.3 å¤åˆç±»å‹

- å¤åˆç±»å‹å¯ä»¥å°†å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹ä¸­
- Rust æä¾›äº†ä¸¤ç§åŸºç¡€çš„å¤åˆç±»å‹ï¼šå…ƒç»„(Tuple)ã€æ•°ç»„

#### Tuple

**åˆ›å»º Tuple**

- åœ¨å°æ‹¬å·é‡Œé¢ï¼Œå°†å€¼ç”¨é€—å·åˆ†å¼€
- Tuple ä¸­çš„æ¯ä¸ªä½ç½®éƒ½å¯¹åº”ä¸€ä¸ªç±»å‹ï¼ŒTuple ä¸­å„å…ƒç´ çš„ç±»å‹ä¸å¿…ç›¸åŒ

**è·å– Tuple çš„å…ƒç´ å€¼**

- å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥è§£æ„ï¼ˆdestructureï¼‰ä¸€ä¸ª Tuple æ¥è·å–å…ƒç´ çš„å€¼

```rust
fn main() {
    let tup: (i32, f64, i32) = (500, 6.4, 1);
    // è§£æ„
    let (x, y, z) = tup;
    println!("{},{},{}", x, y, z);
    // ç´¢å¼•
    println!("{},{},{}", tup.0, tup.1, tup.2);
}
```

#### æ•°ç»„

- æ•°ç»„ä¹Ÿå¯ä»¥å°†å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹é‡Œ
- æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒ
- æ•°ç»„çš„é•¿åº¦ä¹Ÿæ˜¯å›ºå®šçš„

**å£°æ˜ä¸€ä¸ªæ•°ç»„**

- åœ¨ä¸­æ‹¬å·é‡Œï¼Œå„å€¼ç”¨é€—å·åˆ†å¼€

**æ•°ç»„çš„ç”¨å¤„**

- å¦‚æœæƒ³è®©ä½ çš„æ•°æ®å­˜æ”¾åœ¨ stack(æ ˆ)ä¸Šè€Œä¸æ˜¯ heap(å †)ä¸Šï¼Œæˆ–è€…æƒ³ä¿è¯æœ‰å›ºå®šæ•°é‡çš„å…ƒç´ ï¼Œè¿™æ—¶ä½¿ç”¨æ•°ç»„æ›´æœ‰å¥½å¤„
- æ•°ç»„æ²¡æœ‰ Vector çµæ´»
  - Vector å’Œæ•°ç»„ç±»ä¼¼ï¼Œå®ƒç”±æ ‡å‡†åº“æä¾›
  - Vector çš„é•¿åº¦å¯ä»¥æ”¹å˜
  - å¦‚æœä½ ä¸ç¡®å®šåº”è¯¥ä½¿ç”¨æ•°ç»„è¿˜æ˜¯ Vectorï¼Œé‚£ä¹ˆä¼°è®¡ä½ åº”è¯¥ç”¨ Vector

**æ•°ç»„çš„ç±»å‹**

- æ•°ç»„çš„ç±»å‹ä»¥è¿™ç§å½¢å¼è¡¨ç¤º: [ç±»å‹; é•¿åº¦]

  - ä¾‹å¦‚ let a:[i32;5] = [1,2,3,4,5];

**å¦ä¸€ç§å£°æ˜æ•°ç»„çš„æ–¹æ³•**

- å¦‚æœæ•°ç»„çš„æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½ç›¸åŒ,é‚£ä¹ˆå¯ä»¥åœ¨:
  - åœ¨ä¸­æ‹¬å·é‡ŒæŒ‡å®šåˆå§‹å€¼
  - ç„¶åæ˜¯ä¸€ä¸ª"; "
  - æœ€åæ˜¯æ•°ç»„çš„é•¿åº¦
- ä¾‹å¦‚: let a = [3; 5]; å®ƒç›¸å½“äº: let a = [3,3,3,3,3]

**è®¿é—®æ•°ç»„çš„å…ƒç´ **

- æ•°ç»„æ—¶ Stack ä¸Šåˆ†é…çš„å•ä¸ªå—çš„å†…å­˜
- å¯ä»¥ä½¿ç”¨ç´¢å¼•æ¥è®¿é—®æ•°ç»„çš„å…ƒç´ (ä¾‹å­ )
- å¦‚æœè®¿é—®çš„ç´¢å¼•è¶…å‡ºäº†æ•°ç»„çš„èŒƒå›´,é‚£ä¹ˆ:
  - ç¼–è¯‘ä¼šé€šè¿‡
  - è¿è¡Œä¼šæŠ¥é”™(runtime æ—¶ä¼š panic)
    - Rust ä¸ä¼šå…è®¸å…¶ç»§ç»­è®¿é—®ç›¸åº”åœ°å€çš„å†…å­˜

```rust
fn main() {
    let months: [&str; 12] = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "Auguest",
        "September",
        "October",
        "November",
        "December",
    ];
    let first = months[0];
    let second = months[1];
    let index = 15;
    let month = months[index];
    println!("{}", month);
}
```

### 3.4 å‡½æ•°

- å£°æ˜å‡½æ•°ä½¿ç”¨ fn å…³é”®å­—
- ä¾ç…§æƒ¯ä¾‹:é’ˆå¯¹å‡½æ•°å’Œå˜é‡å,Rust ä½¿ç”¨ stack case å‘½åè§„èŒƒ:
  - æ‰€æœ‰çš„å­—æ¯éƒ½æ˜¯å°å†™çš„,å•è¯ä¹‹é—´ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†å¼€

#### å‡½æ•°çš„å‚æ•°

- parameters,arguments
- åœ¨å‡½æ•°ç­¾åé‡Œ,å¿…é¡»å£°æ˜æ¯ä¸ªå‚æ•°çš„ç±»å‹

#### å‡½æ•°ä½“ä¸­çš„è¯­å¥ä¸è¡¨è¾¾å¼

- å‡½æ•°ä½“ç”±ä¸€ç³»åˆ—è¯­å¥ç»„æˆ,å¯é€‰çš„ç”±ä¸€ä¸ªè¡¨è¾¾å¼ç»“æŸ
- Rust æ˜¯ä¸€ä¸ªåŸºäºè¡¨è¾¾å¼çš„è¯­è¨€
- è¯­å¥æ˜¯æ‰§è¡Œä¸€äº›åŠ¨ä½œçš„æŒ‡ä»¤
- è¡¨è¾¾å¼ä¼šè®¡ç®—äº§ç”Ÿä¸€ä¸ªå€¼
- å‡½æ•°çš„å®šä¹‰ä¹Ÿæ˜¯ä¸€ä¸ªè¯­å¥

#### å‡½æ•°çš„è¿”å›å€¼

- åœ¨ -> ç¬¦å·åè¾¹å£°æ˜å‡½æ•°è¿”å›å€¼çš„ç±»å‹,ä½†æ˜¯ä¸å¯ä»¥ä¸ºè¿”å›å€¼å‘½å
- åœ¨ Rust é‡Œé¢,è¿”å›å€¼å°±æ˜¯å‡½æ•°ä½“é‡Œé¢æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼
- è‹¥æƒ³æå‰è¿”å›,éœ€ä½¿ç”¨ return å…³é”®å­—,å¹¶æŒ‡å®šä¸€ä¸ªå€¼
  - å¤§å¤šæ•°å‡½æ•°éƒ½æ˜¯é»˜è®¤ä½¿ç”¨æœ€åä¸€ä¸ªè¡¨è¾¾å¼æœ€ä¸ºè¿”å›å€¼

#### å‡½æ•°æ³¨é‡Š

å’Œ js ä¸€æ ·

```rust
fn main() {
    another_function(5); // argument
    let y = {
        let x = 1;
        // ä¸åŠ åˆ†å·è¿”å› x + 3;
        // x + 3; //()
        x + 3
    };
    println!("The value of plus_five(10) is:{}", plus_five(10));
    println!("The value of y is:{}", y);
}
fn another_function(x: i32) {
    // parameter
    println!("the value of x is:{}", x);
}
fn plus_five(x: i32) -> i32 {
    x + 5
}
```

### 3.5 æ§åˆ¶æµ

#### if è¡¨è¾¾å¼

- if è¡¨è¾¾å¼å…è®¸æ‚¨æ ¹æ®æ¡ä»¶æ¥æ‰§è¡Œä¸åŒçš„ä»£ç åˆ†æ”¯
  - è¿™ä¸ªæ¡ä»¶å¿…é¡» bool ç±»å‹
- if è¡¨è¾¾å¼ä¸­,ä¸æ¡ä»¶ç›¸å…³è”çš„ä»£ç å—å°±å«åˆ†æ”¯(arm)
- å¯é€‰çš„,åœ¨åè¾¹å¯ä»¥åŠ ä¸Šä¸€ä¸ª else è¡¨è¾¾å¼

#### ä½¿ç”¨ else if å¤„ç†å¤šé‡æ¡ä»¶

- ä½†å¦‚æœä½¿ç”¨äº†å¤šäºä¸€ä¸ª else if,é‚£ä¹ˆæœ€å¥½ä½¿ç”¨ match æ¥é‡æ„ä»£ç 

```rust
fn main() {
    let number = 7;
    if number < 5 {
        println!("condition was true");
    } else if number > 1000 {
        println!("too big");
    } else {
        println!("condition was false");
    }
    let condition = true;
    let number = if condition { 5 } else { 6 };
    println!("The value of number is: {}", number);
}
```

### Rust çš„å¾ªç¯

- Rust æä¾›äº† 3 ç§å¾ªç¯:loop,while å’Œ for

#### loop å¾ªç¯

- loop å…³é”®å­—å‘Šè¯‰ Rust åå¤çš„æ‰§è¡Œä¸€å—ä»£ç ,ç›´åˆ°ä½ å–Šåœ

#### while æ¡ä»¶å¾ªç¯

- å¦ä¸€ç§å¸¸è§çš„å¾ªç¯æ¨¡å¼æ˜¯æ¯æ¬¡æ‰§è¡Œå¾ªç¯ä½“ä¹‹å‰éƒ½åˆ¤æ–­ä¸€æ¬¡æ¡ä»¶.
- while æ¡ä»¶å¾ªç¯ä¸ºè¿™ç§æ¨¡å¼è€Œç”Ÿ

#### ä½¿ç”¨ for å¾ªç¯éå†é›†åˆ

- å¯ä»¥ä½¿ç”¨ while æˆ– loop æ¥éå†é›†åˆ,ä½†æ˜¯æ˜“é”™ä¸”ä½æ•ˆ

```rust
fn main() {
    let a = [10, 20, 30, 40, 50];
    let mut index = 0;
    while index < 5 {
        println!("The value of a[index] is: {}", a[index]);
        index = index + 1;
    }
    for element in a.iter() {
        println!("element: {}", element);
    }
    let mut i = 1;
    while i <= 3 {
        i = i + 1;
        println!("while {}", i);
    }
    loop {
        i = i + 1;
        println!("loop {}", i);
        if i >= 10 {
            break;
        }
    }
}
```

#### Range

- æ ‡å‡†åº“æä¾›
- æŒ‡å®šä¸€ä¸ªå¼€å§‹æ•°å­—å’Œä¸€ä¸ªç»“æŸæ•°å­—,Range å¯ä»¥ç”Ÿæˆå®ƒä»¬ä¹‹é—´çš„æ•°å­—(ä¸å«ç»“æŸ)
- rev æ–¹æ³•å¯ä»¥åè½¬ Range

```rust
fn main() {
    for number in (1..4).rev() {
        println!("{}!", number);
    }
    println!("LIFTOFF!");
}
```

## 4.æ‰€æœ‰æƒ

- æ‰€æœ‰æƒæ˜¯ Rust æœ€ç‹¬ç‰¹çš„ç‰¹æ€§,å®ƒè®© Rust æ— éœ€ GC(åƒåœ¾æ”¶é›†å™¨) å°±å¯ä»¥ä¿è¯å†…å­˜å®‰å…¨

### 4.1 ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒ

- Rust çš„æ ¸å¿ƒç‰¹æ€§å°±æ˜¯æ‰€æœ‰æƒ
- æ‰€æœ‰ç¨‹åºåœ¨è¿è¡Œæ—¶éƒ½å¿…é¡»ç®¡ç†å®ƒä»¬ä½¿ç”¨è®¡ç®—æœºå†…å­˜çš„æ–¹å¼
  - æœ‰äº›è¯­è¨€æœ‰åƒåœ¾æ”¶é›†æœºåˆ¶,åœ¨ç¨‹åºè¿è¡Œæ—¶,å®ƒä»¬ä¼šä¸æ–­å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜
  - åœ¨å…¶å®ƒè¯­è¨€ä¸­,ç¨‹åºå‘˜å¿…é¡»æ˜¾ç¤ºçš„åˆ†é…å’Œé‡Šæ”¾å†…å­˜(ä¸åŒ…æ‹¬ js å§ ğŸ˜‹)
- Rust é‡‡ç”¨äº†ç¬¬ä¸‰ç§æ–¹å¼:
  - å†…å­˜æ˜¯é€šè¿‡ä¸€ä¸ªæ‰€æœ‰æƒç³»ç»Ÿæ¥ç®¡ç†çš„,å…¶ä¸­åŒ…å«ä¸€ç»„ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥çš„è§„åˆ™
  - å½“ç¨‹åºè¿è¡Œæ—¶,æ‰€æœ‰æƒç‰¹æ€§ä¸ä¼šå‡æ…¢ç¨‹åºçš„è¿è¡Œé€Ÿåº¦

#### 4.1.1 Stack vs Heap

æ ˆå†…å­˜ vs å †å†…å­˜

- åœ¨åƒ Rust è¿™æ ·çš„ç³»ç»Ÿçº§ç¼–ç¨‹è¯­è¨€é‡Œ,ä¸€ä¸ªå€¼æ˜¯åœ¨ stack ä¸Šè¿˜æ˜¯åœ¨ heap ä¸Šå †è¯­è¨€çš„è¡Œä¸ºå’Œä½ ä¸ºä»€ä¹ˆè¦åšæŸäº›å†³å®šæ—¶æœ‰æ›´å¤§çš„å½±å“çš„
- åœ¨ä½ çš„ä»£ç è¿è¡Œçš„æ—¶å€™,Stack å’Œ Heap éƒ½æ˜¯ä½ å¯ç”¨çš„å†…å­˜,ä½†æ˜¯å®ƒä»¬çš„è§£æ„å¾ˆä¸ç›¸åŒ.

**å­˜å‚¨æ•°æ®**

- Stack æŒ‰å€¼çš„æ¥å—é¡ºåºæ¥å­˜å‚¨,æŒ‰ç›¸åçš„é¡ºåºå°†å®ƒä»¬ç§»é™¤(åè¿›å…ˆå‡º,LIFO)
  - æ·»åŠ æ•°æ®å«åšå‹å…¥æ ˆ
  - ç§»é™¤æ•°æ®å«åšå¼¹å‡ºæ ˆ
- æ‰€æœ‰å­˜å‚¨åœ¨ Stack ä¸Šçš„æ•°æ®å¿…é¡»æ‹¥æœ‰å·²çŸ¥çš„å›ºå®šçš„å¤§å°
  - ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„æ•°æ®æˆ–è¿è¡Œæ—¶å¤§å°å¯èƒ½å‘ç”Ÿå˜åŒ–çš„æ•°æ®å¿…é¡»å­˜æ”¾åœ¨ heap ä¸Š
- Heap å†…å­˜ç»„ç»‡æ€§å·®ä¸€äº›

  - å½“ä½ æŠŠæ•°æ®æ”¾å…¥ heap æ—¶,ä½ ä¼šè¯·æ±‚ä¸€å®šæ•°é‡çš„ç©ºé—´
  - æ“ä½œç³»ç»Ÿåœ¨ heap é‡Œæ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´,æŠŠå®ƒæ ‡è®°ä¸ºåœ¨ç”¨,å¹¶è¿”å›ä¸€ä¸ªæŒ‡é’ˆ,ä¹Ÿå°±æ˜¯è¿™ä¸ªç©ºé—´çš„åœ°å€
  - è¿™ä¸ªè¿‡ç¨‹å«åšåœ¨ heap ä¸Šè¿›è¡Œåˆ†é…,æœ‰æ—¶å€™ä»…ä»…ç§°ä¸ºåˆ†é…

- æŠŠå€¼å‹åœ¨ stack ä¸Šä¸å«åˆ†é…

- å› ä¸ºæŒ‡é’ˆæ˜¯å·²çŸ¥å›ºå®šå¤§å°çš„,å¯ä»¥æŠŠæŒ‡é’ˆå­˜æ”¾åœ¨ stack ä¸Š.
  - å½“å¦‚æœæƒ³è¦å®é™…æ•°æ®,ä½ å¿…é¡»ä½¿ç”¨æŒ‡é’ˆæ¥å®šä½
- æŠŠæ•°æ®å‹å€’ stack ä¸Šè¦æ¯”åœ¨ heap ä¸Šåˆ†é…å¿«å¾—å¤š
  - å› ä¸ºæ“ä½œç³»ç»Ÿä¸éœ€è¦å¯»æ‰¾ç”¨æ¥å­˜å‚¨æ–°æ•°æ®çš„ç©ºé—´,é‚£ä¸ªä½ç½®æ°¸è¿œéƒ½åœ¨ stack çš„é¡¶ç«¯

**è®¿é—®æ•°æ®**

- è®¿é—® heap ä¸­çš„æ•°æ®è¦æ¯”è®¿é—® stack ä¸­çš„æ•°æ®æ…¢,å› ä¸ºéœ€è¦é€šè¿‡æŒ‡é’ˆæ‰èƒ½æ‰¾åˆ° heap ä¸­çš„æ•°æ®
  - å¯¹äºç°ä»£çš„å¤„ç†å™¨æ¥è¯´,ç”±äºç¼“å­˜çš„ç¼˜æ•…,å¦‚æœæŒ‡ä»¤åœ¨å†…å­˜ä¸­è·³è½¬çš„æ¬¡æ•°è¶Šå°‘,é‚£ä¹ˆé€Ÿåº¦å°±è¶Šå¿«
- å¦‚æœæ•°æ®å­˜æ”¾çš„è·ç¦»æ¯”è¾ƒè¿‘,é‚£ä¹ˆå¤„ç†å™¨çš„å¤„ç†é€Ÿåº¦å°±ä¼šæ›´å¿«ä»¥ä¸‹(stack)ä¸Š
- å¦‚æœæ•°æ®ä¹‹é—´çš„è·ç¦»æ¯”è¾ƒè¿œ,é‚£ä¹ˆå¤„ç†é€Ÿåº¦å°±ä¼šæ…¢ä¸€äº›(heap)ä¸Š
  - åœ¨ heap ä¸Šåˆ†é…å¤§é‡çš„ç©ºé—´ä¹Ÿæ˜¯éœ€è¦æ—¶é—´çš„

**å‡½æ•°è°ƒç”¨**

- å½“ä½ çš„ä»£ç è°ƒç”¨å‡½æ•°æ—¶,å€¼è¢«ä¼ å…¥åˆ°å‡½æ•°(ä¹ŸåŒ…æ‹¬æŒ‡å‘ heap çš„æŒ‡é’ˆ).å‡½æ•°æœ¬åœ°çš„å˜é‡è¢«å‹åˆ° stack ä¸Š. å½“å‡½æ•°ç»“æŸå,è¿™äº›å€¼ä¼šä» stack ä¸Šå¼¹å‡º

**æ‰€æœ‰æƒå­˜åœ¨çš„åŸå› **

- æ‰€æœ‰æƒè§£å†³çš„é—®é¢˜:
  - è·Ÿè¸ªä»£ç çš„å“ªäº›éƒ¨åˆ†æ­£åœ¨ä½¿ç”¨ heap çš„å“ªäº›æ•°æ®
  - æœ€å°åŒ– heap ä¸Šçš„é‡å¤æ•°æ®é‡
  - æ¸…ç† heap ä¸Šä»æœªä½¿ç”¨çš„æ•°æ®ä»¥é¿å…ç©ºé—´ä¸è¶³
- ä¸€æ—¦ä½ æ‡‚å¾—äº†æ‰€æœ‰æƒ,é‚£ä¹ˆå°±ä¸éœ€è¦ç»å¸¸å»æƒ³ stack æˆ– heap äº†
- ä½†æ˜¯ç›´åˆ°ç®¡ç† heap æ•°æ®æ˜¯æ‰€æœ‰æƒå­˜åœ¨çš„åŸå› ,è¿™æœ‰åŠ©äºè§£é‡Šå®ƒä¸ºä»€ä¹ˆä¼šè¿™æ ·å·¥ä½œ

#### 4.1.2 æ‰€æœ‰æƒè§„åˆ™ã€å†…å­˜ä¸åˆ†é…

**æ‰€æœ‰æƒè§„åˆ™**

- æ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡æ˜¯è¯¥å€¼çš„æ‰€æœ‰è€…
- æ¯ä¸ªå€¼åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
- å½“æ‰€æœ‰è€…è¶…å‡ºä½œç”¨åŸŸ(scope)æ—¶ï¼Œè¯¥å€¼å°†è¢«åˆ é™¤

**å˜é‡ä½œç”¨åŸŸ**

- Scope å°±æ˜¯ç¨‹åºä¸­ä¸€ä¸ªé¡¹ç›®çš„æœ‰æ•ˆèŒƒå›´

```rust
fn main() {
    // s ä¸å¯ç”¨
    let s = "hello"; // s å¯ç”¨
                     // å¯ä»¥å¯¹ s è¿›è¡Œç›¸å…³æ“ä½œ
    println!("Hello, world!");
} // s ä½œç”¨åŸŸåˆ°æ­¤ç»“æŸï¼Œs ä¸å†å¯ç”¨
```

**String ç±»å‹**

- String æ¯”é‚£äº›åŸºç¡€æ ‡é‡æ•°æ®ç±»å‹æ›´åŠ å¤æ‚
- å­—ç¬¦ä¸²å­—é¢å€¼ï¼šç¨‹åºé‡Œæ‰‹å†™çš„é‚£äº›å­—ç¬¦ä¸²å€¼ã€‚å®ƒä»¬æ˜¯ä¸å¯å˜çš„
- Rust è¿˜æœ‰ç¬¬äºŒç§å­—ç¬¦ä¸²ç±»å‹ï¼šString
  - åœ¨ heap ä¸Šåˆ†é…ã€‚èƒ½å¤Ÿå­˜å‚¨åœ¨ç¼–è¯‘æ—¶æœªçŸ¥æ•°é‡
    **åˆ›å»º String ç±»å‹çš„å€¼**
  - å¯ä»¥ä½¿ç”¨ from å‡½æ•°ä»å­—ç¬¦ä¸²å­—é¢å€¼åˆ›å»ºå‡º String ç±»å‹
  - let s = String::from("hello ")
  - è¿™ç±»å­—ç¬¦ä¸²æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„
  - ä¸ºä»€ä¹ˆ String ç±»å‹çš„å€¼å¯ä»¥ä¿®æ”¹ï¼Œè€Œå­—ç¬¦ä¸²å­—é¢å€¼å´ä¸èƒ½ä¿®æ”¹
    - å› ä¸ºå®ƒä»¬å¤„ç†å†…å­˜çš„æ–¹å¼ä¸åŒ

**å†…å­˜å’Œåˆ†é…**

- å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œåœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“å®ƒçš„å†…å®¹ï¼Œå…¶æ–‡æœ¬å†…å®¹ç›´æ¥è¢«ç¡¬ç¼–ç åˆ°æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶é‡Œ
  - é€Ÿåº¦å¿«ã€é«˜æ•ˆã€‚æ˜¯å› ä¸ºå…¶ä¸å¯å˜æ€§ã€‚
- String ç±»å‹ï¼Œä¸ºäº†æ”¯æŒå¯å˜æ€§ï¼Œéœ€è¦åœ¨ heap ä¸Šåˆ†é…å†…å­˜æ¥ä¿å­˜ç¼–è¯‘æ—¶æœªçŸ¥çš„æ–‡æœ¬å†…å®¹ï¼š

  - æ“ä½œç³»ç»Ÿå¿…é¡»åœ¨è¿è¡Œæ—¶æ¥è¯·æ±‚å†…å­˜
    - è¿™æ­¥é€šè¿‡è°ƒç”¨ String::from æ¥å®ç°
  - å½“ç”¨å®Œ String ä¹‹åï¼Œéœ€è¦ä½¿ç”¨æŸç§æ–¹å¼å°†å†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿ
    - è¿™æ­¥ï¼Œåœ¨æ‹¥æœ‰ GC çš„è¯­è¨€ä¸­ï¼ŒGC ä¼šè·Ÿè¸ªå¹¶æ¸…ç†
    - æ²¡æœ‰ GCï¼Œå°±éœ€è¦æˆ‘ä»¬å»è¯†åˆ«å†…å­˜ä½•æ—¶ä¸å†ä½¿ç”¨ï¼Œå¹¶è°ƒç”¨ä»£ç å°†å®ƒè¿”å›
      - å¦‚æœå¿˜äº†ï¼Œé‚£å°±æµªè´¹å†…å­˜
      - å¦‚æœæå‰åšäº†ï¼Œå˜é‡å°±ä¼šéæ³•
      - å¦‚æœåšäº†ä¸¤æ¬¡ï¼Œä¹Ÿæ˜¯ Bugï¼Œå¿…é¡»ä¸€æ¬¡åˆ†é…å¯¹åº”ä¸€æ¬¡é‡Šæ”¾

- Rust é‡‡ç”¨äº†ä¸åŒçš„æ–¹å¼ï¼šå¯¹äºæŸä¸ªå€¼æ¥è¯´ï¼Œå½“æ‹¥æœ‰å®ƒçš„å˜é‡èµ°å‡ºä½œç”¨èŒƒå›´æ—¶ï¼Œå†…å­˜ä¼šç«‹å³è‡ªåŠ¨çš„äº¤è¿˜ç»™æ“ä½œç³»ç»Ÿ
- drop å‡½æ•°

**å˜é‡å’Œæ•°æ®äº¤äº’çš„æ–¹å¼ï¼šç§»åŠ¨ï¼ˆMoveï¼‰**

- å¤šä¸ªå˜é‡å¯ä»¥ä¸åŒä¸€ä¸ªæ•°æ®ä½¿ç”¨ä¸€ç§ç‹¬ç‰¹çš„æ–¹å¼æ¥äº¤äº’

```rust
let x = 5;
let y = x;
```

- æ•´æ•°æ—¶å·²çŸ¥ä¸”å›ºå®šå¤§å°çš„ç®€å•çš„å€¼ï¼Œè¿™ä¸¤ä¸ª 5 è¢«å‹å€’äº† stack ä¸­

**String ç‰ˆæœ¬**

```rust
let s1 = String::from("hello");
let s2 = s1;
```

- ä¸€ä¸ª String ç”± 3 éƒ¨åˆ†ç»„æˆ

  - ä¸€ä¸ªæŒ‡å‘å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹çš„å†…å­˜çš„æŒ‡é’ˆ
  - ä¸€ä¸ªé•¿åº¦
  - ä¸€ä¸ªå®¹é‡

- ä¸Šé¢è¿™äº›ä¸œè¥¿æ”¾åœ¨ stack ä¸Šã€‚
- å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹çš„éƒ¨åˆ†åœ¨ heap ä¸Š
- é•¿åº¦ lenï¼Œå°±æ˜¯å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹æ‰€éœ€è¦çš„å­—èŠ‚æ•°
- å®¹é‡ capacity æ˜¯æŒ‡ String ä»æ“ä½œç³»ç»Ÿæ€»å…±è·å¾—å†…å­˜çš„æ€»å­—èŠ‚æ•°

- å½“æŠŠ s1 èµ‹ç»™ s2ï¼ŒString çš„æ•°æ®è¢«å¤åˆ¶äº†ä¸€ä»½
  - åœ¨ stack ä¸Šå¤åˆ¶äº†ä¸€ä»½æŒ‡é’ˆã€é•¿åº¦ã€å®¹é‡
  - å¹¶æ²¡æœ‰å¤åˆ¶æŒ‡é’ˆæ‰€æŒ‡å‘çš„ heap ä¸Šçš„æ•°æ®
- å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼ŒRust ä¼šè‡ªåŠ¨è°ƒç”¨ drop å‡½æ•°ï¼Œå¹¶å°†å˜é‡ä½¿ç”¨çš„ heap å†…å­˜é‡Šæ”¾
- å½“ s1ã€s2 ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå®ƒä»¬éƒ½ä¼šå°è¯•é‡Šæ”¾ç›¸åŒçš„å†…å­˜ï¼š

  - äºŒæ¬¡é‡Šæ”¾ï¼ˆdouble freeï¼‰bug

- ä¸ºäº†ä¿è¯å†…å­˜å®‰å…¨ï¼š
  - Rust æ²¡æœ‰å°è¯•å¤åˆ¶è¢«åˆ†é…çš„å†…å­˜
  - Rust è®© s1 å¤±æ•ˆ
    - å½“ s1 ç¦»å¼€ä½œç”¨åŸŸçš„æ—¶å€™ï¼ŒRust ä¸éœ€è¦é‡Šæ”¾ä»»ä½•ä¸œè¥¿
- è¯•è¯•çœ‹å½“ s2 åˆ›å»ºåå†ä½¿ç”¨ s1 æ˜¯ä»€ä¹ˆæ•ˆæœ

```rust
fn main() {
    let s1 = String::from("hello");
    let s2 = s1;
    println!("{}", s1);// æŠ¥é”™ s1 å·²ç»å¤±æ•ˆäº†
}
```

- æµ…æ‹·è´ï¼ˆshallow copyï¼‰
- æ·±æ‹·è´ï¼ˆdeep copyï¼‰
- ä½ ä¹Ÿè®¸ä¼šå°†å¤åˆ¶æŒ‡é’ˆã€é•¿åº¦ã€å®¹é‡è§†ä¸ºæµ…æ‹·è´ï¼Œä½†ç”±äº Rust è®© s1 å¤±æ•ˆäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¸€ä¸ªæ–°çš„æœ¯è¯­ï¼šç§»åŠ¨ï¼ˆMoveï¼‰
- éšå«çš„ä¸€ä¸ªè®¾è®¡åŸåˆ™ï¼šRust ä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®çš„æ·±æ‹·è´
  - å°±è¿è¡Œæ—¶æ€§èƒ½è€Œè¨€ï¼Œä»»ä½•è‡ªåŠ¨èµ‹å€¼çš„æ“ä½œéƒ½æ˜¯å»‰ä»·çš„

**å˜é‡å’Œæ•°æ®äº¤äº’çš„æ–¹å¼ï¼šå…‹éš†ï¼ˆCloneï¼‰**

- å¦‚æœçœŸæƒ³å † heap ä¸Šçš„ String æ•°æ®è¿›è¡Œæ·±åº¦æ‹·è´ï¼Œè€Œä¸ä»…ä»…æ˜¯ stack ä¸Šçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ clone æ–¹æ³•

**Stack ä¸Šçš„æ•°æ®ï¼šå¤åˆ¶**

- Copy traitï¼Œå¯ä»¥ç”¨äºåƒæ•´æ•°è¿™æ ·å®Œå…¨å­˜æ”¾å† stack ä¸Šé¢çš„ç±»å‹
- å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† Copy è¿™ä¸ª traitï¼Œé‚£ä¹ˆæ—§çš„å˜é‡åœ¨èµ‹å€¼åä»ç„¶å¯ç”¨
- å¦‚æœä¸€ä¸ªç±»å‹æˆ–è€…è¯¥ç±»å‹çš„ä¸€éƒ¨åˆ†å®ç° Drop traitï¼Œé‚£ä¹ˆ Rust ä¸å…è®¸è®©å®ƒå†å»å®ç° Copy trait äº†

**ä¸€äº›æ‹¥æœ‰ Copy trait çš„ç±»å‹**

- ä»»ä½•ç®€å•æ ‡é‡çš„ç»„åˆç±»å‹éƒ½å¯ä»¥æ˜¯ Copy çš„
- ä»»ä½•éœ€è¦åˆ†é…å†…å­˜æˆ–æŸç§èµ„æºçš„éƒ½ä¸æ˜¯ Copy çš„
- ä¸€äº›æ‹¥æœ‰ Copy trait çš„ç±»å‹ï¼š
  - æ‰€æœ‰çš„æ•´æ•°ç±»å‹ï¼Œä¾‹å¦‚ u32
  - bool
  - char
  - æ‰€æœ‰çš„æµ®ç‚¹ç±»å‹ï¼Œä¾‹å¦‚ f64
  - Tupleï¼ˆå…ƒç»„ï¼‰ï¼Œå¦‚æœå…¶æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯ Copy çš„
    - (i32,i32) æ˜¯
    - (i32,String) ä¸æ˜¯

### 4.1.3 æ‰€æœ‰æƒä¸å‡½æ•°

- åœ¨è¯­ä¹‰ä¸Šï¼Œå°†å€¼ä¼ é€’ç»™å‡½æ•°å’ŒæŠŠå€¼èµ‹ç»™å˜é‡æ˜¯ç±»ä¼¼çš„ï¼š
  - å°†å€¼ä¼ é€’ç»™å‡½æ•°å°†å‘ç”Ÿç§»åŠ¨æˆ–å¤åˆ¶

```rust
fn main() {
    let s = String::from("Hello World");
    take_ownership(s);// å‡½æ•°æ‰§è¡Œå s å°±æ— æ•ˆäº†
    let x = 5;
    makes_copy(x);
    println!("x:{}", x);
}

fn take_ownership(some_string: String) {
    println!("{}", some_string);
}
fn makes_copy(some_number: i32) {
    println!("{}", some_number);
}
```

**è¿”å›å€¼ä¸ä½œç”¨åŸŸ**

- å‡½æ•°åœ¨è¿”å›å€¼çš„è¿‡ç¨‹ä¸­åŒæ ·ä¹Ÿä¼šå‘ç”Ÿæ‰€æœ‰æƒçš„è½¬ç§»
- ä¸€ä¸ªå˜é‡çš„æ‰€æœ‰æƒæ€»æ˜¯éµå¾ªåŒæ ·çš„æ¨¡å¼ï¼š
  - æŠŠä¸€ä¸ªå€¼èµ‹ç»™å…¶å®ƒå˜é‡æ—¶å°±ä¼šå‘ç”Ÿç§»åŠ¨
  - å½“ä¸€ä¸ªåŒ…å« heap æ•°æ®çš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå®ƒçš„å€¼å°±ä¼šè¢« drop å‡½æ•°æ¸…ç†ï¼Œé™¤éæ•°æ®çš„æ‰€æœ‰æƒç§»åŠ¨åˆ°å¦ä¸€ä¸ªå˜é‡ä¸Š

**å¦‚ä½•è®©å‡½æ•°ä½¿ç”¨æŸä¸ªå€¼ï¼Œä½†ä¸è·å¾—å…¶æ‰€æœ‰æƒï¼Ÿ**

```rust
fn main() {
    let s1 = String::from("hello");
    let (s2, len) = calculate_length(s1);
    println!("The length of '{}' is {}.", s2, len);
}
fn calculate_length(s: String) -> (String, usize) {
    let length = s.len();
    (s, length)
}
```

## 4.2 å¼•ç”¨ä¸å€Ÿç”¨

**ä¾‹å­**

```rust
fn main() {
    let s1 = String::from("Hello");
    let len = calculate_length(&s1);
    println!("The length of '{}' is {}", s1, len);
}
fn calculate_length(s: &String) -> usize {
    s.len()
}
```

- å‚æ•°çš„ç±»å‹æ—¶&String è€Œä¸æ˜¯ String
- &ç¬¦å·å°±è¡¨ç¤ºå¼•ç”¨ï¼šå…è®¸ä½ å¼•ç”¨æŸäº›å€¼è€Œä¸å–å¾—å…¶æ‰€æœ‰æƒ

**å€Ÿç”¨**

- æˆ‘ä»¬æŠŠå¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•°è¿™ä¸ªè¡Œä¸ºå«åšå€Ÿç”¨
- æˆ‘ä»¬ä¸èƒ½ä¿®æ”¹å€Ÿç”¨çš„ä¸œè¥¿
- å’Œå˜é‡ä¸€æ ·ï¼Œé»˜è®¤æ˜¯ä¸å¯å˜çš„

**å¯å˜å¼•ç”¨**

- å¯å˜å¼•ç”¨æœ‰ä¸€ä¸ªé‡è¦çš„é™åˆ¶ï¼šåœ¨ç‰¹å®šä½œç”¨åŸŸå†…ï¼Œå †æŸä¸€å—æ•°æ®ï¼Œåªèƒ½ç”±ä¸€ä¸ªå¯å˜çš„å¼•ç”¨ã€‚
  - è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯åœ¨ç¼–è¯‘æ—¶é˜²æ­¢æ•°æ®ç«äº‰
- ä»¥ä¸‹ä¸‰ç§è¡Œä¸ºä¸‹ä¼šå‘ç”Ÿæ•°æ®ç«äº‰ï¼š
  - ä¸¤ä¸ªæˆ–å¤šä¸ªæŒ‡é’ˆåŒæ—¶è®¿é—®åŒä¸€ä¸ªæ•°æ®
  - è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆç”¨äºå†™å…¥æ•°æ®
  - æ²¡æœ‰ä½¿ç”¨ä»»ä½•æœºåˆ¶æ¥åŒæ­¥å¯¹æ•°æ®çš„è®¿é—®
- å¯ä»¥é€šè¿‡åˆ›å»ºæ–°çš„ä½œç”¨åŸŸï¼Œæ¥å…è®¸éåŒæ—¶çš„åˆ›å»ºå¤šä¸ªå¯å˜å¼• ç”¨ï¼ˆä¾‹å­ï¼‰

```rust
fn main() {
    let mut s = String::from("Hello");
    let s1 = &mut s;
    let s2 = &mut s;// æŠ¥é”™
    println!("The length of '{}' is {}.", s1, s2);
}
fn main() {
    let mut s = String::from("Hello");
    {
        let s1 = &mut s;
    }
    // ä¸æŠ¥é”™
    let s2 = &mut s;
}
```

**å¦ä¸€ä¸ªé™åˆ¶**

- ä¸å¯ä»¥åŒæ—¶æ‹¥æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨å’Œä¸€ä¸ªä¸å˜å¼•ç”¨
- å¤šä¸ªä¸å˜çš„å¼•ç”¨æ˜¯å¯è¡Œçš„

```rust
fn main() {
    let mut s = String::from("Hello");
    let r1 = &s;
    let r2 = &s;
    let s1 = &mut s;// æŠ¥é”™
    println!("{} {} {}", r1, r2, s1);
}
```

## 4.3 åˆ‡ç‰‡

- Rust çš„å¦ä¸€ç§ä¸æŒæœ‰æ‰€æœ‰æƒçš„æ•°æ®ç±»å‹ï¼šåˆ‡ç‰‡ï¼ˆsliceï¼‰
- ä¸€é“é¢˜ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼š
  - å®ƒæ¥æ”¶å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°
  - è¿”å›å®ƒåœ¨è¿™ä¸ªå­—ç¬¦ä¸²é‡Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªçš„é‚£æ¬¡
  - å¦‚æœå‡½æ•°æ²¡æ‰¾åˆ°ä»»ä½•æ§è‚¡ä¸ªï¼Œé‚£ä¹ˆæ•´ä¸ªå­—ç¬¦ä¸²å°±è¢«è¿”å›

```rust
fn main() {
    let mut s = String::from("Hello world");
    let word_index = fitst_world(&s);
    s.clear();
    println!("{}", word_index);
}
fn fitst_world(s: &String) -> usize {
    let bytes = s.as_bytes();
    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return i;
        }
    }
    s.len()
}
```

### å­—ç¬¦ä¸²åˆ‡ç‰‡

- å­—ç¬¦ä¸²åˆ‡ç‰‡æ˜¯æŒ‡å­—ç¬¦ä¸²ä¸­ä¸€éƒ¨åˆ†å†…å®¹çš„å¼•ç”¨
- å½¢å¼ï¼š[å¼€å§‹ç´¢å¼•..ç»“æŸç´¢å¼•]
  - å¼€å§‹ç´¢å¼•å°±æ˜¯åˆ‡ç‰‡èµ·å§‹ä½ç½®çš„ç´¢å¼•å€¼
  - ç»“æŸç´¢å¼•å°±æ˜¯åˆ‡ç‰‡ç»ˆæ­¢ä½ç½®çš„ä¸‹ä¸€ä¸ªç´¢å¼•å€¼

**æ³¨æ„**

- å­—ç¬¦ä¸²åˆ‡ç‰‡çš„è¿”å›ç´¢å¼•å¿…é¡»å‘ç”Ÿåœ¨æœ‰æ•ˆçš„ UTF-8 å­—ç¬¦è¾¹ç•Œå†…ã€‚
- å¦‚æœå°è¯•ä»ä¸€ä¸ªå¤šå­—èŠ‚çš„å­—ç¬¦ä¸­åˆ›å»ºå­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œç¨‹åºä¼šæŠ¥é”™å¹¶é€€å‡º

```rust
fn main() {
    let s = String::from("Hello World");
    // let hello = &s[0..5];
    // let world = &s[6..11];
    // let hello = &s[..5];
    // let world = &s[6..];
    // let world = &s[6..s.len()];
    // println!("{},{}", hello, world);
    // let whole = &s[0..s.len()];
    let whole = &s[..];
    println!("{}", whole);
}
```

**ä½¿ç”¨å­—ç¬¦ä¸²åˆ‡ç‰‡é‡å†™ä¾‹å­**

```rust
fn main() {
    let mut s = String::from("Hello world");
    let word_index = fitst_world(&s);
    s.clear();
    println!("{}", word_index);
}
fn fitst_world(s: &String) -> &str {
    let bytes = s.as_bytes();
    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[..i];
        }
    }
    &s[..]
}
```

#### å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯åˆ‡ç‰‡

- å­—ç¬¦ä¸²å­—é¢å€¼è¢«ç›´æ¥å­˜å‚¨åœ¨äºŒè¿›åˆ¶ç¨‹åºä¸­
- let s = "Hello World"
- å˜é‡ s çš„ç±»å‹æ˜¯&strï¼Œä»–æ˜¯ä¸€ä¸ªæŒ‡å‘äºŒè¿›åˆ¶ç¨‹åºç‰¹å®šä½ç½®çš„åˆ‡ç‰‡
  - &str æ˜¯ä¸å¯å˜å¼•ç”¨ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²å­—é¢å€¼ä¹Ÿæ˜¯ä¸å¯å˜çš„

#### å°†å­—ç¬¦ä¸²åˆ‡ç‰‡ä½œä¸ºå‚æ•°ä¼ é€’

- fn first_word(s:&String)->&str{}
- æœ‰ç»éªŒçš„ Rust å¼€å‘è€…ä¼šé‡‡ç”¨&str ä½œä¸ºå‚æ•°ç±»å‹ï¼Œå› ä¸ºè¿™æ ·å°±å¯ä»¥åŒæ—¶æ¥æ”¶ String å’Œ&str ç±»å‹çš„å‚æ•°äº†ï¼š
- fn first_world(s:&str)->&str {}
  - ä½¿ç”¨å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œç›´æ¥è°ƒç”¨è¯¥å‡½æ•°
  - ä½¿ç”¨ Stringï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå®Œæˆ String åˆ‡ç‰‡æ¥è°ƒç”¨è¯¥å‡½æ•°
- å®šä¹‰å‡½æ•°æ—¶ä½¿ç”¨å­—ç¬¦ä¸²åˆ‡ç‰‡æ¥ä»£æ›¿å­—ç¬¦ä¸²å¼•ç”¨ä¼šä½¿æˆ‘ä»¬çš„ API æ›´åŠ é€šç”¨ï¼Œä¸”ä¸ä¼šæŸå¤±ä»»ä½•åŠŸèƒ½ã€‚

```rust
fn main() {
    let my_string = String::from("Hello World");
    let word_index = first_world(&my_string);
    let my_string_literal = "hello world";
    let word_index = first_world(my_string_literal);
}
fn first_world(s: &str) -> &str {
    let bytes = s.as_bytes();
    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[..i];
        }
    }
    &s[..]
}
```

### å…¶å®ƒç±»å‹çš„åˆ‡ç‰‡

```rust

fn main() {
    let a = [1, 2, 3, 4, 5];
    let slice = &a[1..3];
}
```

## 5.struct

### 5.1 å®šä¹‰å¹¶å®ä¾‹åŒ– struct

**ä»€ä¹ˆæ˜¯ struct**

- structï¼Œç»“æ„ä½“
  - è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹
  - ä¸ºç›¸å…³è”çš„å€¼å‘½åï¼Œæ‰“åŒ… => æœ‰æ„ä¹‰çš„ç»„åˆ

**å®šä¹‰ struct**

- ä½¿ç”¨ **struct** å…³é”®å­—ï¼Œå¹¶æœªæ•´ä¸ª struct å‘½å
- åœ¨èŠ±æ‹¬å·å†…ï¼Œä¸ºæ‰€æœ‰`å­—æ®µï¼ˆFieldï¼‰`å®šä¹‰åç§°å’Œç±»å‹
- ä¾‹å¦‚ï¼š

```rust
struct User {
    username: String,
    email: String,
    sign_in_count: u64,
    active: bool,
}
```

**å®ä¾‹åŒ– struct**

- æƒ³è¦ä½¿ç”¨ structï¼Œéœ€è¦åˆ›å»º struct çš„å®ä¾‹
  - ä¸ºæ¯ä¸ªå­—æ®µæŒ‡å®šå…·ä½“å€¼
  - æ— éœ€æŒ‰å£°æ˜çš„é¡ºåºè¿›è¡ŒæŒ‡å®š
- ä¾‹å­

```rust
let user1 = User {
        email: String::from("chovrio@....."),
        username: String::from("chovrio"),
        sign_in_count: 1,
        active: true,
    };
```

### 5.2 struct ä¸­çš„ä¾‹å­

**å–å¾— struct é‡Œé¢çš„æŸä¸ªå€¼**

- ä½¿ç”¨ç‚¹æ ‡è®°æ³•
- user1.email = String::from("Autumn@...")

```rust
let mut user1 = User {
        email: String::from("chovrio@....."),
        username: String::from("chovrio"),
        sign_in_count: 1,
        active: true,
    };
```

- ä¸€æ—¦ struct çš„å®ä¾‹æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆå®ä¾‹ä¸­æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯å¯å˜çš„

**struct ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼**

å­—æ®µåŒåå¯ä»¥ç®€åŒ–

```rust
fn build_user(email: String, username: String) -> User {
    User {
        email,
        username,
        active: true,
        sign_in_count: 1,
    }
}
```

**struct æ›´æ–°è¯­æ³•**

- å½“ä½ æƒ³è¦åŸºäºæŸä¸ª struct å®ä¾‹æ¥åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ struct æ›´æ–°è¯­æ³•ï¼š

```rust
let user2 = User {
        email: String::from("AAAA"),
        username: String::from("BBB"),
        ..user1
    };
```

**Tuple struct**

- å¯å®šä¹‰ç±»ä¼¼ tuple çš„ structï¼Œå«åš tuple struct
  - Tuple struct æ•´ä½“æœ‰ä¸ªåï¼Œä½†é‡Œé¢çš„å…ƒç´ æ²¡æœ‰å
  - é€‚ç”¨ï¼šæƒ³ç»™æ•´ä¸ª tuple èµ·åï¼Œå¹¶è®©å®ƒä¸åŒäºå…¶å®ƒ tupleï¼Œè€Œä¸”åˆä¸éœ€è¦ç»™æ¯ä¸ªå…ƒç´ å…¶èµ·å
- å®šä¹‰ tuple structï¼šä½¿ç”¨ struct å…³é”®å­—ï¼Œåè¾¹æ˜¯åå­—ï¼Œä»¥åŠé‡Œé¢å…ƒç´ çš„ç±»å‹
- black å’Œ origin æ˜¯ä¸åŒçš„ç±»å‹ï¼Œæ˜¯ä¸åŒ tuple struct çš„å®ä¾‹ã€‚

**Unit-Like Structï¼ˆæ²¡æœ‰ä»»ä½•å­—æ®µï¼‰**

- å¯ä»¥å®šä¹‰æ²¡æœ‰ä»»ä½•å­—æ®µçš„ structï¼Œå«åš Unit-Like structï¼ˆå› ä¸ºä¸()ï¼Œå•å…ƒç±»å‹ç±»ä¼¼ï¼‰
- é€‚ç”¨äºéœ€è¦åœ¨æŸä¸ªç±»å‹ä¸Šå®ç°æŸä¸ª traitï¼Œä½†æ˜¯åœ¨é‡Œé¢æœ‰æ²¡æœ‰æƒ³è¦å­˜å‚¨çš„æ•°æ®

**struct æ•°æ®çš„æ‰€æœ‰æƒ**

```rust
struct User1 {
    username: String,
    email: String,
    sign_in_count: u64,
    active: bool,
}
```

- è¿™é‡Œçš„å­—æ®µä½¿ç”¨äº† String è€Œä¸æ˜¯&strï¼š
  - è¯¥ struct å®ä¾‹æ‹¥æœ‰å…¶æ‰€æœ‰çš„æ•°æ®
  - åªè¦ struct å®ä¾‹æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆé‡Œé¢çš„å­—æ®µä¹Ÿæ˜¯æœ‰æ•ˆçš„
- struct é‡Œä¹Ÿå¯ä»¥å­˜æ”¾å¼•ç”¨ï¼Œä½†è¿™éœ€è¦ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ -ç”Ÿå‘½å‘¨æœŸä¿è¯åªè¦ struct å®ä¾‹æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆé‡Œé¢çš„å¼•ç”¨ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚
- å¦‚æœ struct é‡Œé¢å­˜å‚¨å¼•ç”¨ï¼Œè€Œä¸ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸï¼Œå°±ä¼šæŠ¥é”™

```rust
struct User {
    username: &str,// æŠ¥é”™
    email: &str,// æŠ¥é”™
    sign_in_count: u64,
    active: bool,
}

fn main() {
    println!("Hello World");
    let user1 = User {
        email: "aaa",
        username: "bbb",
        active: true,
        sign_in_count: 100,
    };
}
```

**è®¡ç®—çŸ©å½¢é¢ç§¯ä¾‹å­**

**æ™®é€šç‰ˆæœ¬**

```rust
fn main() {
    let w = 30;
    let l = 50;
    println!("{}", area(w, l));
}
fn area(width: u32, length: u32) -> u32 {
    width * length
}
```

**å…ƒç»„ç‰ˆæœ¬**

```rust
fn main() {
    let rect = (30, 50);
    println!("{}", area(rect));
}
fn area(dim: (u32, u32)) -> u32 {
    dim.0 * dim.1
}
```

**ç»“æ„ä½“ç‰ˆæœ¬**

```rust
struct Rectangle {
    width: u32,
    length: u32,
}
fn main() {
    let rect = Rectangle {
        width: 30,
        length: 50,
    };
    println!("{}", area(&rect));
}
fn area(rect: &Rectangle) -> u32 {
    rect.width * rect.length
}
```

### 5.3 struct çš„æ–¹æ³•

#### 5.3.1 å®šä¹‰æ–¹æ³•

- æ–¹æ³•å’Œå‡½æ•°ç±»ä¼¼ï¼šfn å…³é”®å­—ã€åç§°ã€å‚æ•°ã€è¿”å›å€¼
- æ–¹æ³•ä¸å‡½æ•°ä¸åŒä¹‹å¤„
  - æ–¹æ³•æ˜¯åœ¨ structï¼ˆæˆ– enumã€frait å¯¹è±¡ï¼‰çš„ä¸Šä¸‹æ–‡ä¸­å®šä¹‰
  - ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ selfï¼Œè¡¨ç¤ºæ–¹æ³•è¢«è°ƒç”¨çš„ struct å®ä¾‹
- åœ¨ impl å—é‡Œå®šä¹‰æ–¹æ³•
- æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯&selfï¼Œä¹Ÿå¯ä»¥è·å¾—å…¶æ‰€æœ‰æƒæˆ–å¯å˜å€Ÿç”¨ã€‚å’Œå…¶å®ƒå‚æ•°ä¸€æ ·ã€‚
- æ›´è‰¯å¥½çš„ä»£ç ç»„ç»‡

```rust
#[derive(Debug)]
struct Rectangle {
    width: u32,
    length: u32,
}
impl Rectangle {
    fn area(&self) -> u32 {
        self.width * self.length
    }
}
fn main() {
    let rect = Rectangle {
        width: 30,
        length: 50,
    };
    println!("{}", rect.area());
}
```

#### 5.3.2 æ–¹æ³•è°ƒç”¨çš„è¿ç®—ç¬¦

- C/C++ï¼šobject->something()å’Œ(\*object.something()ä¸€æ ·
- Rust æ²¡æœ‰ -> è¿ç®—ç¬¦
- Rust ä¼šè‡ªåŠ¨å¼•ç”¨æˆ–è§£å¼•ç”¨
  - åœ¨è°ƒç”¨æ–¹æ³•æ—¶ï¼ŒRust æ ¹æ®æƒ…å†µè‡ªåŠ¨æ·»åŠ &ã€&mut æˆ–\*ï¼Œä»¥ä¾¿ object å¯ä»¥åŒ¹é…æ–¹æ³•çš„ç­¾åã€‚
- ä¸‹é¢ä¸¤è¡Œä»£ç æ•ˆæœç›¸åŒï¼š
  - p1.distance(&p2);
  - (&p1).distance(&p2)

#### 5.3.3 æ–¹æ³•å‚æ•°

- æ–¹æ³•å¯ä»¥æœ‰å¤šä¸ªå‚æ•°

```rust
#[derive(Debug)]
struct Rectangle {
   width: u32,
   length: u32,
}
impl Rectangle {
   fn can_hold(&self, other: &Rectangle) -> bool {
       self.width > other.width && self.length > other.length
   }
}
fn main() {
   let rect1 = Rectangle {
       width: 30,
       length: 50,
   };
   let rect2 = Rectangle {
       width: 10,
       length: 40,
   };
   let rect3 = Rectangle {
       width: 35,
       length: 55,
   };
   println!("{}", rect1.can_hold(&rect2)); // true
   println!("{}", rect2.can_hold(&rect3)); // false
}
```

#### 5.3.4 å…³è”å‡½æ•°

- å¯ä»¥åœ¨ impl å—é‡Œå®šä¹‰ä¸æŠŠ self ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå®ƒä»¬å«å…³è”å‡½æ•°ï¼ˆä¸å«æ–¹æ³•ï¼‰
  - ä¾‹å¦‚ï¼šString::from()
- å…³è”å‡½æ•°é€šå¸¸ç”¨äºæ„é€ å™¨ï¼ˆä¾‹å­ï¼‰
- ::ç¬¦å·
  - å…³è”å‡½æ•°
  - æ¨¡å—åˆ›å»ºçš„å‘½åç©ºé—´

#### 5.3.5 å¤šä¸ª impl å—

- æ¯ä¸ª struct å…è®¸æ‹¥æœ‰å¤šä¸ª impl å—ï¼ˆä¾‹å­ï¼‰

## 6.æšä¸¾ä¸æ¨¡å¼åŒ¹é…

- æšä¸¾å…è®¸æˆ‘ä»¬åˆ—ä¸¾æ‰€æœ‰å¯èƒ½çš„å€¼æ¥å®šä¹‰ä¸€ä¸ªç±»å‹

### 6.1 å®šä¹‰æšä¸¾

- IP åœ°å€ï¼šIPv4ã€IPv6

```rust
enum ip_addrkind {
  V4,
  V6
}
```

#### 6.1.1 æšä¸¾å€¼

- ä¾‹å­ï¼š
- let four = ip_addrkind::V4;
- let six = ip_addrkind::V6;

**å°†æ•°æ®é™„åŠ åˆ°æšä¸¾çš„å˜ä½“ä¸­**

```rust
enum IpAddr {
  V4(String),
  V6(String),
}
```

- ä¼˜ç‚¹ï¼š
  - ä¸éœ€è¦é¢å¤–ä½¿ç”¨ struct
  - æ¯ä¸ªå˜ä½“å¯ä»¥æ‹¥æœ‰ä¸åŒçš„ç±»å‹ä»¥åŠå…³è”çš„æ•°æ®é‡
- ä¾‹å¦‚ï¼š

```rust
enum IpAddrKind  {
  V4(u8,u8,u8,u8),
  V6(String)
}
```

### 6.1.2 æ ‡å‡†åº“ä¸­çš„ IpAddr

```rust
struct Ipv4Addr {
    // --snip--
}
struct Ipv6Addr {
    // --snip--
}
enum IpAddr {
    V4(Ipv4Addr),
    V6(Ipv6Addr),
}
enum Message {
    Quit,
    Move { x: i32, y: i32 },
    Write(String),
    ChangeColor(i32, i32, i32),
}

fn main() {
    let q = Message::Quit;
    let m = Message::Move { x: 12, y: 24 };
    let w = Message::Write(String::from("Hello"));
    let c = Message::ChangeColor(0, 255, 255);
}
```

### 6.1.3 ä¸ºæšä¸¾å®šä¹‰æ–¹æ³•

åŒæ ·ä½¿ç”¨ `impl`

```rust
impl Message {
   fn call(&self) {}
}
```

### 6.2 Option æšä¸¾

- å®šä¹‰äºæ ‡å‡†åº“ä¸­
- åœ¨ Preludeï¼ˆé¢„å¯¼å…¥æ¨¡å—ï¼‰ä¸­
- æè¿°äº†ï¼šæŸä¸ªå€¼å¯èƒ½å­˜åœ¨ï¼ˆæŸç§ç±»å‹ï¼‰æˆ–ä¸å­˜åœ¨çš„æƒ…å†µ

#### 6.2.1 Rust æ²¡æœ‰ Null

- å…¶å®ƒè¯­è¨€ä¸­ï¼š
  - Null æ˜¯ä¸€ä¸ªå€¼ï¼Œå®ƒè¡¨ç¤ºâ€œæ²¡æœ‰å€¼â€
  - ä¸€ä¸ªå˜é‡å¯ä»¥å¤„äºä¸¤ç§çŠ¶æ€ï¼šç©ºå€¼ï¼ˆnullï¼‰ã€éç©º
- Null å¼•ç”¨ï¼šBillion Dollar Mistake
- Null çš„é—®é¢˜åœ¨äºï¼šå½“ä½ å°è¯•ä½¿ç”¨é Null å€¼é‚£æ ·ä½¿ç”¨ Null å€¼çš„æ—¶å€™ï¼Œå°±ä¼šå¼•èµ·æŸç§é”™è¯¯
- Null çš„æ¦‚å¿µè¿˜æ˜¯æœ‰ç”¨çš„ï¼šå› æŸç§åŸå› è€Œå˜ä¸ºæ— æ•ˆæˆ–ç¼ºå¤±çš„å€¼

#### 6.2.2 Rust ä¸­ç±»ä¼¼ Null æ¦‚å¿µçš„æšä¸¾ - `Option<T>`

- æ ‡å‡†åº“ä¸­çš„å®šä¹‰

```rust
enum Option<T> {
  Some(T),
  None,
}
```

- å®ƒåŒ…å«åœ¨ Preludeï¼ˆé¢„å¯¼å…¥æ¨¡å—ï¼‰ä¸­ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š

  - `Option<T>`
  - Some(T)
  - None

- ä¾‹å­

```rust
let some_number = Some(5);
    let some_string = Some("A String");
    let absent_number: Option<i32> = None;
```

#### `Option<T>`æ¯” Null å¥½åœ¨å“ªï¼Ÿ

- `Option<T>`å’Œ`T`æ˜¯ä¸åŒçš„ç±»å‹ï¼Œä¸å¯ä»¥æŠŠ`Option<T>`ç›´æ¥å½“æˆ`T`
- è‹¥æƒ³ä½¿ç”¨`Option<T>`ä¸­çš„`T`ï¼Œå¿…é¡»å°†å®ƒè½¬ä¸º`T`
- è€Œåœ¨ C#ä¸­ï¼š
  - string a = null;
  - string b = a + "123456";

### 6.3 æ§åˆ¶æµè¿ç®—ç¬¦ - match

#### 6.3.1 å¼ºå¤§çš„æ§åˆ¶æµè¿ç®—ç¬¦ - match

- å…è®¸ä¸€ä¸ªå€¼ä¸ä¸€ç³»åˆ—æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå¹¶æ‰§è¡ŒåŒ¹é…çš„æ¨¡å¼å¯¹åº”çš„ä»£ç 
- æ¨¡å¼å¯ä»¥æ˜¯å­—é¢å€¼ã€å˜é‡ã€é€šé…ç¬¦...

#### 6.3.2 ç»‘å®šå€¼çš„æ¨¡å¼

- åŒ¹é…çš„åˆ†æ”¯å¯ä»¥ç»‘å®šåˆ°è¢«åŒ¹é…å¯¹è±¡çš„éƒ¨åˆ†å€¼
  - å› æ­¤ï¼Œå¯ä»¥ä» enum å˜ä½“ä¸­æå–å€¼

```rust
#[derive(Debug)]
enum UsState {
    Alabame,
    Alaska,
}

enum Coin {
    Penny,
    Nickel,
    Dime,
    Quarter(UsState),
}
fn value_in_cents(coin: Coin) -> u8 {
    match coin {
        Coin::Penny => 1,
        Coin::Nickel => 5,
        Coin::Dime => 10,
        Coin::Quarter(state) => {
            println!("State quarter from {:?}", state);
            25
        }
    }
}
fn main() {
    let c = Coin::Quarter(UsState::Alaska);
    println!("{}", value_in_cents(c));
}
```

#### 6.3.3 åŒ¹é…`Option<T>`

**æ³¨æ„ match åŒ¹é…å¿…é¡»ç©·ä¸¾æ‰€æœ‰çš„å¯èƒ½**

```rust
fn main() {
    let five = Some(5);
    let six = plus_one(five);
    let none = plus_one(None);
}
fn plus_one(x: Option<i32>) -> Option<i32> {
    match x {
        None => None,
        Some(i) => Some(i + 1),
    }
}
```

#### match`_`é€šé…ç¬¦

```rust
fn main() {
    let v = 0u8;
    match v {
        1 => println!("one"),
        3 => println!("three"),
        5 => println!("five"),
        _ => (),
    }
}
```

### 6.4 if let

- å¤„ç†åªå…³å¿ƒä¸€ç§åŒ¹é…è€Œå¿½ç•¥å…¶å®ƒåŒ¹é…çš„æƒ…å†µ
- æ›´å°‘çš„ä»£ç ï¼Œæ›´å°‘çš„ç¼©è¿›ï¼Œæ›´å°‘çš„æ¨¡æ¿ä»£ç 
- æ”¾å¼ƒäº†ç©·ä¸¾çš„å¯èƒ½
- å¯ä»¥æŠŠ if let çœ‹ä½œæ˜¯ match çš„è¯­æ³•ç³–
- æ­é… else

```rust
fn main() {
    let v = Some(0u8);
    match v {
        Some(3) => println!("three"),
        _ => println!("others"),
    }
    if let Some(3) = v {
        println!("three");
    } else {
        println!("others");
    }
}
```

## 7.Packageï¼ŒCrateï¼ŒModule

### 7.1 Packageã€Crateã€å®šä¹‰ Module

#### 7.1.1 Rust çš„ä»£ç ç»„ç»‡

- ä»£ç ç»„ç»‡ä¸»è¦åŒ…æ‹¬ï¼š
  - å“ªäº›ç»†èŠ‚å¯ä»¥æš´éœ²ï¼Œå“ªäº›ç»†èŠ‚æ˜¯ç§æœ‰çš„
  - ä½œç”¨åŸŸå†…å“ªäº›åç§°æœ‰æ•ˆ
  - ...
- æ¨¡å—ç³»ç»Ÿï¼š
  - `Packageï¼ˆåŒ…ï¼‰`ï¼šCargo çš„ç‰¹æ€§ï¼Œè®©ä½ æ„å»ºã€æµ‹è¯•ã€å…±äº« crate
  - `Crateï¼ˆå•å…ƒåŒ…ï¼‰`ï¼šä¸€ä¸ªæ¨¡å—æ ‘ï¼Œå®ƒå¯äº§ç”Ÿä¸€ä¸ª library æˆ–å¯æ‰§è¡Œæ–‡ä»¶
  - `Moduleï¼ˆæ¨¡å—ï¼‰`ã€useï¼šè®©ä½ æ§åˆ¶ä»£ç çš„ç»„ç»‡ã€ä½œç”¨åŸŸã€ç§æœ‰è·¯å¾„
  - `Pathï¼ˆè·¯å¾„ï¼‰`ï¼šä¸º structã€function æˆ– module ç­‰é¡¹å‘½åçš„æ–¹å¼

#### 7.1.2 Package å’Œ Crate

- **Crate** çš„ç±»å‹ï¼š
  - **binary**ï¼ˆäºŒè¿›åˆ¶ï¼‰
  - **library**ï¼ˆåº“ï¼‰
- **Crate Root**ï¼š
  - æ˜¯æºä»£ç æ–‡ä»¶
  - Rust ç¼–è¯‘å™¨ä»è¿™é‡Œå¼€å§‹ï¼Œç»„æˆä½ çš„ Crate çš„æ ¹ Module
- ä¸€ä¸ª**Package**ï¼š
  - åŒ…å« 1 ä¸ª Cargo.tomlï¼Œå®ƒæè¿°äº†å¦‚ä½•æ„å»ºè¿™äº› Crates
  - åªèƒ½åŒ…å« 0-1 ä¸ª library crate
  - å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„ binary crate

#### 7.1.3 Cargo çš„æƒ¯ä¾‹

- src/main.rs:
  - binary crate çš„ crate root
  - crate åä¸ package åç›¸åŒ
- src/lib.rsï¼š
  - package åŒ…å«ä¸€ä¸ª library crate
  - library crate çš„ crate root
  - crate åä¸ package åç›¸åŒ
- Cargo æŠŠ crate root æ–‡ä»¶äº¤ç»™ rustc æ¥æ„å»º library æˆ– binary
- ä¸€ä¸ª Package å¯ä»¥åŒæ—¶åŒ…å« src/main.rs å’Œ src/lib.rs
  - ä¸€ä¸ª binary createï¼Œä¸€ä¸ª library create
  - åç§°ä¸ package åç›¸åŒ
- ä¸€ä¸ª Package å¯ä»¥æœ‰å¤šä¸ª binary crateï¼š
  - æ–‡ä»¶æ”¾åœ¨ï¼šsrc/bin
  - æ¯ä¸ªæ–‡ä»¶æ˜¯å•ç‹¬çš„ binary crate

#### 7.1.4 Crate çš„ä½œç”¨

- å°†ç›¸å…³åŠŸèƒ½ç»„åˆåˆ°ä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œä¾¿äºåœ¨é¡¹ç›®å°†è¿›è¡Œå…±äº«
  - é˜²æ­¢å†²çª
- ä¾‹å¦‚ rand crateï¼Œè®¿é—®å®ƒçš„åŠŸèƒ½éœ€è¦é€šè¿‡å®ƒçš„åå­—ï¼šrand

#### 7.1.5 å®šä¹‰ module æ¥æ§åˆ¶ä½œç”¨åŸŸå’Œç§æœ‰æ€§

- Moduleï¼š
  - åœ¨ä¸€ä¸ª crate å†…ï¼Œå°†ä»£ç è¿›è¡Œåˆ†ç»„
  - å¢åŠ å¯è¯»æ€§ï¼Œæ˜“äºå¤ç”¨
  - æ§åˆ¶é¡¹ç›®ï¼ˆitemï¼‰çš„ç§æœ‰æ€§ã€‚publicã€private
- å»ºç«‹ module
  - mod å…³é”®å­—
  - å¯åµŒå¥—
  - å¯åŒ…å«å…¶å®ƒé¡¹ï¼ˆstructï¼Œenumï¼Œå¸¸é‡ï¼Œtraitï¼Œå‡½æ•°ç­‰ï¼‰çš„å®šä¹‰
- src/main.rs å’Œ src/lib.rs å«åš crate rootsï¼š
  - è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼ˆä»»æ„ä¸€ä¸ªï¼‰çš„å†…å®¹å½¢æˆäº†åä¸º crate çš„æ¨¡å—ï¼Œä½äºæ•´ä¸ªæ¨¡å—æ ‘çš„æ ¹éƒ¨

```rust
mod front_of_house {
    mod hosting {
        fn add_to_waitlist() {}
        fn seat_at_table() {}
    }
    mod serving {
        fn take_order() {}
        fn serve_order() {}
        fn take_payment() {}
    }
}
```

### 7.2 è·¯å¾„

- ä¸ºäº†åœ¨ Rust çš„æ¨¡å—ä¸­æ‰¾åˆ°æŸä¸ªæ¡ç›®ï¼Œéœ€è¦ä½¿ç”¨`è·¯å¾„`ã€‚
- è·¯å¾„çš„ä¸¤ç§å½¢å¼ï¼š
  - ç»å¯¹è·¯å¾„ï¼šä» crate root å¼€å§‹ï¼Œä½¿ç”¨ crate åæˆ–å­—é¢å€¼ crate
  - ç›¸å¯¹è·¯å¾„ï¼šä»å½“å‰æ¨¡å—å¼€å§‹ï¼Œä½¿ç”¨ selfï¼Œsuper æˆ–å½“å‰æ¨¡å—çš„æ ‡è¯†ç¬¦
- è·¯å¾„è‡³å°‘ç”±ä¸€ä¸ªæ ‡è¯†ç¬¦ç»„æˆï¼Œæ ‡è¯†ç¬¦ä¹‹é—´ä½¿ç”¨::ã€‚

#### 7.2.1 ç§æœ‰è¾¹ç•Œï¼ˆprivacy boundaryï¼‰

- æ¨¡å—ä¸ä»…å¯ä»¥ç»„ç»‡ä»£ç ï¼Œè¿˜å¯ä»¥å®šä¹‰ç§æœ‰è¾¹ç•Œã€‚
- å¦‚æœæƒ³æŠŠå‡½æ•°æˆ– struct ç­‰è®¾ä¸ºç§æœ‰ï¼Œå¯ä»¥å°†å®ƒæ”¾åœ¨æŸä¸ªæ¨¡å—ä¸­ã€‚
- Rust ä¸­æ‰€æœ‰çš„æ¡ç›®ï¼ˆå‡½æ•°ï¼Œæ–¹æ³•ï¼Œstructï¼Œenumï¼Œæ¨¡å—ï¼Œå¸¸é‡ï¼‰é»˜è®¤æ˜¯ç§æœ‰çš„
- çˆ¶çº§æ¨¡å—æ— æ³•è®¿é—®å­æ¨¡å—ä¸­çš„ç§æœ‰æ¡ç›®
- å­æ¨¡å—é‡Œå¯ä»¥ä½¿ç”¨æ‰€æœ‰ç¥–å…ˆæ¨¡å—ä¸­çš„æ¡ç›®

#### 7.2.1 pub å…³é”®å­—

- ä½¿ç”¨ pub å…³é”®å­—æ¥å°†æŸäº›æ¡ç›®æ ‡è®°ä¸ºå…¬å…±çš„

```rust
mod front_of_house {
    pub mod hosting {
        pub fn add_to_waitlist() {}
    }
}
pub fn eat_at_restaurant() {
    crate::front_of_house::hosting::add_to_waitlist();
    front_of_house::hosting::add_to_waitlist();
}
```

#### 7.2.2 super å…³é”®å­—

- `super`:ç”¨æ¥è®¿é—®çˆ¶çº§æ¨¡å—è·¯å¾„ä¸­çš„å†…å®¹ï¼Œç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿä¸­çš„..

```rust
fn serve_order() {}
mod back_of_house {
    use crate::cook_order;

    fn fix_incorrect_order() {
        cook_order();
        super::serve_order(); // ç›¸å¯¹
        crate::serve_order(); // ç»å¯¹
    }
}
fn cook_order() {}
```

#### 7.2.3 pub struct å…³é”®å­—

- pub æ”¾åœ¨ struct å‰ï¼š
  - struct æ˜¯å…¬å…±çš„
  - struct çš„å­—æ®µé»˜è®¤æ˜¯ç§æœ‰çš„
- struct çš„å­—æ®µéœ€è¦å•ç‹¬è®¾ç½® pub æ¥å˜æˆå…±æœ‰

```rust
mod back_of_house {
    pub struct BreakFast {
        pub toast: String,
        seasonal_fruit: String,
    }
    impl BreakFast {
        pub fn summer(toast: &str) -> BreakFast {
            BreakFast {
                toast: String::from(toast),
                seasonal_fruit: String::from("peaches"),
            }
        }
    }
}
pub fn eat_at_restaurant() {
    let mut meal = back_of_house::BreakFast::summer("Rye");
    meal.toast= String::from("Wheat");
    println!("I'd like {} toast please", meal.toast);
    meal.seasonal_fruit = String::from("blueberries");// æŠ¥é”™
}
```

#### 7.2.4 pub enum

- pub æ”¾åœ¨ enum å‰ :
  - enum æ˜¯`å…¬å…±`çš„
  - enum çš„å˜ä½“ä¹Ÿéƒ½æ˜¯`å…¬å…±`çš„

### 7.3 use å…³é”®å­—

- å¯ä»¥ä½¿ç”¨`use`å…³é”®å­—å°†è·¯å¾„å¯¼å…¥åˆ°ä½œç”¨åŸŸå†…
  - ä»éµå¾ªç§æœ‰æ€§è§„åˆ™
- ä½¿ç”¨ use æ¥æŒ‡å®šç›¸å¯¹è·¯å¾„

#### 7.3.1 use çš„ä¹ æƒ¯ç”¨æ³•

- å‡½æ•°ï¼šå°†å‡½æ•°çš„çˆ¶çº§æ¨¡å—å¼•å…¥ä½œç”¨åŸŸï¼ˆæŒ‡å®šåˆ°çˆ¶çº§ï¼‰
- structï¼Œenumï¼Œå…¶å®ƒï¼šæŒ‡å®šå®Œæ•´è·¯å¾„ï¼ˆæŒ‡å®šåˆ°æœ¬èº«ï¼‰
- åŒåæ¡ç›®ï¼šæŒ‡å®šåˆ°çˆ¶çº§

#### 7.3.2 ä½¿ç”¨ pub use é‡æ–°å¯¼å…¥åç§°

- ä½¿ç”¨ use å°†è·¯å¾„ï¼ˆåç§°ï¼‰å¯¼å…¥åˆ°ä½œç”¨åŸŸå†…åï¼Œè¯¥åç§°åœ¨æ­¤ä½œç”¨åŸŸå†…æ˜¯`ç§æœ‰`çš„
- pub useï¼šé‡å¯¼å‡º
  - å°†æ¡ç›®å¼•å…¥ä½œç”¨åŸŸ
  - è¯¥æ¡ç›®å¯ä»¥è¢«å¤–éƒ¨ä»£ç å¼•å…¥åˆ°å®ƒä»¬çš„ä½œç”¨åŸŸ

#### 7.3.3 ä½¿ç”¨å¤–éƒ¨åŒ…ï¼ˆpackageï¼‰

1. Cargo.toml æ·»åŠ ä¾èµ–çš„åŒ…ï¼ˆpackageï¼‰

- https://crates.io/

2. use å°†ç‰¹å®šæ¡ç›®å¼•å…¥ä½œç”¨åŸŸ

- æ ‡å‡†åº“ï¼ˆstdï¼‰ä¹Ÿè¢«å½“åšå¤–éƒ¨åŒ…
  - ä¸éœ€è¦ä¿®æ”¹ Cargo.toml æ–‡ä»¶æ¥åŒ…å« std
  - éœ€è¦ä½¿ç”¨ use å°† std ä¸­çš„ç‰¹å®šæ¡ç›®å¼•å…¥å½“å‰ä½œç”¨åŸŸ

#### 7.3.4 ä½¿ç”¨`åµŒå¥—è·¯å¾„`æ¸…ç†å¤§é‡çš„ use è¯­å¥

- å¦‚æœä½¿ç”¨åŒä¸€ä¸ªåŒ…æˆ–æ¨¡å—ä¸‹çš„å¤šä¸ªæ¡ç›®ï¼ˆä¾‹å­ï¼‰
- å¯ä»¥ä½¿ç”¨åµŒå¥—è·¯å¾„åœ¨åŒä¸€è¡Œå†…å°†ä¸Šè¿°æ¡ç›®è¿›è¡Œå¼•å…¥ï¼š
  - è·¯å¾„ç›¸åŒçš„éƒ¨åˆ†::{è·¯å¾„å·®å¼‚çš„éƒ¨åˆ†}

```rust
use std::cmp::Ordering;
use std::io;
use std::{cmp::Ordering, io};
use std::io::{self,Write}
```

#### 7.3.5 é€šé…ç¬¦\*

- ä½¿ç”¨\*å¯ä»¥æŠŠè·¯å¾„ä¸­æ‰€æœ‰çš„å…¬å…±æ¡ç›®éƒ½å¼•å…¥åˆ°ä½œç”¨åŸŸ

```rust
use std::collections::*;
```

- æ³¨æ„ï¼šè°¨æ…ä½¿ç”¨
- å¼•ç”¨åœºæ™¯ï¼š
  - æµ‹è¯•ï¼Œå°†æ‰€æœ‰è¢«æµ‹è¯•ä»£ç å¼•å…¥ tests æ¨¡å—
  - æœ‰æ—¶è¢«ç”¨äºé¢„å¯¼å…¥ï¼ˆpreludeï¼‰æ¨¡å—

### 7.4 å°†æ¨¡å—æ‹†åˆ†ä¸ºä¸åŒæ–‡ä»¶

#### 7.4.1 å°†æ¨¡å—å†…å®¹ç§»åŠ¨åˆ°å…¶å®ƒæ–‡ä»¶

- æ¨¡å—å®šä¹‰æ—¶ï¼Œå¦‚æœæ¨¡å—ååè¾¹æ˜¯â€œ;â€ï¼Œè€Œä¸æ˜¯ä»£ç å—ï¼š
  - Rust ä¼šä»ä¸æ¨¡å—åŒåçš„æ–‡ä»¶ä¸­åŠ è½½å†…å®¹
  - æ¨¡å—æ ‘çš„ç»“æ„ä¸ä¼šå‘ç”Ÿå˜åŒ–
- éšç€æ¨¡å—é€æ¸å˜å¤§ï¼Œè¯¥æŠ€æœ¯è®©ä½ å¯ä»¥æŠŠæ¨¡å—çš„å†…å®¹ç§»åŠ¨åˆ°å…¶å®ƒæ–‡ä»¶ä¸­

## 8.å¸¸ç”¨çš„é›†åˆ

- Vector
- String
- HashMap

### 8.1 Vector

- `Vec<T>` å«åš vector
  - ç”±æ ‡å‡†åº“æä¾›
  - å¯å­˜å‚¨å¤šä¸ªå€¼
  - åªèƒ½å­˜å‚¨ç›¸åŒç±»å‹çš„æ•°æ®
  - å€¼åœ¨å†…å­˜ä¸­è¿ç»­å­˜æ”¾

#### 8.1.1 åˆ›å»º Vector

- Vec::new å‡½æ•°
- ` let v: Vec<i32> = Vec::new();`
- ä½¿ç”¨åˆå§‹å€¼åˆ›å»º Vec <T\>,ä½¿ç”¨ vec!å®
  - `let v = vec![1, 2, 3];`

#### 8.1.2 åˆ é™¤ Vector

- ä¸ä»»ä½•å…¶å®ƒ struct ä¸€æ ·ï¼Œä½† Vector ç¦»å¼€ä½œç”¨åŸŸå
  - å®ƒå°±è¢«æ¸…ç†æ‰äº†
  - å®ƒæ‰€æœ‰çš„å…ƒç´ ä¹Ÿè¢«æ¸…ç†æ‰äº†

#### 8.1.3 è¯»å– Vector çš„å…ƒç´ 

- `ä¸¤ç§æ–¹å¼å¯ä»¥å¼•ç”¨`Vector é‡Œçš„å€¼
  - ç´¢å¼•
  - get æ–¹æ³•

```rust
fn main() {
    let v = vec![1, 2, 3, 4, 5];
    let third: &i32 = &v[1];
    println!("The third element is {}", third);
    match v.get(2) {
        Some(third) => println!("The third element is {}", third),
        None => println!("The is no third element"),
    }
}
```

#### 8.1.4 æ‰€æœ‰æƒå’Œå€Ÿç”¨è§„åˆ™

- ä¸èƒ½åœ¨ç»Ÿä¸€ä½œç”¨åŸŸå†…åŒæ—¶æ‹¥æœ‰å¯å˜å’Œä¸å¯å˜å¼•ç”¨

```rust
fn main() {
    let mut v = vec![1, 2, 3, 4, 5];
    let first = &v[0];
    v.push(6);// æŠ¥é”™
    println!("The first element is {}", first);
}
```

#### 8.1.5 éå† Vector ä¸­çš„å€¼

```rust
fn main() {
    let mut v = vec![100, 32, 57];
    for i in &mut v {
        // * æ˜¯å–è¿™ä¸ªåœ°å€çš„å€¼
        *i += 50;
        println!("{}", i);
    }
}
```

### 8.2 Vector-ä¾‹å­

#### 8.2.1 ä½¿ç”¨ enum æ¥å­˜å‚¨å¤šç§æ•°æ®ç±»å‹

- Enum çš„å˜ä½“å¯ä»¥é™„åŠ ä¸åŒç±»å‹çš„æ•°æ®
- Enum çš„å˜ä½“å®šä¹‰åœ¨åŒä¸€ä¸ª enum ç±»å‹ä¸‹

```rust
enum SpreadsheetCell {
    Int(i32),
    Float(f64),
    Text(String),
}
fn main() {
    let row = vec![
        SpreadsheetCell::Int(3),
        SpreadsheetCell::Text(String::from("blue")),
        SpreadsheetCell::Float(10.12),
    ];
}
```

### 8.3 String

#### 8.3.1 Rust å¼€å‘è€…ç»å¸¸ä¼šè¢«å­—ç¬¦ä¸²å›°æ‰°çš„åŸå› 

- Rust å€¾å‘äºæš´éœ²å¯èƒ½çš„é”™è¯¯
- å­—ç¬¦ä¸²æ•°æ®ç»“æ„å¤æ‚
- UTF-8

#### 8.3.2 å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆ

- Byte çš„é›†åˆ
  - ä¸€äº›æ–¹æ³•
    - èƒ½å°† byte è§£æä¸ºæ–‡æœ¬
- Rust çš„`æ ¸å¿ƒè¯­è¨€å±‚é¢`,åªæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹:å­—ç¬¦ä¸²åˆ‡ç‰‡`str`(æˆ–&str)
- å­—ç¬¦ä¸²åˆ‡ç‰‡:å¯¹å­˜å‚¨åœ¨å…¶å®ƒåœ°æ–¹ UTF-8 ç¼–ç çš„å­—ç¬¦ä¸²çš„å¼•ç”¨
  - å­—ç¬¦ä¸²å­—é¢å€¼:å­˜å‚¨åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­,ä¹Ÿæ˜¯å­—ç¬¦ä¸²åˆ‡ç‰‡
- `String`ç±»å‹:
  - æ¥è‡ª`æ ‡å‡†åº“`è€Œä¸æ˜¯æ ¸å¿ƒè¯­è¨€
  - å¯å¢é•¿,å¯ä¿®æ”¹,å¯æ‹¥æœ‰

#### 8.3.3 é€šå¸¸è¯´çš„å­—ç¬¦ä¸²æ˜¯æŒ‡?

- String å’Œ&str
  - æ ‡å‡†åº“é‡Œç”¨çš„å¤š
  - UTF-8 ç¼–ç 
- æœ¬èŠ‚è¯¾è®²çš„ä¸»è¦æ˜¯ String

#### 8.3.4 å…¶å®ƒç±»å‹çš„å­—ç¬¦ä¸²

- Rust çš„æ ‡å‡†åº“è¿˜åŒ…å«äº†å¾ˆå¤šå…¶å®ƒçš„å­—ç¬¦ä¸²ç±»å‹,ä¾‹å¦‚:OsString,OsStr,CString,CStr
  - String vs Str åç¼€:æ‹¥æœ‰æˆ–å€Ÿç”¨çš„å˜ä½“
  - å¯å­˜å‚¨ä¸åŒç¼–ç çš„æ–‡æœ¬æˆ–åœ¨å†…å­˜ä¸­ä»¥ä¸åŒçš„å½¢å¼å±•ç¤º
- Library crate é’ˆå¯¹å­˜å‚¨å­—ç¬¦ä¸²å¯æä¾›æ›´å¤šçš„é€‰é¡¹

#### 8.3.5 åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²(String)

- å¾ˆå¤š`Vec<T>`çš„æ“ä½œéƒ½å¯ä»¥ç”¨äº String.
- String::new()å‡½æ•°
- ä½¿ç”¨åˆå§‹å€¼æ¥åˆ›å»º String:
  - to_string()æ–¹æ³•,å¯ç”¨äºå®ç°äº† Display trait çš„ç±»å‹,åŒ…æ‹¬å­—ç¬¦ä¸²å­—é¢å€¼(ä¾‹å­)
  - String::from()å‡½æ•°,ä»å­—é¢é‡åˆ›å»º String(ä¾‹å­)

```rust
fn main() {
    // let mut s = String::new();
    let data = "initial contents";
    let s = data.to_string();
    let s1 = "initial contents".to_string();
    let s = String::from("initial contents");
}
```

#### 8.3.6 æ›´æ–° String

- push_str()æ–¹æ³•:æŠŠä¸€ä¸ªå­—ç¬¦ä¸²åˆ‡ç‰‡é™„åŠ åˆ° String(ä¾‹å­)
- push æ–¹æ³•:æŠŠå•ä¸ªå­—ç¬¦é™„åŠ åˆ° String
- - è¿æ¥å­—ç¬¦ä¸²
  * ä½¿ç”¨äº†ç±»ä¼¼è¿™ä¸ªç­¾åçš„æ–¹æ³• fn add(slef,s:&str) -> { ... }
    - æ ‡å‡†åº“ä¸­çš„ add æ–¹æ³•ä½¿ç”¨äº†æ³›å‹
    - åªèƒ½æŠŠ&str æ·»åŠ åˆ° String
    - è§£å¼•ç”¨å¼ºåˆ¶è½¬æ¢(deref coercion)
- format!:è¿æ¥å¤šä¸ªå­—ç¬¦ä¸²(ä¾‹å­)

```rust
fn main() {
    let mut s = String::from("foo");
    let s1 = String::from("bar");
    s.push_str(&s1);
    s.push('h');
    println!("{}", s);
    let a = String::from("aaaaa");
    let b = String::from("BBBBB");
    let c = a + &b;
    println!("{}", c);// aaaaaBBBBB
    println!("{}", a); // æŠ¥é”™
    println!("{}", b);
    println!("{}", c);
}
```

```rust
fn main() {
    let s1 = String::from("tic");
    let s2 = String::from("tac");
    let s3 = String::from("toe");
    // let s3 = s1 + "-" + &*s2 + "-" + &s3;
    // println!("{}", s3);
    let s = format!("{}-{}-{}", s1, s2, s3);
    println!("{}", s)
}
```

#### 8.3.7 å¯¹ String æŒ‰ç´¢å¼•çš„å½¢å¼è¿›è¡Œè®¿é—®

- æŒ‰ç´¢å¼•è¯­æ³•è®¿é—® String çš„æŸéƒ¨åˆ†,ä¼šæŠ¥é”™
- Rust çš„å­—ç¬¦ä¸²ä¸æ”¯æŒç´¢å¼•è¯­æ³•è®¿é—®

#### 8.3.8 String ç±»å‹çš„å†…éƒ¨è¡¨ç¤º

- String æ˜¯å¯¹`Vec<u8>`çš„åŒ…è£…

#### 8.3.9 å­—èŠ‚,æ ‡é‡å€¼,å­—å½¢ç°‡

**Bytes,Scalar,Grapheme Clusters**

- Rust æœ‰ä¸‰ç§çœ‹å¾…å­—ç¬¦ä¸²çš„æ–¹å¼:
  - å­—èŠ‚ bytes
  - æ ‡é‡å€¼ chars
  - å­—å½¢ç°‡
- Rust ä¸å…è®¸å¯¹ String è¿›è¡Œç´¢å¼•çš„æœ€åä¸€ä¸ªåŸå› :
  - ç´¢å¼•æ“ä½œåº”æ¶ˆè€—ä¸€ä¸ª v é¢äº§é‡æ—¶é—´(O(1))
  - è€Œ String æ— æ³•ä¿è¯:éœ€è¦éå†æ‰€æœ‰å†…å®¹,æ¥ç¡®å®šç”±å¤šå°‘ä¸ªåˆæ³•çš„å­—ç¬¦.

#### 8.3.10 åˆ‡å‰² String

- å¯ä»¥ä½¿ç”¨`[]`å’Œ`ä¸€ä¸ªèŒƒå›´`æ¥åˆ›å»ºå­—ç¬¦ä¸²çš„åˆ‡ç‰‡
  - å¿…é¡»è°¨æ…ä½¿ç”¨
  - å¦‚æœåˆ‡å‰²æ—¶è·¨è¶Šäº†å­—ç¬¦è¾¹ç•Œ,ç¨‹åºå°±ä¼š panic
  - `(b1,b2),(b3,`b3)(b4,b5),(b7,b7)
    - panic

#### 8.3.11 éå† String çš„æ–¹æ³•

- å¯¹äºæ ‡é‡å€¼:chars()æ–¹æ³•
- å¯¹äºå­—èŠ‚:bytes()æ–¹æ³•
- å¯¹äºå­—å½¢ç°‡:å¾ˆå¤æ‚,æ ‡å‡†åº“æœªæä¾›

```rust
fn main() {
    let w = "å“ˆå“ˆå“ˆ";
    for b in w.bytes() {
        println!("{}", b);
    }
    for b in w.chars() {
        println!("{}", b);
    }
}
```

**String ä¸ç®€å•**

- Rust é€‰æ‹©å°†æ­£ç¡®å¤„ç† String æ•°æ®ä½œä¸ºæ‰€æœ‰ Rust ç¨‹åºçš„é»˜è®¤è¡Œä¸º
  - ç¨‹åºå‘˜å¿…é¡»åœ¨å¤„ç† UTF-8 æ•°æ®ä¹‹å‰æŠ•å…¥æ›´å¤šçš„ç²¾åŠ›
- å¯é˜²æ­¢åœ¨å¼€å‘åæœŸå¤„ç†æ¶‰åŠé ASCII å­—ç¬¦çš„é”™è¯¯

### 8.4 HashMap

**`HashMap<K,v>`**

- é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨æ•°æ®,ä¸€ä¸ªé”®(Key)å¯¹åº”ä¸€ä¸ªå€¼(value)
- Hash å‡½æ•°:å†³å®šå¦‚ä½•åœ¨å†…å­˜ä¸­å­˜æ”¾ K å’Œ V

#### 8.4.1 åˆ›å»º HashMap

- åˆ›å»ºç©º HashMap:new()å‡½æ•°
- æ·»åŠ æ•°æ®:insert()æ–¹æ³•
- HashMap ç”¨çš„è¾ƒå°‘,ä¸åœ¨ prelude ä¸­
- æ ‡å‡†åº“å¯¹å…¶æ”¯æŒè¾ƒå°‘,æ²¡æœ‰å†…ç½®çš„å®æ¥åˆ›å»º HashMap
- æ•°æ®å­˜å‚¨åœ¨ heap ä¸Š
- åŒæ„çš„, ä¸€ä¸ª HashMap ä¸­:
  - æ‰€æœ‰çš„ K å¿…é¡»æ˜¯åŒä¸€ç§ç±»å‹
  - æ‰€æœ‰çš„ V å¿…é¡»æ˜¯åŒä¸€ç§ç±»å‹

```rust
use std::collections::HashMap;

fn main() {
    // let mut scores: HashMap<String, i32> = HashMap::new();
    let mut scores = HashMap::new();
    scores.insert(String::from("Blue"), 10);
    scores.insert(String::from("yellow"), 50);
}
```

#### 8.4.2 å¦ä¸€ç§åˆ›å»º HashMap çš„æ–¹å¼:collect æ–¹æ³•

- åœ¨å…ƒç´ ç±»å‹ä¸º Tuple çš„ Vector ä¸Šä½¿ç”¨ collect æ–¹æ³•,å¯ä»¥ç»„å»ºä¸€ä¸ª HashMap:
  - è¦æ±‚ Tuple æœ‰ä¸¤ä¸ªå€¼:ä¸€ä¸ªä½œä¸º K,ä¸€ä¸ªä½œä¸º V
  - collect æ–¹æ³•å¯ä»¥æŠŠæ•°æ®æ•´åˆæˆå¾ˆå¤šç§é›†åˆç±»å‹,åŒ…æ‹¬ HashMap
    - è¿”å›å€¼éœ€è¦æ˜¾å¼æŒ‡æ˜ç±»å‹

```rust
use std::collections::HashMap;

fn main() {
    let teams = vec![String::from("Blue"), String::from("Yellow")];
    let intial_scores = vec![10, 50];
    let scores: HashMap<_, _> = teams.iter().zip(intial_scores.iter()).collect();
}
```

#### 8.4.3 HashMap å’Œæ‰€æœ‰æƒ

- å¯¹äºå®ç°äº† Copy trait çš„ç±»å‹(ä¾‹å¦‚ i32),å€¼ä¼šè¢«å¤åˆ¶åˆ° HashMap ä¸­
- å¯¹äºæ‹¥æœ‰æ‰€æœ‰æƒçš„å€¼(ä¾‹å¦‚ String),å€¼ä¼šè¢«ç§»åŠ¨,æ‰€æœ‰æƒä¼šè½¬ç§»ç»™ HashMap
- å¦‚æœå°†å€¼çš„å¼•ç”¨æ’å…¥åˆ° HashMap,å€¼æœ¬èº«ä¸ä¼šç§»åŠ¨

```rust
fn main() {
    let field_name = String::from("Favorite color");
    let field_value = String::from("Blue");
    let mut map = HashMap::new();
    // ä½¿ç”¨è¿™ç§æ–¹å¼æ’ä¸ä¼šä¸§å¤±æ‰€æœ‰æƒ
    // map.insert(&field_name, &field_value);
    // ä¸§å¤±æ‰€æœ‰æƒ,å†æ¬¡è°ƒç”¨ä¼šæŠ¥é”™
    map.insert(field_name, field_value);
    // println!("{}", field_name); // æŠ¥é”™
}
```

#### 8.4.4 è®¿é—® HashMap ä¸­çš„å€¼

- get æ–¹æ³•
  - å‚æ•°ï¼šK
  - è¿”å›ï¼š`Option<&V>`

```rust
use std::collections::HashMap;
fn main() {
    let mut scores = HashMap::new();
    scores.insert(String::from("Blue"), 10);
    scores.insert(String::from("Yellow"), 50);
    let team_name = String::from("Blue");
    let score = scores.get(&team_name);
    match score {
        Some(s) => println!("{}", s),
        None => println!("team not exist"),
    }
}
```

#### 8.4.5 éå† HashMap

- for å¾ªç¯

```rust
for (k, v) in &scores {
    println!("{}:{}", k, v);
}
```

#### 8.4.6 æ›´æ–° HashMap<K,V>

- HashMap å¤§å°å¯å˜
- æ¯ä¸ª K åŒæ—¶åªèƒ½å¯¹åº”ä¸€ä¸ª V
- æ›´æ–° HashMap ä¸­çš„æ•°æ®ï¼š
  - K å·²ç»å­˜åœ¨ï¼Œå¯¹åº”ä¸€ä¸ª V
    - æ›¿æ¢ç°æœ‰çš„ V
    - ä¿ç•™ç°æœ‰çš„ Vï¼Œå¿½ç•¥æ–°çš„ V
    - åˆå¹¶ç°æœ‰çš„ V å’Œæ–°çš„ V

**æ›¿æ¢ç°æœ‰çš„ V**

- å¦‚æœå‘ HashMap æ’å…¥ä¸€å¯¹ KVï¼Œç„¶åå†æ’å…¥åŒæ ·çš„ Kï¼Œä½†æ˜¯ä¸åŒçš„ Vï¼Œé‚£ä¹ˆåŸæ¥çš„ V ä¼šè¢«æ›¿æ¢æ‰

```rust
fn main() {
   let mut scores = HashMap::new();
   scores.insert(String::from("Blue"), 10);
   scores.insert(String::from("Blue"), 25);
   println!("{:?}", scores);
}
```

**åªæœ‰ K ä¸å¯¹åº”ä»»ä½•å€¼å¾—æƒ…å†µä¸‹ï¼Œæ‰æ’å…¥ V**

- entry æ–¹æ³•ï¼šæ£€æŸ¥æŒ‡å®šå¾— K æ˜¯å¦å¯¹åº”ä¸€ä¸ª V
  - å‚æ•°ä¸º K
  - è¿”å› enum Entryï¼šä»£è¡¨å€¼æ˜¯å¦å­˜åœ¨

## 9.é”™è¯¯å¤„ç†

### 9.1 panic! ä¸å¯æ¢å¤çš„é”™è¯¯

**Rust é”™è¯¯å¤„ç†æ¦‚è¿°**

- Rust çš„å¯é æ€§ï¼šé”™è¯¯å¤„ç†
  - å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼šåœ¨ç¼–è¯‘æ—¶æç¤ºé”™è¯¯ï¼Œå¹¶å¤„ç†
- é”™è¯¯çš„åˆ†ç±»ï¼š
  - å¯å›å¤
    - ä¾‹å¦‚æ–‡ä»¶æœªæ‰¾åˆ°ï¼Œå¯å†æ¬¡å°è¯•
  - ä¸å¯æ¢å¤
    - bugï¼Œä¾‹å¦‚è®¿é—®çš„ç´¢å¼•è¶…å‡ºèŒƒå›´
  - Rust æ²¡æœ‰ç±»ä¼¼å¼‚å¸¸çš„æœºåˆ¶
    - å¯æ¢å¤é”™è¯¯ï¼šResult<T,E\>
    - ä¸å¯æ¢å¤ï¼španic!å®

#### 9.1.1 ä¸å¯æ¢å¤çš„é”™è¯¯ä¸ panic!

- å½“ panic!å®æ‰§è¡Œ
  - ä½ çš„ç¨‹åºä¼šæ‰“å°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯
  - å±•å¼€(unwind)ã€æ¸…ç†è°ƒç”¨æ ˆï¼ˆStackï¼‰
  - é€€å‡ºç¨‹åº

#### 9.1.2 ä¸ºåº”å¯¹ panicï¼Œå±•å¼€æˆ–ç»ˆæ­¢(abort)è°ƒç”¨æ ˆ

- é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ panic å‘ç”Ÿï¼š
  - ç¨‹åºå±•å¼€è°ƒç”¨æ ˆ(å·¥ä½œé‡å¤§)
    - Rust æ²¿ç€è°ƒç”¨æ ˆå¾€å›èµ°
    - æ¸…ç†æ¯ä¸ªé‡åˆ°çš„å‡½æ•°ä¸­çš„æ•°æ®
  - æˆ–ç«‹å³ä¸­æ­¢è°ƒç”¨æ ˆï¼š
    - ä¸è¿›è¡Œæ¸…ç†ï¼Œç›´æ¥åœç”¨ç¨‹åº
    - å†…å­˜éœ€è¦ OS è¿›è¡Œæ¸…ç†
- æƒ³è®©äºŒè¿›åˆ¶æ–‡ä»¶æ›´å°ï¼ŒæŠŠè®¾ç½®ä»â€å±•å¼€â€œæ”¹ä¸ºâ€ä¸­æ­¢â€œ
  - åœ¨ Cargo.toml ä¸­é€‚å½“çš„ profile éƒ¨åˆ†è®¾ç½®ï¼š
    - panic = 'abort'

```rust
fn main() {
    // panic!("crash and burn");
    let v = vec![1, 2, 3];
    println!("{}", v[99]);
}
```

#### 9.1.3 ä½¿ç”¨ panic!äº§ç”Ÿçš„å›æº¯ä¿¡æ¯

- panic!å¯èƒ½å‡ºç°åœ¨ï¼š
  - æˆ‘ä»¬å†™çš„ä»£ç ä¸­
  - æˆ‘ä»¬æ‰€ä¾èµ–çš„ä»£ç ä¸­
- å¯é€šè¿‡è°ƒç”¨ panic!çš„å‡½æ•°çš„å›æº¯ä¿¡æ¯æ¥å®šä½å¼•èµ·é—®é¢˜çš„ä»£ç 
- é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ RUST_BACKTRACE å¯å¾—åˆ°å›æº¯ä¿¡æ¯(ç›´æ¥ç¼–è¯‘å™¨ run ä¹Ÿè¡Œ)
- ä¸ºäº†è·å–å¸¦æœ‰è°ƒè¯•ä¿¡æ¯å¾—å›æº¯ï¼Œå¿…é¡»å¯ç”¨è°ƒè¯•ç¬¦å·ï¼ˆä¸å¸¦ --releaseï¼‰

### 9.2 Result ä¸å¯æ¢å¤çš„é”™è¯¯

#### 9.2.1 Result æšä¸¾

```rust
enum Result<T,E> {
  Ok(T),
  Err(E)
}
```

- T:æ“ä½œæˆåŠŸæƒ…å†µä¸‹ï¼ŒOk å˜ä½“é‡Œè¿”å›çš„æ•°æ®çš„ç±»å‹
- Errï¼šæ“ä½œå¤±è´¥æƒ…å†µä¸‹ï¼ŒErr å˜ä½“é‡Œè¿”å›çš„é”™è¯¯çš„ç±»å‹

```rust
fn main() {
    let f = File::open("hello.txt");
}
```

#### 9.2.2 å¤„ç† Result çš„ä¸€ç§æ–¹å¼ï¼šmatch è¡¨è¾¾å¼

- å’Œ Option æšä¸¾ä¸€æ ·ï¼ŒResult åŠå…¶å˜ä½“ä¹Ÿæ˜¯ç”± prelude å¸¦å…¥ä½œç”¨åŸŸ

```rust
use std::{fs::File, io::ErrorKind};

fn main() {
    let f = File::open("hello.txt");
    let f = match f {
        Ok(file) => file,
        Err(error) => match error.kind() {
            ErrorKind::NotFound => match File::create("hello.txt") {
                Ok(fc) => fc,
                Err(e) => panic!("Error creating file:{:?}", e),
            },
            other_error => panic!("Error opening the file:{:?}", other_error),
        },
    };
}
```

**åŒ¹é…ä¸åŒçš„é”™è¯¯**

- ä¸Šé¢çš„ä¾‹å­ä¸­ä½¿ç”¨äº†å¾ˆå¤š match
- match å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯å¾ˆåŸå§‹
- é—­åŒ…ï¼ˆclosureï¼‰ã€‚Result<T,E\>æœ‰å¾ˆå¤šæ–¹æ³•ï¼š
  - å®ƒä»¬æ¥æ”¶é—­åŒ…ä½œä¸ºå‚æ•°
  - ä½¿ç”¨ match å®ç°
  - ä½¿ç”¨æ–°çš„æ–¹æ³•ä¼šä½¿ä»£ç å˜å¾—æ›´åŠ ç®€æ´

**unwrap**

- unwrapï¼šmatch è¡¨è¾¾å¼çš„ä¸€ä¸ªå¿«æ·æ–¹æ³•ï¼š
  - å¦‚æœ Result ç»“æœæ˜¯ Okï¼Œè¿”å› Ok é‡Œé¢çš„å€¼
  - å¦‚æœ Result ç»“æœæ˜¯ Errï¼Œè°ƒç”¨ panic!å®

```rust
use std::{fs::File, io::ErrorKind};

fn main() {
    let f = File::open("hello.txt").unwrap_or_else(|error| {
        if error.kind() == ErrorKind::NotFound {
            File::create("hello.txt").unwrap_or_else(|error| {
                panic!("Error creating file:{:?}", error);
            })
        } else {
            panic!("Error opening file:{:?}", error);
        }
    });
    println!("{:?}", f);
}
```

**expect**

- expectï¼šå’Œ unwrap ç±»ä¼¼ï¼Œä½†å¯æŒ‡å®šé”™è¯¯ä¿¡æ¯

#### 9.2.3 ä¼ æ’­é”™è¯¯

- åœ¨å‡½æ•°å‡ºå¤„å¤„ç†é”™è¯¯
- å°†é”™è¯¯è¿”å›ç»™è°ƒç”¨è€…

```rust
fn read_username_from_file() -> Result<String, io::Error> {
    let f = File::open("hello.txt");
    let mut f = match f {
        Ok(file) => file,
        Err(e) => return Err(e),
    };
    let mut s = String::new();
    match f.read_to_string(&mut s) {
        Ok(_) => Ok(s),
        Err(e) => Err(e),
    }
}
```

**?è¿ç®—ç¬¦**

- ?è¿ç®—ç¬¦ï¼šä¼ æ’­é”™è¯¯çš„ä¸€ç§å¿«æ·æ–¹å¼
- å¦‚æœ Result æ˜¯ Okï¼šOk ä¸­çš„å€¼å°±æ˜¯è¡¨è¾¾å¼çš„ç»“æœï¼Œç„¶åç»§ç»­æ‰§è¡Œç¨‹åº
- å¦‚æœ Result æ˜¯ Errï¼šErr å°±æ˜¯æ•´ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œå°±åƒä½¿ç”¨äº† return

```rust
fn read_username_from_file() -> Result<String, io::Error> {
    let mut f = File::open("hello.txt")?;
    let mut s = String::new();
    f.read_to_string(&mut s)?;
    Ok(s)
}
```

**?ä¸ from å‡½æ•°**

- Trait std::convert::From ä¸Šçš„ from å‡½æ•°ï¼š
  - ç”¨äºé”™è¯¯ä¹‹é—´çš„è½¬æ¢
- è¢«?æ‰€åº”ç”¨çš„é”™è¯¯ï¼Œä¼šéšå¼çš„è¢« from å‡½æ•°å¤„ç†
- å½“?è°ƒç”¨ from å‡½æ•°æ—¶ï¼š
  - å®ƒæ‰€æ¥æ”¶çš„æ‰€æ‚Ÿç±»å‹ä¼šè¢«è½¬æ¢ä¸ºå½“å‰å‡½æ•°è¿”å›ç±»å‹æ‰€å®šä¹‰çš„é”™è¯¯ç±»å‹
- ç”¨äºï¼šé’ˆå¯¹ä¸åŒé”™è¯¯åŸå› ï¼Œè¿”å›åŒä¸€ç§é”™è¯¯ç±»å‹
  - åªè¦æ¯ä¸ªé”™è¯¯ç±»å‹å®ç°äº†è½¬æ¢ä¸ºæ‰€è¿”å›çš„é”™è¯¯ç±»å‹çš„ from å‡½æ•°

**é“¾å¼è°ƒç”¨**

```rust
fn read_username_from_file() -> Result<String, io::Error> {
    let mut s = String::new();
    File::open("hello.txt")?.read_to_string(&mut s)?;
    Ok(s)
}
```

**?è¿ç®—ç¬¦åªèƒ½ç”¨äºè¿”å› Result çš„å‡½æ•°**

- æœ€åˆ main å‡½æ•°è¿”å›çš„ç±»å‹æ˜¯ï¼š()
- main å‡½æ•°ç±»å‹ä¹Ÿå¯ä»¥æ˜¯ Result
- Box<dyn Error\> æ˜¯ trait å¯¹è±¡

```rust
fn main() {
    let f = File::open("hello.txt")?;
}
use std::{error::Error, fs::File};

fn main() -> Result<(), Box<dyn Error>> {
    let f = File::open("hello.txt")?;
    Ok(())
}
```

### 9.4 ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ panic!

æ€»ä½“åŸåˆ™

- åœ¨å®šä¹‰ä¸€ä¸ªå¯èƒ½å¤±è´¥çš„å‡½æ•°æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘è¿”å› Result
- å¦åˆ™å°± panic!

#### 9.4.1 ç¼–å†™å®ä¾‹ã€åŸå‹ä»£ç ã€æµ‹è¯•

- å¯ä»¥ä½¿ç”¨ panic!
  - æ¼”ç¤ºæŸäº›æ¦‚å¿µï¼šunwrap
  - åŸå‹ä»£ç ï¼šunwrapã€expect
  - æµ‹è¯•ï¼šunwrapã€expect

**æœ‰æ—¶å€™ä½ æ¯”ç¼–è¯‘å™¨æŒæ¡æ›´å¤šçš„ä¿¡æ¯**

- ä½ å¯ä»¥ç¡®å®š Result å°±æ˜¯ Okï¼šunwrap
- ä¾‹å­

```rust
use std::net::IpAddr;
fn main() {
    let home: IpAddr = "127.0.0.1".parse().unwrap();
}
```

**é”™è¯¯å¤„ç†çš„æŒ‡å¯¼æ€§å»ºè®®**

- å½“ä»£ç æœ€ç»ˆå¯èƒ½å¤„äºæŸåçŠ¶æ€æ—¶ï¼Œæœ€å¥½ä½¿ç”¨ panic!
- æŸåçŠ¶æ€ï¼ˆBad stateï¼‰ï¼šæŸäº›å‡è®¾ã€ä¿è¯ã€çº¦å®šæˆ–ä¸å¯å˜æ€§è¢«æ‰“ç ´
  - ä¾‹å¦‚éæ³•çš„å€¼ã€çŸ›ç›¾çš„å€¼æˆ–ç©ºç¼ºçš„å€¼è¢«ä¼ å…¥ä»£ç 
  - ä»¥åŠä¸‹åˆ—ä¸­çš„ä¸€æ¡
    - è¿™ç§æŸåçŠ¶æ€å¹¶ä¸æ˜¯é¢„æœŸèƒ½å¤Ÿå¶å°”å‘ç”Ÿçš„äº‹æƒ…ã€‚
    - åœ¨æ­¤ä¹‹åï¼Œæ‚¨çš„ä»£ç å¦‚æœå¤„äºè¿™ç§æŸåçŠ¶æ€å°±æ— æ³•è¿è¡Œ
    - åœ¨æ‚¨ä½¿ç”¨çš„ç±»å‹ä¸­æ²¡æœ‰ä¸€ä¸ªå¥½çš„æ–¹æ³•æ¥å°†è¿™äº›ä¿¡æ¯ï¼ˆå‡ºå…¥æŸåçŠ¶æ€ï¼‰è¿›è¡Œç¼–ç ã€‚

**åœºæ™¯å»ºè®®**

- è°ƒç”¨ä½ çš„ä»£ç ï¼Œä¼ å…¥æ— æ„ä¹‰çš„å‚æ•°å€¼ï¼španic!
- è°ƒç”¨å¤–éƒ¨ä¸å¯æ§ä»£ç ï¼Œè¿”å›éæ³•çŠ¶æ€ï¼Œä½ æ— æ³•ä¿®å¤ï¼španic!
- å¦‚æœå¤±è´¥æ˜¯å¯é¢„æœŸçš„ï¼šResult
- å½“ä½ çš„ä»£ç å¯¹å€¼è¿›è¡Œæ“ä½œï¼Œé¦–å…ˆåº”è¯¥éªŒè¯è¿™äº›å€¼ï¼španic!

**ä¸ºéªŒè¯åˆ›å»ºè‡ªå®šä¹‰ç±»å‹**

- åˆ›å»ºæ–°çš„ç±»å‹ï¼ŒæŠŠéªŒè¯é€»è¾‘æ”¾åœ¨æ„é€ å®ä¾‹çš„å‡½æ•°é‡Œã€‚
- getter: è¿”å›å­—æ®µæ•°æ®
  - å­—æ®µæ˜¯ç§æœ‰çš„ï¼ˆä¸‹ä¾‹ä¸­ï¼‰ï¼šå¤–éƒ¨æ— æ³•ç›´æ¥å¯¹å­—æ®µèµ‹å€¼

```rust
pub struct Guess {
    value: i32,
}

impl Guess {
    pub fn new(value: i32) -> Guess {
        if value < 1 || value > 100 {
            panic!("Guess value must be between 1 and 100 , got {}", value);
        }
        Guess { value }
    }
    pub fn value(&self) -> i32 {
        self.value
    }
}

fn main() {
    loop {
        // todo...
        let guess = "32";
        let guess: i32 = match guess.trim().parse() {
            Ok(num) => num,
            Err(_) => continue,
        };

        let guess = Guess::new(guess);
        // todo...
    }
}
```

## 10 æ³›å‹ï¼ŒTraitï¼Œç”Ÿå‘½å‘¨æœŸ

### 10.1 æå–å‡½æ•°æ¶ˆé™¤é‡å¤çš„ä»£ç 

- é‡å¤ä»£ç çš„å±å®³ï¼š
  - å®¹æ˜“å‡ºé”™
  - éœ€æ±‚å˜æ›´æ—¶éœ€è¦åœ¨å¤šå¤„è¿›è¡Œä¿®æ”¹
- æ¶ˆé™¤é‡å¤ï¼šæå–å‡½æ•°

```rust
fn largest(list: &[i32]) -> i32 {
    let mut largest = list[0];
    for &item in list {
        if item > largest {
            largest = item;
        }
    }
    largest
}

fn main() {
    let number_list = vec![34, 50, 25, 100, 65];
    let result = largest(&number_list);
    println!("The largest number is {}", result);
    let number_list = vec![34, 50, 25, 6000, 65];
    let result = largest(&number_list);
    println!("The largest number is {}", result);
}
```

**æ¶ˆé™¤é‡å¤çš„æ­¥éª¤**

- è¯†åˆ«é‡å¤ä»£ç 
- æå–é‡å¤ä»£ç åˆ°å‡½æ•°ä½“ä¸­ï¼Œå¹¶åœ¨å‡½æ•°ç­¾åä¸­æŒ‡å®šå‡½æ•°çš„è¾“å…¥å’Œè¿”å›å€¼
- å°†é‡å¤çš„ä»£ç ä½¿ç”¨å‡½æ•°è°ƒç”¨è¿›è¡Œæ›¿ä»£

### 10.2 æ³›å‹

- æ³›å‹ï¼šæé«˜ä»£ç `å¤ç”¨`èƒ½åŠ›
  - å¤„ç†é‡å¤ä»£ç çš„é—®é¢˜
- æ³›å‹æ˜¯å…·ä½“ç±»å‹æˆ–å…¶å®ƒå±æ€§çš„æŠ½è±¡ä»£æ›¿ï¼š
  - ä½ ç¼–å†™çš„ä»£ç ä¸æ˜¯æœ€ç»ˆçš„ä»£ç ï¼Œè€Œæ˜¯ä¸€ç§`æ¨¡æ¿`ï¼Œé‡Œé¢æœ‰ä¸€äº›`å ä½ç¬¦`ã€‚
    ç¼–è¯‘å™¨åœ¨`ç¼–è¯‘æ—¶`å°†â€å ä½ç¬¦â€œ`æ›¿æ¢ä¸ºå…·ä½“çš„ç±»å‹`ã€‚
- ä¾‹å¦‚ï¼šfn largest<T\>(list:&[T]) -> T{ ... }
- ç±»å‹å‚æ•°ï¼š
  - å¾ˆçŸ­ï¼Œé€šå¸¸ä¸€ä¸ªå­—æ¯
  - CamelCase
  - Tï¼štype çš„ç¼©å†™

#### 10.2.1 å‡½æ•°å®šä¹‰ä¸­çš„æ³›å‹

- æ³›å‹å‡½æ•°ï¼š
  - å‚æ•°ç±»å‹
  - è¿”å›ç±»å‹

ä¾‹å­æœ‰ç‚¹å°é—®é¢˜ï¼Œä½†å’Œ typescript å·®ä¸å¤š

```rust
fn largest<T: std::cmp::PartialOrd>(list: &[T]) -> T {
    let mut largest = list[0];
    for &item in list {
        if item > largest {
            largest = item;
        }
    }
    largest
}

fn main() {
    let number_list = vec![34, 50, 25, 100, 65];
    let result = largest(&number_list);
    println!("The largest number is {}", result);
    let char_list = vec!['y', 'm', 'a', 'q'];
    let result = largest(&char_list);
    println!("The largest char is {}", result);
}
```

#### 10.2.2 Struct ä¸­å®šä¹‰çš„æ³›å‹

- å¯ä»¥ä½¿ç”¨å¤šä¸ªæ³›å‹çš„ç±»å‹å‚æ•°
  - å¤ªå¤šç±»å‹å‚æ•°ï¼šä½ çš„ä»£ç éœ€è¦é‡ç»„ä¸ºå¤šä¸ªæ›´å°çš„å•å…ƒ

```rust
struct Point<T> {
    x: T,
    y: T,
}
fn main() {
    let integer = Point { x: 5, y: 10 };
    let float = Point { x: 1.0, y: 4.0 };
}
```

#### 10.2.3 Enum å®šä¹‰ä¸­çš„æ³›å‹

- å¯ä»¥è®©æšä¸¾çš„å˜ä½“æŒæœ‰æ³›å‹æ•°æ®ç±»å‹
  - ä¾‹å¦‚ Option<T\>,Result<T,E\>

```rust
enum Option<T> {
    Some(T),
    None,
}
enum Result<T, E> {
    Ok(T),
    Err(E),
}
fn main() {}
```

#### 10.2.4 æ–¹æ³•å®šä¹‰ä¸­çš„æ³›å‹

- ä¸º struct æˆ– enum å®ç°æ–¹æ³•çš„æ—¶å€™ï¼Œå¯åœ¨å®šä¹‰ä¸­ä½¿ç”¨æ³›å‹
- æ³¨æ„ï¼š
  - æŠŠ T æ”¾åœ¨ impl å…³é”®å­—åï¼Œè¡¨ç¤ºåœ¨ç±»å‹ T ä¸Šå®ç°æ–¹æ³•
    - ä¾‹å¦‚ï¼šimpl<T\> Point<T\>
  - åªé’ˆå¯¹å…·ä½“ç±»å‹å®ç°æ–¹æ³•ï¼ˆå…¶ä½™ç±»å‹æ²¡å®ç°æ–¹æ³•ï¼‰
    - ä¾‹å¦‚ï¼šimpl Point<f32\>
- struct é‡Œçš„æ³›å‹ç±»å‹å‚æ•°å¯ä»¥å’Œæ–¹æ³•çš„æ³›å‹ç±»å‹å‚æ•°ä¸åŒ

```rust
struct Point<T, U> {
    x: T,
    y: U,
}
impl<T, U> Point<T, U> {
    fn mixup<V, W>(self, other: Point<V, W>) -> Point<T, W> {
        Point {
            x: self.x,
            y: other.y,
        }
    }
}
fn main() {
    let p1 = Point { x: 5, y: 4 };
    let p2 = Point {
        x: "Hello",
        y: "Rust",
    };
    let p3 = p1.mixup(p2);
    println!("p3.x = {}, p3.y = {}", p3.x, p3.y);
}
```

#### 10.2.5 æ³›å‹ä»£ç çš„æ€§èƒ½

- ä½¿ç”¨æ³›å‹çš„ä»£ç å’Œä½¿ç”¨å…·ä½“ç±»å‹çš„ä»£ç è¿è¡Œé€Ÿåº¦æ˜¯ä¸€æ ·çš„ã€‚
- å•æ€è¯ï¼ˆmonomorphizationï¼‰ï¼š
  - åœ¨ç¼–è¯‘æ—¶å°†æ³›å‹æ›¿æ¢ä¸ºå…·ä½“ç±»å‹

```rust
fn main() {
    let integer = Some(5);
    let float = Some(5.0);
}
enum Option_i32 {
    Some(i32),
    None,
}
enum Option_f64 {
    Some(f64),
    None,
}
fn main() {
    let integer = Option_i32::Some(5);
    let float = Option_f64::Some(5.0);
}
```

### 10.3 Trait

- Trait å‘Šè¯‰ Rust ç¼–è¯‘å™¨ï¼š
  æŸç§ç±»å‹å…·æœ‰å“ªäº›å¹¶ä¸”å¯ä»¥ä¸å…¶å®ƒç±»å‹å…±äº«çš„åŠŸèƒ½
- Traitï¼šæŠ½è±¡çš„å®šä¹‰å…±äº«è¡Œä¸º
- Trait boundsï¼ˆçº¦æŸï¼‰ï¼šæ³›å‹ç±»å‹å‚æ•°æŒ‡å®šä¸ºå®ç°äº†ç‰¹å®šè¡Œä¸ºçš„ç±»å‹
- Trait ä¸å…¶ä»–è¯­è¨€çš„æ¥å£ï¼ˆï¼‰interface ç±»ä¼¼ï¼Œä½†æœ‰äº›åŒºåˆ«ã€‚

#### 10.3.1 å®šä¹‰ä¸€ä¸ª Trait

- Trait çš„å®šä¹‰ï¼šæŠŠæ–¹æ³•ç­¾åæ”¾åœ¨ä¸€èµ·ï¼Œæ¥å®šä¹‰å®ç°æŸç§ç›®çš„æ‰€å¿…é¡»çš„ä¸€ç»„è¡Œä¸ºã€‚
  - å…³é”®å­—ï¼štrait
  - åªæœ‰æ–¹æ³•ç­¾åï¼Œæ²¡æœ‰å…·ä½“å®ç°
  - trait å¯ä»¥æœ‰å¤šä¸ªæ–¹æ³•ï¼šæ¯ä¸ªæ–¹æ³•ç­¾åå ä¸€è¡Œï¼Œä»¥;ç»“å°¾
  - å®ç°è¯¥ trait çš„ç±»å‹å¿…é¡»æä¾›å…·ä½“çš„æ–¹æ³•å®ç°

```rust
pub trait Summary {
    fn summarize(&self) -> String;
}
```

#### 10.3.2 åœ¨ç±»å‹ä¸Šå®ç° trait

- ä¸ä¸ºç±»å‹å®ç°æ–¹æ³•ç±»ä¼¼ã€‚
- ä¸åŒä¹‹å¤„ï¼š
  - impl Xxxx for Tweet { ... }
  - åœ¨ impl çš„å—é‡Œï¼Œéœ€è¦å¯¹ Trait é‡Œçš„æ–¹æ³•ç­¾åè¿›è¡Œå…·ä½“çš„å®ç°

```rust
pub trait Summary {
    fn summarize(&self) -> String;
}
pub struct NewsArticle {
    pub headline: String,
    pub location: String,
    pub author: String,
    pub content: String,
}
impl Summary for NewsArticle {
    fn summarize(&self) -> String {
        format!("{}, by {} ({})", self.headline, self.author, self.location)
    }
}
pub struct Tweet {
    pub username: String,
    pub content: String,
    pub reply: bool,
    pub retweet: bool,
}
impl Summary for Tweet {
    fn summarize(&self) -> String {
        format!("{}:{}", self.username, self.content)
    }
}

use demo::Summary;
use demo::Tweet;
fn main() {
    let tweet = Tweet {
        username: String::from("horse_ebooks"),
        content: String::from("of course, as you probably already know, people"),
        reply: false,
        retweet: false,
    };
    println!("1 new tweet:{}", tweet.summarize());
}
```

#### 10.3.3 å®ç° trait çš„çº¦æŸ

- å¯ä»¥åœ¨æŸä¸ªç±»å‹ä¸Šå®ç°æŸä¸ª trait çš„å‰ææ¡ä»¶æ˜¯ï¼š
  - è¿™ä¸ªç±»å‹æˆ–è¿™ä¸ª trait æ˜¯åœ¨æœ¬åœ° crate é‡Œå®šä¹‰çš„
- æ— æ³•ä¸ºå¤–éƒ¨ç±»å‹æ¥å®ç°å¤–éƒ¨çš„ traitï¼š
  - è¿™ä¸ªé™åˆ¶æ˜¯ç¨‹åºå±æ€§çš„ä¸€éƒ¨åˆ†ï¼ˆä¹Ÿå°±æ˜¯`ä¸€è‡´æ€§`ï¼‰ã€‚
  - æ›´å…·ä½“åœ°è¯´æ˜¯`å­¤å„¿åŸåˆ™`ï¼šä¹‹æ‰€ä»¥è¿™æ ·å‘½åæ˜¯å› ä¸ºçˆ¶ç±»å‹ä¸åœ¨ã€‚
  - æ­¤è§„åˆ™ç¡®ä¿å…¶ä»–äººçš„ä»£ç ä¸èƒ½ç ´è¯ä½ çš„ä»£ç ï¼Œåä¹‹äº¦ç„¶
  - å¦‚æœæ²¡æœ‰è¿™ä¸ªè§„åˆ™ï¼Œä¸¤ä¸ª crate å¯ä»¥ä¸ºåŒä¸€ç±»å‹å®ç°åŒä¸€ä¸ª traitï¼ŒRust å°±ä¸çŸ¥é“åº”è¯¥ä½¿ç”¨å“ªä¸ªå®ç°äº†ã€‚

#### 10.3.4 é»˜è®¤å®ç°

- é»˜è®¤å®ç°çš„æ–¹æ³•å¯ä»¥è°ƒç”¨ trait ä¸­å…¶å®ƒçš„æ–¹æ³•ï¼Œå³ä½¿è¿™äº›æ–¹æ³•æ²¡æœ‰é»˜è®¤å®ç°
- æ³¨æ„ï¼šæ— æ³•ä»æ–¹æ³•çš„é‡å†™å®ç°é‡Œé¢è°ƒç”¨é»˜è®¤çš„å®ç°

```rust
pub trait Summary {
    fn summarize_author(&self) -> String;
    fn summarize(&self) -> String {
        String::from("Read more...")
    }
}
```

- Trait ä½œä¸ºå‚æ•°
- impl Trait è¯­æ³•ï¼šé€‚ç”¨äºç®€å•æƒ…å†µ
- Trait bound è¯­æ³•ï¼šå¯ç”¨äºå¤æ‚æƒ…å†µ
  - impl Trait è¯­æ³•æ˜¯ Trait bound çš„è¯­æ³•ç³–
- ä½¿ç”¨+ æŒ‡å®šå¤šä¸ª Traitboun
- Trait bound ä½¿ç”¨ where å­å¥
  - å¯ä»¥åœ¨æ–¹æ³•ç­¾ååæŒ‡å®š where å­å¥

#### 10.3.5 å®ç° trait ä½œä¸ºè¿”å›ç±»å‹

- impl Trait è¯­æ³•
- æ³¨æ„ï¼šimpl Trait åªèƒ½è¿”å›ç¡®å®šçš„åŒä¸€ç§ç±»å‹ï¼Œè¿”å›å¯èƒ½ä¸åŒç±»å‹çš„ä»£ç ä¼šæŠ¥é”™

```rust
pub fn notify1(flag: bool) -> impl Summary {
    if flag {
        NewsArticle {
            headline: String::from("hello"),
            content: String::from("World"),
            author: String::from("chovrio"),
            location: String::from("é‡åº†"),
        }
    } else {
        Tweet {
            username: "chovrio",
            content: "hahahah",
            reply: true,
            retweet: false,
        }
    }
}
```

#### 10.3.6 ä½¿ç”¨ Trait Bound

```rust
fn largest<T: PartialOrd + Copy>(list: &[T]) -> T {
    let mut largest = list[0];
    for &item in list.iter() {
        if item > largest {
            largest = item
        }
    }
    largest
}
fn main() {
    let number_list = vec![34, 50, 25, 100, 65];
    let result = largest(&number_list);
}
```

**ä½¿ç”¨ Trait Bound æœ‰æ¡ä»¶çš„å®ç°æ–¹æ³•**

- åœ¨ä½¿ç”¨æ³›å‹ç±»å‹å‚æ•°çš„ impl å—ä¸Šä½¿ç”¨ Trait boundï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ¡ä»¶çš„ä¸ºå®ç°äº†ç‰¹å®š Trait çš„ç±»å‹æ¥å®ç°æ–¹æ³•
- ä¹Ÿå¯ä»¥ä¸ºå®ç°äº†å…¶å®ƒ Trait çš„ä»»æ„ç±»å‹æœ‰æ¡ä»¶çš„å®ç°æŸä¸ª Trait
- ä¸ºæ»¡è¶³ Trait Bounrd çš„æ‰€æœ‰ç±»å‹ä¸Šå®ç° Trait å«åšè¦†ç›–å®ç°ï¼ˆblankt implementationsï¼‰

```rust
struct Pair<T> {
    x: T,
    y: T,
}
impl<T> Pair<T> {
    fn new(x: T, y: T) -> Self {
        Self { x, y }
    }
}
impl<T: Display + PartialOrd> Pair<T> {
    fn cmp_display(&self) {
        if self.x >= self.y {
            println!("The largest member is x = {}", self.x);
        } else {
            println!("The largest member is y ={}", self.y);
        }
    }
}

fn main() {
    let str = 3.to_string();
}
```

### 10.4 ç”Ÿå‘½å‘¨æœŸ

- Rust çš„æ¯ä¸ªå¼•ç”¨éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ
- ç”Ÿå‘½å‘¨æœŸï¼šå¼•ç”¨ä¿æŒæœ‰æ•ˆçš„ä½œç”¨åŸŸ
- å¤§å¤šæ•°æƒ…å†µï¼šç”Ÿå‘½å‘¨æœŸæ˜¯éšå¼çš„ã€å¯è¢«æ¨æ–­çš„
- å½“å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½ä»¥ä¸åŒçš„æ–¹å¼äº’ç›¸å…³è”æ—¶ï¼šæ‰‹åŠ¨æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸã€‚

#### 10.4.1 ç”Ÿå‘½å‘¨æœŸ-é¿å…æ‚¬å‚å¼•ç”¨ï¼ˆdangling referenceï¼‰

- ç”Ÿå‘½å‘¨æœŸçš„ä¸»è¦ç›®æ ‡ï¼šé¿å…æ‚¬å‚å¼•ç”¨ï¼ˆdangling referenceï¼‰

```rust
fn main() {
    {
        let r;
        {
            let x = 5;
            r = &x;
        }
        println!("{}", r);
    }
}
```

#### 10.4.2 å‡½æ•°ä¸­çš„æ³›å‹ç”Ÿå‘½å‘¨æœŸ

**'x**

```rust
fn main() {
    let string1 = String::from("abcd");
    let string2 = "xyz";
    let result = longest(string1.as_str(), string2);
}
fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {
    if x.len() > y.len() {
        x
    } else {
        y
    }
}
```

#### 10.4.3 ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨è¯­æ³•

- ç”Ÿå‘½å‘¨æœŸçš„æ ‡æ³¨ä¸ä¼šæ”¹å˜å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸé•¿åº¦
- å½“æŒ‡å®šäº†æ³›å‹ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œå‡½æ•°å¯ä»¥æ¥å—å¸¦æœ‰ä»»ä½•ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨
- ç”Ÿå‘½å‘¨æœŸçš„æ ‡æ³¨ï¼šæè¿°äº†å¤šä¸ªå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸé—´çš„å…³ç³»ï¼Œä½†ä¸å½±å“ç”Ÿå‘½å‘¨æœŸ

#### 10.4.4 ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨-è¯­æ³•

- ç”Ÿå‘½å‘¨æœŸå‚æ•°åï¼š
  - ä»¥`'`å¼€å¤´
  - é€šå¸¸å…¨å°å†™è€Œä¸”éå¸¸çŸ­
  - å¾ˆå¤šäººä½¿ç”¨ 'a
- ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨çš„ä½ç½®ï¼š
  - åœ¨å¼•ç”¨çš„ & ç¬¦å·å
  - ä½¿ç”¨ç©ºæ ¼å°†æ ‡æ³¨å’Œå¼•ç”¨ç±»å‹åˆ†å¼€
- ä¾‹å­

  - &i32 // ä¸€ä¸ªå¼•ç”¨
  - &'a i32 // å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¼•ç”¨
  - &'a mut i32 // å¸¦æœ‰æ˜¾å¼ç”Ÿå‘½å‘¨æœŸçš„å¯å˜å¼•ç”¨

  - å•ä¸ªç”Ÿå‘½å‘¨æœŸæ ‡æ³¨æœ¬èº«æ²¡æœ‰æ„ä¹‰

#### 10.4.5 å‡½æ•°ç­¾åä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨

- æ³›å‹ç”Ÿå‘½å‘¨æœŸå‚æ•°å£°æ˜åœ¨ï¼šå‡½æ•°åå’Œå‚æ•°åˆ—è¡¨ä¹‹é—´<\>é‡Œ
- ç”Ÿå‘½å‘¨æœŸ`'a`çš„å®é™…ç”Ÿå‘½å‘¨æœŸæ˜¯ï¼šx å’Œ y ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸä¸­è¾ƒå°çš„é‚£ä¸ª

#### 10.4.6 æ·±å…¥ç†è§£ç”Ÿå‘½å‘¨æœŸ

- æŒ‡å®šç”Ÿå‘½å‘¨æœŸå‚æ•°çš„æ–¹å¼ä¾èµ–äºå‡½æ•°æ‰€ä½œçš„äº‹æƒ…
- ä»å‡½æ•°è¿”å›å¼•ç”¨æ—¶ï¼Œè¿”å›ç±»å‹çš„ç”Ÿå‘½å‘¨æœŸå‚æ•°éœ€è¦ä¸å…¶ä¸­ä¸€ä¸ªå‚æ•°çš„ç”Ÿå‘½å‘¨æœŸåŒ¹é…ï¼š
- å¦‚æœè¿”å›çš„å¼•ç”¨æ²¡æœ‰æŒ‡å‘ä»»ä½•å‚æ•°ï¼Œé‚£ä¹ˆå®ƒåªèƒ½å¼•ç”¨å‡½æ•°å†…åˆ›å»ºçš„å€¼ï¼š
  - è¿™å°±æ˜¯æ‚¬å‚å¼•ç”¨ï¼šè¯¥å€¼åœ¨å‡½æ•°ç»“æŸæ—¶å°±èµ°å‡ºäº†ä½œç”¨åŸŸ

#### 10.4.7 Struct å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨

- Struct é‡Œå¯åŒ…æ‹¬ï¼š
  - è‡ªæŒæœ‰çš„ç±»å‹
  - å¼•ç”¨ï¼šéœ€è¦åœ¨æ¯ä¸ªåº”ç”¨ä¸Šæ·»åŠ ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨

#### 10.4.8 ç”Ÿå‘½å‘¨æœŸçš„çœç•¥

- æˆ‘ä»¬çŸ¥é“ï¼š
  - æ¯ä¸ªå¼•ç”¨éƒ½æœ‰ç”Ÿå‘½å‘¨æœŸ
  - éœ€è¦ä¸ºä½¿ç”¨ç”Ÿå‘½å‘¨æœŸçš„å‡½æ•°æˆ– struct æŒ‡å®šç”Ÿå‘½å‘¨æœŸå‚æ•°

**çœç•¥è§„åˆ™**

- åœ¨ Rust å¼•ç”¨åˆ†ææ‰€ç¼–å…¥çš„æ¨¡å¼ç§°ä¸º`ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™`ã€‚
  - è¿™äº›è§„åˆ™æ— éœ€å¼€å‘è€…æ¥éµå®ˆ
  - å®ƒä»¬æ˜¯ä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œç”±ç¼–è¯‘å™¨æ¥è€ƒè™‘
  - å¦‚æœä½ çš„ä»£ç ç¬¦åˆè¿™äº›æƒ…å†µï¼Œé‚£ä¹ˆå°±æ— éœ€æ˜¾å¼æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸ
- ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ä¸ä¼šæä¾›å®Œæ•´çš„æ¨æ–­ï¼š
  - å¦‚æœåº”ç”¨è§„åˆ™åï¼Œå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸä»ç„¶æ¨¡ç³Šä¸æ¸… -> ç¼–è¯‘é”™è¯¯
  - è§£å†³åŠæ³•ï¼šæ·»åŠ ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ï¼Œè¡¨æ˜å¼•ç”¨é—´çš„ç›¸äº’å…³ç³»

**è¾“å…¥ã€è¾“å‡ºç”Ÿå‘½å‘¨æœŸ**

- ç”Ÿå‘½å‘¨æœŸåœ¨:
  - å‡½æ•°/æ–¹æ³•çš„å‚æ•°ï¼šè¾“å…¥ç”Ÿå‘½å‘¨æœŸ
  - å‡½æ•°/æ–¹æ³•çš„è¿”å›å€¼ï¼šè¾“å‡ºç”Ÿå‘½å‘¨æœŸ

**ç”Ÿå‘½å‘¨æœŸçœç•¥çš„ä¸‰ä¸ªè§„åˆ™**

- ç¼–è¯‘å™¨ä½¿ç”¨ 3 ä¸ªè§„åˆ™åœ¨æ²¡æœ‰æ˜¾å¼æ ‡æ³¨ç”Ÿå‘½å‘¨æœŸçš„æƒ…å†µä¸‹ï¼Œæ¥ç¡®å®šå¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸ
  - è§„åˆ™ 1 åº”ç”¨äºè¾“å…¥ç”Ÿå‘½å‘¨æœŸ
  - è§„åˆ™ 2ã€3 åº”ç”¨äºè¾“å‡ºç”Ÿå‘½å‘¨æœŸ
  - å¦‚æœç¼–è¯‘å™¨åº”ç”¨å®Œ 3 ä¸ªè§„åˆ™ä¹‹åï¼Œä»ç„¶æœ‰æ— æ³•ç¡®å®šç”Ÿå‘½å‘¨æœŸçš„åº”ç”¨ -> æŠ¥é”™
  - è¿™äº›è§„åˆ™é€‚ç”¨äº fn å®šä¹‰å’Œ impl å—
- è§„åˆ™ 1ï¼šæ¯ä¸ªå¼•ç”¨ç±»å‹çš„å‚æ•°éƒ½æœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ
- è§„åˆ™ 2ï¼šå¦‚æœåªæœ‰ä¸€ä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œé‚£ä¹ˆè¯¥ç”Ÿå‘½å‘¨æœŸè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°
- è§„åˆ™ 3ï¼šå¦‚æœæœ‰å¤šä¸ªè¾“å…¥ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œä½†å…¶ä¸­ä¸€ä¸ªæ˜¯&self æˆ–&mut selfï¼ˆæ˜¯æ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆ self çš„ç”Ÿå‘½å‘¨æœŸä¼šè¢«èµ‹ç»™æ‰€æœ‰çš„è¾“å‡ºç”Ÿå‘½å‘¨æœŸå‚æ•°

**ç”Ÿå‘½å‘¨æœŸçœç•¥çš„ä¸‰ä¸ªè§„åˆ™ - ä¾‹å­**

- å‡è®¾æˆ‘ä»¬æ˜¯ç¼–è¯‘å™¨
- fn first_word(s:&str) -> {}
- fn first_word<'a>(s:&'a str) -> &star {}
- fn first_word<'a>(s:&'a str) -> &'a str {}

- fn longest(x:&str,y:&str) -> &str {}
- fn longest<'a,'b>(x:&'a str,y:&'b str) -> &str {}

#### 10.4.8 æ–¹æ³•å®šä¹‰ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨

- åœ¨ struct ä¸Šä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå®ç°æ–¹æ³•ï¼Œè¯­æ³•å’Œæ³›å‹å‚æ•°çš„è¯­æ³•ä¸€æ ·
- åœ¨å“ªå£°æ˜å’Œä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå‚æ•°ï¼Œä¾èµ–äºï¼š
  - ç”Ÿå‘½å‘¨æœŸå‚æ•°æ˜¯å¦å’Œå­—æ®µã€æ–¹æ³•çš„å‚æ•°æˆ–è¿”å›å€¼æœ‰å…³
- struct å­—æ®µçš„ç”Ÿå‘½å‘¨æœŸåï¼š
  - åœ¨ impl åå£°æ˜
- impl å—å†…çš„æ–¹æ³•ç­¾åä¸­ï¼š
  - `å¼•ç”¨`å¿…é¡»ç»‘å®šäº struct å­—æ®µå¼•ç”¨çš„å£°æ˜å‘¨æœŸï¼Œæˆ–è€…å¼•ç”¨æ˜¯`ç‹¬ç«‹`çš„ä¹Ÿå¯ä»¥
  - ç”Ÿå‘½å‘¨æœŸçœç•¥è§„åˆ™ç»å¸¸ä½¿å¾—æ–¹æ³•ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ ‡æ³¨ä¸æ˜¯å¿…é¡»çš„ã€‚

```rust
struct ImportantExcerpt<'a> {
    part: &'a str,
}
impl<'a> ImportantExcerpt<'a> {
    fn level(&self) -> i32 {
        3
    }
    fn announce_and_return_part(&self, announcement: &str) -> &str {
        println!("Attention please:{}", announcement);
        self.part
    }
}
```

#### 10.4.9 é™æ€ç”Ÿå‘½å‘¨æœŸ

- `'static` æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸï¼šæ•´ä¸ªç¨‹åºçš„æŒç»­æ—¶é—´ã€‚
  - ä¾‹å¦‚ï¼šæ‰€æœ‰çš„å­—ç¬¦ä¸²å­—é¢å€¼éƒ½æ‹¥æœ‰'static ç”Ÿå‘½å‘¨æœŸ
    - let s:&'static str = "I have a static lifetime.";
- ä¸ºå¼•ç”¨æŒ‡å®š'static ç”Ÿå‘½å‘¨æœŸå‰è¦ä¸‰æ€ï¼š
  - æ˜¯å¦éœ€è¦å¼•ç”¨åœ¨ç¨‹åºæ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…éƒ½å­˜æ´»

#### 10.4.10 æ³›å‹å‚æ•°ç±»å‹ã€Trait Boundã€ç”Ÿå‘½å‘¨æœŸ
```rust
use std::fmt::Display;

fn longest_with_an_announcement<'a, T>(x: &'a str, y: &'a str, ann: T) -> &'a str
where
    T: Display,
{
    println!("Announcement! {}", ann);
    if x.len() > y.len() {
        x
    } else {
        y
    }
}
fn main() {}
```