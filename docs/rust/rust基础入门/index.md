---
title: rust åŸºç¡€å…¥é—¨
---

## 3.æ•°æ®

### 3.1 å˜é‡ä¸å¯å˜æ€§

- å£°æ˜å˜é‡ä½¿ç”¨ let å…³é”®å­—ã€‚
- é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ˜¯ä¸å¯å˜çš„(immutable)ã€‚
- å£°æ˜å˜é‡æ—¶ï¼Œåœ¨å˜é‡å‰é¢åŠ ä¸Š mutï¼Œå°±å¯ä»¥ä½¿å˜é‡å¯å˜ã€‚

**å˜é‡ä¸å¸¸é‡**

- å¸¸é‡(constant)ï¼Œå¸¸é‡ç»‘å®šä»¥åä¹Ÿæ˜¯ä¸å¯å˜çš„ï¼Œä½†æ˜¯å®ƒä¸ä¸å¯å˜çš„å˜é‡æœ‰å¾ˆå¤šåŒºåˆ«ï¼š
  - ä¸å¯ä»¥ä½¿ç”¨ mutï¼Œå¸¸é‡æ°¸è¿œéƒ½æ˜¯ä¸å¯å˜çš„
  - å£°æ˜å¸¸é‡ä½¿ç”¨ const å…³é”®å­—ï¼Œå®ƒçš„ç±»å‹å¿…é¡»è¢«æ ‡æ³¨
  - å¸¸é‡å¯ä»¥åœ¨ä»»ä½•ä½œç”¨åŸŸå†…åŠè¿›è¡Œå£°æ˜ï¼ŒåŒ…æ‹¬å…¨å±€ä½œç”¨åŸŸ
  - å¸¸é‡åªå¯ä»¥ç»‘å®šåˆ°å¸¸é‡è¡¨è¾¾å¼ï¼Œæ— æ³•ç»‘å®šåˆ°å‡½æ•°çš„è°ƒç”¨ç»“æ„æˆ–åªèƒ½åœ¨è¿è¡Œæ—¶æ‰èƒ½è®¡ç®—å‡ºçš„å€¼
- åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œå¸¸é‡åœ¨å…¶å£°æ˜çš„ä½œç”¨åŸŸå†…ä¸€ç›´æœ‰æ•ˆ
- å‘½åè§„èŒƒï¼šRust é‡Œå¸¸é‡ä½¿ç”¨å…¨å¤§å†™å­—æ¯ï¼Œæ¯ä¸ªå•è¯ä¹‹é—´ç”¨ä¸‹åˆ’çº¿åˆ†å¼€ï¼Œä¾‹å¦‚
  - MAX_POINTS

**éšè—(shadowing)**

- å¯ä»¥ä½¿ç”¨ç›¸åŒçš„åå­—å£°æ˜æ–°çš„å˜é‡ï¼Œæ–°çš„å˜é‡å°±ä¼š shadow(éšè—)ä¹‹å‰å£°æ˜çš„ç›¸åŒå˜é‡
  - åœ¨åç»­çš„ä»£ç ä¸­è¿™ä¸ªå˜é‡åå°±æ˜¯å¿ƒçš„å˜é‡

```rust
fn main(){
  let x = 5;
  let x = x + 1;
  println!("{}",x);// 6
}
```

- shadow å’ŒæŠŠå˜é‡æ ‡è®°ä¸º mut æ˜¯ä¸ä¸€æ ·çš„ï¼š
  - å¦‚æœä¸é€‚ç”¨ let å…³é”®ä¹‹ï¼Œé‚£ä¹ˆé‡æ–°ç»™é mut çš„å˜é‡èµ‹å€¼ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯
  - è€Œä½¿ç”¨ let å£°æ˜çš„åŒåæ–°å˜é‡ï¼Œä¹Ÿæ˜¯ä¸å¯å˜çš„ã€‚
  - ä½¿ç”¨ let å£°æ˜çš„åŒåæ–°å˜é‡ï¼Œå®ƒçš„ç±»å‹å¯ä»¥ä¸ä¹‹å‰ä¸åŒ

```rust
fn main() {
    let spaces = "    ";
    let spaces = spaces.len();
    print!("{}", spaces);
}
```

### 3.2 æ•°æ®ç±»å‹

- æ ‡é‡å’Œå¤åˆç±»å‹
- Rust æ˜¯é™æ€ç¼–è¯‘è¯­è¨€ï¼Œåœ¨ç¼–è¯‘æ—¶å¿…é¡»ç›´åˆ°æ‰€æœ‰å˜é‡çš„ç±»å‹
  - åŸºäºä½¿ç”¨çš„å€¼ï¼Œç¼–è¯‘å™¨é€šå¸¸èƒ½å¤Ÿæ¨æ–­å‡ºå®ƒçš„å…·ä½“ç±»å‹
  - ä½†å¦‚æœå¯èƒ½çš„ç±»å‹æ¯”è¾ƒå¤š(ä¾‹å¦‚æŠŠ String è½¬ä¸ºæ•´æ•°çš„ parse æ–¹æ³•)ï¼Œå°±å¿…é¡»æ·»åŠ ç±»å‹çš„æ ‡æ³¨ï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™
  ```rust
  fn main() {
   // ä¸å†™ u32 ç±»å‹å°±æŠ¥é”™
   let guess: u32 = "42".parse().expect("Not a number");
  }
  ```

**æ ‡é‡ç±»å‹**

- ä¸€ä¸ªå˜é‡ç±»å‹ä»£è¡¨ä¸€ä¸ªå•ä¸ªçš„å€¼
- Rust æœ‰å››ä¸ªä¸»è¦çš„æ ‡é‡ç±»å‹
  - æ•´æ•°ç±»å‹
  - æµ®ç‚¹ç±»å‹
  - å¸ƒå°”ç±»å‹
  - å­—ç¬¦ç±»å‹

**æ•´æ•°ç±»å‹**

- æ•´æ•°ç±»å‹æ²¡æœ‰å°æ•°éƒ¨åˆ†
- ä¾‹å¦‚ u32 å°±æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„æ•´æ•°ç±»å‹ï¼Œå æ® 32 ä½çš„ç©ºé—´
- æ— ç¬¦å·æ•´æ•°ç±»å‹ä»¥ u å¼€å¤´
- æœ‰ç¬¦å·æ•´æ•°ç±»å‹ä»¥ i å¼€å¤´
- Rust çš„æ•´æ•°ç±»å‹ ï¼š8 16 32 64 128 arch(size)
  - æ¯ç§éƒ½åˆ† i å’Œ uï¼Œä»¥åŠå›ºå®šçš„ä½æ•°
  - æœ‰ç¬¦å·èŒƒå›´:
    - -(2^n-1)åˆ° 2^(n-1)-1
  - æ— ç¬¦å·èŒƒå›´ï¼š
    - 0 åˆ° 2^n - 1

**isize å’Œ usize ç±»å‹**

- isize å’Œ usize ç±»å‹çš„ä½æ•°ç”±ç¨‹åºè¿è¡Œçš„è®¡ç®—æœºçš„æ¶æ„æ‰€å†³å®šï¼š
  - å¦‚æœæ˜¯ 64 ä½è®¡ç®—æœºï¼Œé‚£å°±æ˜¯ 64 ä½çš„
  - (å…¶ä½™åŒç†)....
- ä½¿ç”¨ isize æˆ– usize çš„ä¸»è¦åœºæ™¯æ˜¯å¯¹æŸç§é›†åˆè¿›è¡Œç´¢å¼•æ“ä½œã€‚

**æ•´æ•°å­—é¢é‡**

- é™¤äº† byte ç±»å‹å¤–ï¼Œæ‰€æœ‰çš„æ•°å€¼å­—é¢å€¼éƒ½å…è®¸ä½¿ç”¨ç±»å‹åç¼€ã€‚
  - ä¾‹å¦‚ 57u8
- å¦‚æœä½ ä¸å¤ªæ¸…æ¥šåº”è¯¥ä½¿ç”¨å“ªç§ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ Rust ç›¸åº”çš„é»˜è®¤ç±»å‹
- æ•´æ•°çš„é»˜è®¤ç±»å‹å°±æ˜¯ u32

**æ•´æ•°æº¢å‡º**

- ä¾‹å¦‚ï¼š u8 çš„èŒƒå›´æ˜¯ 0-255ï¼Œå¦‚æœä½ æŠŠä¸€ä¸ª u8 å˜é‡çš„å€¼è®¾ä¸º 256ï¼Œé‚£ä¹ˆï¼š
  - è°ƒè¯•æ¨¡å¼ä¸‹ç¼–è¯‘ï¼šRust ä¼šæ£€æŸ¥æ•´æ•°æº¢å‡ºï¼Œå¦‚æœå‘ç”Ÿæº¢å‡ºï¼Œç¨‹åºåœ¨è¿è¡Œæ—¶å°±ä¼š panic
  - å‘å¸ƒæ¨¡å¼ä¸‹(-release)ç¼–è¯‘ï¼šRust ä¸ä¼šæ£€æŸ¥å¯èƒ½å¯¼è‡´ panic çš„æ•´æ•°æº¢å‡º
    - å¦‚æœæº¢å‡ºå‘ç”Ÿï¼šRust ä¼šæ‰§è¡Œâ€œç¯ç»•â€æ“ä½œï¼š
      - 256 å˜æˆ 0 ï¼Œ257 å˜æˆ 1 ...
    - ä½†æ˜¯ç¨‹åºä¸ä¼š panic

**æµ®ç‚¹ç±»å‹**

- Rust æœ‰ä¸¤ç§åŸºç¡€çš„æµ®ç‚¹ç±»å‹ï¼Œä¹Ÿå°±æ˜¯å«æœ‰å°æ•°éƒ¨åˆ†çš„ç±»å‹
  - f32ï¼Œ32 ä½ï¼Œå•ç²¾åº¦
  - f64ï¼Œ64 ä½ï¼ŒåŒç²¾åº¦
- Rust çš„æµ®ç‚¹ç±»å‹ä½¿ç”¨äº† IEEE-754 æ ‡å‡†æ¥è¡¨è¿°
- f64 æ—¶é»˜è®¤å†…å¿ƒï¼Œå› ä¸ºåœ¨ç°ä»£ CPU ä¸Š f64 å’Œ f32 çš„é€Ÿåº¦å·®ä¸å¤šï¼Œè€Œä¸”ç²¾åº¦æ›´é«˜ã€‚

```rust
fn main() {
   let x = 2.0; // f64
   let y: f32 = 3.0; // f32
}

```

**æ•°å€¼æ“ä½œ**

åŠ å‡ä¹˜é™¤æ²¡å•¥å¥½è¯´çš„

**å¸ƒå°”ç±»å‹**

å’Œå…¶å®ƒè¯­è¨€ä¹Ÿä¸€æ ·ï¼Œæ²¡å•¥å¥½è¯´çš„

**å­—ç¬¦ç±»å‹**

- Rust è¯­è¨€ä¸­ char ç±»å‹è¢«ç”¨æ¥æè¿°è¯­è¨€ä¸­æœ€åŸºç¡€çš„å•ä¸ªå­—ç¬¦ã€‚
- å­—ç¬¦ç±»å‹çš„å­—é¢å€¼ä½¿ç”¨å•å¼•å·
- å ç”¨ 4 å­—èŠ‚å¤§å°
- æ˜¯ Unicode çš„æ ‡é‡å€¼ï¼Œå¯ä»¥è¡¨ç¤ºæ¯” ASCII å¤šå¾—å¤šçš„å­—ç¬¦å†…å®¹ï¼šæ‹¼éŸ³ã€ä¸­æ—¥éŸ©æ–‡ã€é›¶é•¿åº¦ç©ºç™½å­—ç¬¦ã€emoji è¡¨æƒ…ç­‰
  - U+0000 åˆ° U+D7FF
  - U+E000 åˆ° U+10FFFF
- ä½† Unicode ä¸­å¹¶æ²¡æœ‰â€œå­—ç¬¦â€çš„æ”¹è‰¯ï¼Œæ‰€ä»¥ç›´è§‰ä¸Šè®¤ä¸ºçš„å­—ç¬¦ä¹Ÿè®¸ä¸ Rust ä¸­çš„æ¦‚å¿µå¹¶ä¸ç›¸ç¬¦

### 3.3 å¤åˆç±»å‹

- å¤åˆç±»å‹å¯ä»¥å°†å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹ä¸­
- Rust æä¾›äº†ä¸¤ç§åŸºç¡€çš„å¤åˆç±»å‹ï¼šå…ƒç»„(Tuple)ã€æ•°ç»„

#### Tuple

**åˆ›å»º Tuple**

- åœ¨å°æ‹¬å·é‡Œé¢ï¼Œå°†å€¼ç”¨é€—å·åˆ†å¼€
- Tuple ä¸­çš„æ¯ä¸ªä½ç½®éƒ½å¯¹åº”ä¸€ä¸ªç±»å‹ï¼ŒTuple ä¸­å„å…ƒç´ çš„ç±»å‹ä¸å¿…ç›¸åŒ

**è·å– Tuple çš„å…ƒç´ å€¼**

- å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥è§£æ„ï¼ˆdestructureï¼‰ä¸€ä¸ª Tuple æ¥è·å–å…ƒç´ çš„å€¼

```rust
fn main() {
    let tup: (i32, f64, i32) = (500, 6.4, 1);
    // è§£æ„
    let (x, y, z) = tup;
    println!("{},{},{}", x, y, z);
    // ç´¢å¼•
    println!("{},{},{}", tup.0, tup.1, tup.2);
}
```

#### æ•°ç»„

- æ•°ç»„ä¹Ÿå¯ä»¥å°†å¤šä¸ªå€¼æ”¾åœ¨ä¸€ä¸ªç±»å‹é‡Œ
- æ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„ç±»å‹å¿…é¡»ç›¸åŒ
- æ•°ç»„çš„é•¿åº¦ä¹Ÿæ˜¯å›ºå®šçš„

**å£°æ˜ä¸€ä¸ªæ•°ç»„**

- åœ¨ä¸­æ‹¬å·é‡Œï¼Œå„å€¼ç”¨é€—å·åˆ†å¼€

**æ•°ç»„çš„ç”¨å¤„**

- å¦‚æœæƒ³è®©ä½ çš„æ•°æ®å­˜æ”¾åœ¨ stack(æ ˆ)ä¸Šè€Œä¸æ˜¯ heap(å †)ä¸Šï¼Œæˆ–è€…æƒ³ä¿è¯æœ‰å›ºå®šæ•°é‡çš„å…ƒç´ ï¼Œè¿™æ—¶ä½¿ç”¨æ•°ç»„æ›´æœ‰å¥½å¤„
- æ•°ç»„æ²¡æœ‰ Vector çµæ´»
  - Vector å’Œæ•°ç»„ç±»ä¼¼ï¼Œå®ƒç”±æ ‡å‡†åº“æä¾›
  - Vector çš„é•¿åº¦å¯ä»¥æ”¹å˜
  - å¦‚æœä½ ä¸ç¡®å®šåº”è¯¥ä½¿ç”¨æ•°ç»„è¿˜æ˜¯ Vectorï¼Œé‚£ä¹ˆä¼°è®¡ä½ åº”è¯¥ç”¨ Vector

**æ•°ç»„çš„ç±»å‹**

- æ•°ç»„çš„ç±»å‹ä»¥è¿™ç§å½¢å¼è¡¨ç¤º: [ç±»å‹; é•¿åº¦]

  - ä¾‹å¦‚ let a:[i32;5] = [1,2,3,4,5];

**å¦ä¸€ç§å£°æ˜æ•°ç»„çš„æ–¹æ³•**

- å¦‚æœæ•°ç»„çš„æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½ç›¸åŒ,é‚£ä¹ˆå¯ä»¥åœ¨:
  - åœ¨ä¸­æ‹¬å·é‡ŒæŒ‡å®šåˆå§‹å€¼
  - ç„¶åæ˜¯ä¸€ä¸ª"; "
  - æœ€åæ˜¯æ•°ç»„çš„é•¿åº¦
- ä¾‹å¦‚: let a = [3; 5]; å®ƒç›¸å½“äº: let a = [3,3,3,3,3]

**è®¿é—®æ•°ç»„çš„å…ƒç´ **

- æ•°ç»„æ—¶ Stack ä¸Šåˆ†é…çš„å•ä¸ªå—çš„å†…å­˜
- å¯ä»¥ä½¿ç”¨ç´¢å¼•æ¥è®¿é—®æ•°ç»„çš„å…ƒç´ (ä¾‹å­ )
- å¦‚æœè®¿é—®çš„ç´¢å¼•è¶…å‡ºäº†æ•°ç»„çš„èŒƒå›´,é‚£ä¹ˆ:
  - ç¼–è¯‘ä¼šé€šè¿‡
  - è¿è¡Œä¼šæŠ¥é”™(runtime æ—¶ä¼š panic)
    - Rust ä¸ä¼šå…è®¸å…¶ç»§ç»­è®¿é—®ç›¸åº”åœ°å€çš„å†…å­˜

```rust
fn main() {
    let months: [&str; 12] = [
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "Auguest",
        "September",
        "October",
        "November",
        "December",
    ];
    let first = months[0];
    let second = months[1];
    let index = 15;
    let month = months[index];
    println!("{}", month);
}
```

### 3.4 å‡½æ•°

- å£°æ˜å‡½æ•°ä½¿ç”¨ fn å…³é”®å­—
- ä¾ç…§æƒ¯ä¾‹:é’ˆå¯¹å‡½æ•°å’Œå˜é‡å,Rust ä½¿ç”¨ stack case å‘½åè§„èŒƒ:
  - æ‰€æœ‰çš„å­—æ¯éƒ½æ˜¯å°å†™çš„,å•è¯ä¹‹é—´ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†å¼€

#### å‡½æ•°çš„å‚æ•°

- parameters,arguments
- åœ¨å‡½æ•°ç­¾åé‡Œ,å¿…é¡»å£°æ˜æ¯ä¸ªå‚æ•°çš„ç±»å‹

#### å‡½æ•°ä½“ä¸­çš„è¯­å¥ä¸è¡¨è¾¾å¼

- å‡½æ•°ä½“ç”±ä¸€ç³»åˆ—è¯­å¥ç»„æˆ,å¯é€‰çš„ç”±ä¸€ä¸ªè¡¨è¾¾å¼ç»“æŸ
- Rust æ˜¯ä¸€ä¸ªåŸºäºè¡¨è¾¾å¼çš„è¯­è¨€
- è¯­å¥æ˜¯æ‰§è¡Œä¸€äº›åŠ¨ä½œçš„æŒ‡ä»¤
- è¡¨è¾¾å¼ä¼šè®¡ç®—äº§ç”Ÿä¸€ä¸ªå€¼
- å‡½æ•°çš„å®šä¹‰ä¹Ÿæ˜¯ä¸€ä¸ªè¯­å¥

#### å‡½æ•°çš„è¿”å›å€¼

- åœ¨ -> ç¬¦å·åè¾¹å£°æ˜å‡½æ•°è¿”å›å€¼çš„ç±»å‹,ä½†æ˜¯ä¸å¯ä»¥ä¸ºè¿”å›å€¼å‘½å
- åœ¨ Rust é‡Œé¢,è¿”å›å€¼å°±æ˜¯å‡½æ•°ä½“é‡Œé¢æœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼
- è‹¥æƒ³æå‰è¿”å›,éœ€ä½¿ç”¨ return å…³é”®å­—,å¹¶æŒ‡å®šä¸€ä¸ªå€¼
  - å¤§å¤šæ•°å‡½æ•°éƒ½æ˜¯é»˜è®¤ä½¿ç”¨æœ€åä¸€ä¸ªè¡¨è¾¾å¼æœ€ä¸ºè¿”å›å€¼

#### å‡½æ•°æ³¨é‡Š

å’Œ js ä¸€æ ·

```rust
fn main() {
    another_function(5); // argument
    let y = {
        let x = 1;
        // ä¸åŠ åˆ†å·è¿”å› x + 3;
        // x + 3; //()
        x + 3
    };
    println!("The value of plus_five(10) is:{}", plus_five(10));
    println!("The value of y is:{}", y);
}
fn another_function(x: i32) {
    // parameter
    println!("the value of x is:{}", x);
}
fn plus_five(x: i32) -> i32 {
    x + 5
}
```

### 3.5 æ§åˆ¶æµ

#### if è¡¨è¾¾å¼

- if è¡¨è¾¾å¼å…è®¸æ‚¨æ ¹æ®æ¡ä»¶æ¥æ‰§è¡Œä¸åŒçš„ä»£ç åˆ†æ”¯
  - è¿™ä¸ªæ¡ä»¶å¿…é¡» bool ç±»å‹
- if è¡¨è¾¾å¼ä¸­,ä¸æ¡ä»¶ç›¸å…³è”çš„ä»£ç å—å°±å«åˆ†æ”¯(arm)
- å¯é€‰çš„,åœ¨åè¾¹å¯ä»¥åŠ ä¸Šä¸€ä¸ª else è¡¨è¾¾å¼

#### ä½¿ç”¨ else if å¤„ç†å¤šé‡æ¡ä»¶

- ä½†å¦‚æœä½¿ç”¨äº†å¤šäºä¸€ä¸ª else if,é‚£ä¹ˆæœ€å¥½ä½¿ç”¨ match æ¥é‡æ„ä»£ç 

```rust
fn main() {
    let number = 7;
    if number < 5 {
        println!("condition was true");
    } else if number > 1000 {
        println!("too big");
    } else {
        println!("condition was false");
    }
    let condition = true;
    let number = if condition { 5 } else { 6 };
    println!("The value of number is: {}", number);
}
```

### Rust çš„å¾ªç¯

- Rust æä¾›äº† 3 ç§å¾ªç¯:loop,while å’Œ for

#### loop å¾ªç¯

- loop å…³é”®å­—å‘Šè¯‰ Rust åå¤çš„æ‰§è¡Œä¸€å—ä»£ç ,ç›´åˆ°ä½ å–Šåœ

#### while æ¡ä»¶å¾ªç¯

- å¦ä¸€ç§å¸¸è§çš„å¾ªç¯æ¨¡å¼æ˜¯æ¯æ¬¡æ‰§è¡Œå¾ªç¯ä½“ä¹‹å‰éƒ½åˆ¤æ–­ä¸€æ¬¡æ¡ä»¶.
- while æ¡ä»¶å¾ªç¯ä¸ºè¿™ç§æ¨¡å¼è€Œç”Ÿ

#### ä½¿ç”¨ for å¾ªç¯éå†é›†åˆ

- å¯ä»¥ä½¿ç”¨ while æˆ– loop æ¥éå†é›†åˆ,ä½†æ˜¯æ˜“é”™ä¸”ä½æ•ˆ

```rust
fn main() {
    let a = [10, 20, 30, 40, 50];
    let mut index = 0;
    while index < 5 {
        println!("The value of a[index] is: {}", a[index]);
        index = index + 1;
    }
    for element in a.iter() {
        println!("element: {}", element);
    }
    let mut i = 1;
    while i <= 3 {
        i = i + 1;
        println!("while {}", i);
    }
    loop {
        i = i + 1;
        println!("loop {}", i);
        if i >= 10 {
            break;
        }
    }
}
```

#### Range

- æ ‡å‡†åº“æä¾›
- æŒ‡å®šä¸€ä¸ªå¼€å§‹æ•°å­—å’Œä¸€ä¸ªç»“æŸæ•°å­—,Range å¯ä»¥ç”Ÿæˆå®ƒä»¬ä¹‹é—´çš„æ•°å­—(ä¸å«ç»“æŸ)
- rev æ–¹æ³•å¯ä»¥åè½¬ Range

```rust
fn main() {
    for number in (1..4).rev() {
        println!("{}!", number);
    }
    println!("LIFTOFF!");
}
```

## 4.æ‰€æœ‰æƒ

- æ‰€æœ‰æƒæ˜¯ Rust æœ€ç‹¬ç‰¹çš„ç‰¹æ€§,å®ƒè®© Rust æ— éœ€ GC(åƒåœ¾æ”¶é›†å™¨) å°±å¯ä»¥ä¿è¯å†…å­˜å®‰å…¨

### 4.1 ä»€ä¹ˆæ˜¯æ‰€æœ‰æƒ

- Rust çš„æ ¸å¿ƒç‰¹æ€§å°±æ˜¯æ‰€æœ‰æƒ
- æ‰€æœ‰ç¨‹åºåœ¨è¿è¡Œæ—¶éƒ½å¿…é¡»ç®¡ç†å®ƒä»¬ä½¿ç”¨è®¡ç®—æœºå†…å­˜çš„æ–¹å¼
  - æœ‰äº›è¯­è¨€æœ‰åƒåœ¾æ”¶é›†æœºåˆ¶,åœ¨ç¨‹åºè¿è¡Œæ—¶,å®ƒä»¬ä¼šä¸æ–­å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜
  - åœ¨å…¶å®ƒè¯­è¨€ä¸­,ç¨‹åºå‘˜å¿…é¡»æ˜¾ç¤ºçš„åˆ†é…å’Œé‡Šæ”¾å†…å­˜(ä¸åŒ…æ‹¬ js å§ ğŸ˜‹)
- Rust é‡‡ç”¨äº†ç¬¬ä¸‰ç§æ–¹å¼:
  - å†…å­˜æ˜¯é€šè¿‡ä¸€ä¸ªæ‰€æœ‰æƒç³»ç»Ÿæ¥ç®¡ç†çš„,å…¶ä¸­åŒ…å«ä¸€ç»„ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥çš„è§„åˆ™
  - å½“ç¨‹åºè¿è¡Œæ—¶,æ‰€æœ‰æƒç‰¹æ€§ä¸ä¼šå‡æ…¢ç¨‹åºçš„è¿è¡Œé€Ÿåº¦

#### 4.1.1 Stack vs Heap

æ ˆå†…å­˜ vs å †å†…å­˜

- åœ¨åƒ Rust è¿™æ ·çš„ç³»ç»Ÿçº§ç¼–ç¨‹è¯­è¨€é‡Œ,ä¸€ä¸ªå€¼æ˜¯åœ¨ stack ä¸Šè¿˜æ˜¯åœ¨ heap ä¸Šå †è¯­è¨€çš„è¡Œä¸ºå’Œä½ ä¸ºä»€ä¹ˆè¦åšæŸäº›å†³å®šæ—¶æœ‰æ›´å¤§çš„å½±å“çš„
- åœ¨ä½ çš„ä»£ç è¿è¡Œçš„æ—¶å€™,Stack å’Œ Heap éƒ½æ˜¯ä½ å¯ç”¨çš„å†…å­˜,ä½†æ˜¯å®ƒä»¬çš„è§£æ„å¾ˆä¸ç›¸åŒ.

**å­˜å‚¨æ•°æ®**

- Stack æŒ‰å€¼çš„æ¥å—é¡ºåºæ¥å­˜å‚¨,æŒ‰ç›¸åçš„é¡ºåºå°†å®ƒä»¬ç§»é™¤(åè¿›å…ˆå‡º,LIFO)
  - æ·»åŠ æ•°æ®å«åšå‹å…¥æ ˆ
  - ç§»é™¤æ•°æ®å«åšå¼¹å‡ºæ ˆ
- æ‰€æœ‰å­˜å‚¨åœ¨ Stack ä¸Šçš„æ•°æ®å¿…é¡»æ‹¥æœ‰å·²çŸ¥çš„å›ºå®šçš„å¤§å°
  - ç¼–è¯‘æ—¶å¤§å°æœªçŸ¥çš„æ•°æ®æˆ–è¿è¡Œæ—¶å¤§å°å¯èƒ½å‘ç”Ÿå˜åŒ–çš„æ•°æ®å¿…é¡»å­˜æ”¾åœ¨ heap ä¸Š
- Heap å†…å­˜ç»„ç»‡æ€§å·®ä¸€äº›

  - å½“ä½ æŠŠæ•°æ®æ”¾å…¥ heap æ—¶,ä½ ä¼šè¯·æ±‚ä¸€å®šæ•°é‡çš„ç©ºé—´
  - æ“ä½œç³»ç»Ÿåœ¨ heap é‡Œæ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„ç©ºé—´,æŠŠå®ƒæ ‡è®°ä¸ºåœ¨ç”¨,å¹¶è¿”å›ä¸€ä¸ªæŒ‡é’ˆ,ä¹Ÿå°±æ˜¯è¿™ä¸ªç©ºé—´çš„åœ°å€
  - è¿™ä¸ªè¿‡ç¨‹å«åšåœ¨ heap ä¸Šè¿›è¡Œåˆ†é…,æœ‰æ—¶å€™ä»…ä»…ç§°ä¸ºåˆ†é…

- æŠŠå€¼å‹åœ¨ stack ä¸Šä¸å«åˆ†é…

- å› ä¸ºæŒ‡é’ˆæ˜¯å·²çŸ¥å›ºå®šå¤§å°çš„,å¯ä»¥æŠŠæŒ‡é’ˆå­˜æ”¾åœ¨ stack ä¸Š.
  - å½“å¦‚æœæƒ³è¦å®é™…æ•°æ®,ä½ å¿…é¡»ä½¿ç”¨æŒ‡é’ˆæ¥å®šä½
- æŠŠæ•°æ®å‹å€’ stack ä¸Šè¦æ¯”åœ¨ heap ä¸Šåˆ†é…å¿«å¾—å¤š
  - å› ä¸ºæ“ä½œç³»ç»Ÿä¸éœ€è¦å¯»æ‰¾ç”¨æ¥å­˜å‚¨æ–°æ•°æ®çš„ç©ºé—´,é‚£ä¸ªä½ç½®æ°¸è¿œéƒ½åœ¨ stack çš„é¡¶ç«¯

**è®¿é—®æ•°æ®**

- è®¿é—® heap ä¸­çš„æ•°æ®è¦æ¯”è®¿é—® stack ä¸­çš„æ•°æ®æ…¢,å› ä¸ºéœ€è¦é€šè¿‡æŒ‡é’ˆæ‰èƒ½æ‰¾åˆ° heap ä¸­çš„æ•°æ®
  - å¯¹äºç°ä»£çš„å¤„ç†å™¨æ¥è¯´,ç”±äºç¼“å­˜çš„ç¼˜æ•…,å¦‚æœæŒ‡ä»¤åœ¨å†…å­˜ä¸­è·³è½¬çš„æ¬¡æ•°è¶Šå°‘,é‚£ä¹ˆé€Ÿåº¦å°±è¶Šå¿«
- å¦‚æœæ•°æ®å­˜æ”¾çš„è·ç¦»æ¯”è¾ƒè¿‘,é‚£ä¹ˆå¤„ç†å™¨çš„å¤„ç†é€Ÿåº¦å°±ä¼šæ›´å¿«ä»¥ä¸‹(stack)ä¸Š
- å¦‚æœæ•°æ®ä¹‹é—´çš„è·ç¦»æ¯”è¾ƒè¿œ,é‚£ä¹ˆå¤„ç†é€Ÿåº¦å°±ä¼šæ…¢ä¸€äº›(heap)ä¸Š
  - åœ¨ heap ä¸Šåˆ†é…å¤§é‡çš„ç©ºé—´ä¹Ÿæ˜¯éœ€è¦æ—¶é—´çš„

**å‡½æ•°è°ƒç”¨**

- å½“ä½ çš„ä»£ç è°ƒç”¨å‡½æ•°æ—¶,å€¼è¢«ä¼ å…¥åˆ°å‡½æ•°(ä¹ŸåŒ…æ‹¬æŒ‡å‘ heap çš„æŒ‡é’ˆ).å‡½æ•°æœ¬åœ°çš„å˜é‡è¢«å‹åˆ° stack ä¸Š. å½“å‡½æ•°ç»“æŸå,è¿™äº›å€¼ä¼šä» stack ä¸Šå¼¹å‡º

**æ‰€æœ‰æƒå­˜åœ¨çš„åŸå› **

- æ‰€æœ‰æƒè§£å†³çš„é—®é¢˜:
  - è·Ÿè¸ªä»£ç çš„å“ªäº›éƒ¨åˆ†æ­£åœ¨ä½¿ç”¨ heap çš„å“ªäº›æ•°æ®
  - æœ€å°åŒ– heap ä¸Šçš„é‡å¤æ•°æ®é‡
  - æ¸…ç† heap ä¸Šä»æœªä½¿ç”¨çš„æ•°æ®ä»¥é¿å…ç©ºé—´ä¸è¶³
- ä¸€æ—¦ä½ æ‡‚å¾—äº†æ‰€æœ‰æƒ,é‚£ä¹ˆå°±ä¸éœ€è¦ç»å¸¸å»æƒ³ stack æˆ– heap äº†
- ä½†æ˜¯ç›´åˆ°ç®¡ç† heap æ•°æ®æ˜¯æ‰€æœ‰æƒå­˜åœ¨çš„åŸå› ,è¿™æœ‰åŠ©äºè§£é‡Šå®ƒä¸ºä»€ä¹ˆä¼šè¿™æ ·å·¥ä½œ

#### 4.1.2 æ‰€æœ‰æƒè§„åˆ™ã€å†…å­˜ä¸åˆ†é…

**æ‰€æœ‰æƒè§„åˆ™**

- æ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡æ˜¯è¯¥å€¼çš„æ‰€æœ‰è€…
- æ¯ä¸ªå€¼åŒæ—¶åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…
- å½“æ‰€æœ‰è€…è¶…å‡ºä½œç”¨åŸŸ(scope)æ—¶ï¼Œè¯¥å€¼å°†è¢«åˆ é™¤

**å˜é‡ä½œç”¨åŸŸ**

- Scope å°±æ˜¯ç¨‹åºä¸­ä¸€ä¸ªé¡¹ç›®çš„æœ‰æ•ˆèŒƒå›´

```rust
fn main() {
    // s ä¸å¯ç”¨
    let s = "hello"; // s å¯ç”¨
                     // å¯ä»¥å¯¹ s è¿›è¡Œç›¸å…³æ“ä½œ
    println!("Hello, world!");
} // s ä½œç”¨åŸŸåˆ°æ­¤ç»“æŸï¼Œs ä¸å†å¯ç”¨
```

**String ç±»å‹**

- String æ¯”é‚£äº›åŸºç¡€æ ‡é‡æ•°æ®ç±»å‹æ›´åŠ å¤æ‚
- å­—ç¬¦ä¸²å­—é¢å€¼ï¼šç¨‹åºé‡Œæ‰‹å†™çš„é‚£äº›å­—ç¬¦ä¸²å€¼ã€‚å®ƒä»¬æ˜¯ä¸å¯å˜çš„
- Rust è¿˜æœ‰ç¬¬äºŒç§å­—ç¬¦ä¸²ç±»å‹ï¼šString
  - åœ¨ heap ä¸Šåˆ†é…ã€‚èƒ½å¤Ÿå­˜å‚¨åœ¨ç¼–è¯‘æ—¶æœªçŸ¥æ•°é‡
    **åˆ›å»º String ç±»å‹çš„å€¼**
  - å¯ä»¥ä½¿ç”¨ from å‡½æ•°ä»å­—ç¬¦ä¸²å­—é¢å€¼åˆ›å»ºå‡º String ç±»å‹
  - let s = String::from("hello ")
  - è¿™ç±»å­—ç¬¦ä¸²æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„
  - ä¸ºä»€ä¹ˆ String ç±»å‹çš„å€¼å¯ä»¥ä¿®æ”¹ï¼Œè€Œå­—ç¬¦ä¸²å­—é¢å€¼å´ä¸èƒ½ä¿®æ”¹
    - å› ä¸ºå®ƒä»¬å¤„ç†å†…å­˜çš„æ–¹å¼ä¸åŒ

**å†…å­˜å’Œåˆ†é…**

- å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œåœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“å®ƒçš„å†…å®¹ï¼Œå…¶æ–‡æœ¬å†…å®¹ç›´æ¥è¢«ç¡¬ç¼–ç åˆ°æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶é‡Œ
  - é€Ÿåº¦å¿«ã€é«˜æ•ˆã€‚æ˜¯å› ä¸ºå…¶ä¸å¯å˜æ€§ã€‚
- String ç±»å‹ï¼Œä¸ºäº†æ”¯æŒå¯å˜æ€§ï¼Œéœ€è¦åœ¨ heap ä¸Šåˆ†é…å†…å­˜æ¥ä¿å­˜ç¼–è¯‘æ—¶æœªçŸ¥çš„æ–‡æœ¬å†…å®¹ï¼š

  - æ“ä½œç³»ç»Ÿå¿…é¡»åœ¨è¿è¡Œæ—¶æ¥è¯·æ±‚å†…å­˜
    - è¿™æ­¥é€šè¿‡è°ƒç”¨ String::from æ¥å®ç°
  - å½“ç”¨å®Œ String ä¹‹åï¼Œéœ€è¦ä½¿ç”¨æŸç§æ–¹å¼å°†å†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿ
    - è¿™æ­¥ï¼Œåœ¨æ‹¥æœ‰ GC çš„è¯­è¨€ä¸­ï¼ŒGC ä¼šè·Ÿè¸ªå¹¶æ¸…ç†
    - æ²¡æœ‰ GCï¼Œå°±éœ€è¦æˆ‘ä»¬å»è¯†åˆ«å†…å­˜ä½•æ—¶ä¸å†ä½¿ç”¨ï¼Œå¹¶è°ƒç”¨ä»£ç å°†å®ƒè¿”å›
      - å¦‚æœå¿˜äº†ï¼Œé‚£å°±æµªè´¹å†…å­˜
      - å¦‚æœæå‰åšäº†ï¼Œå˜é‡å°±ä¼šéæ³•
      - å¦‚æœåšäº†ä¸¤æ¬¡ï¼Œä¹Ÿæ˜¯ Bugï¼Œå¿…é¡»ä¸€æ¬¡åˆ†é…å¯¹åº”ä¸€æ¬¡é‡Šæ”¾

- Rust é‡‡ç”¨äº†ä¸åŒçš„æ–¹å¼ï¼šå¯¹äºæŸä¸ªå€¼æ¥è¯´ï¼Œå½“æ‹¥æœ‰å®ƒçš„å˜é‡èµ°å‡ºä½œç”¨èŒƒå›´æ—¶ï¼Œå†…å­˜ä¼šç«‹å³è‡ªåŠ¨çš„äº¤è¿˜ç»™æ“ä½œç³»ç»Ÿ
- drop å‡½æ•°

**å˜é‡å’Œæ•°æ®äº¤äº’çš„æ–¹å¼ï¼šç§»åŠ¨ï¼ˆMoveï¼‰**

- å¤šä¸ªå˜é‡å¯ä»¥ä¸åŒä¸€ä¸ªæ•°æ®ä½¿ç”¨ä¸€ç§ç‹¬ç‰¹çš„æ–¹å¼æ¥äº¤äº’

```rust
let x = 5;
let y = x;
```

- æ•´æ•°æ—¶å·²çŸ¥ä¸”å›ºå®šå¤§å°çš„ç®€å•çš„å€¼ï¼Œè¿™ä¸¤ä¸ª 5 è¢«å‹å€’äº† stack ä¸­

**String ç‰ˆæœ¬**

```rust
let s1 = String::from("hello");
let s2 = s1;
```

- ä¸€ä¸ª String ç”± 3 éƒ¨åˆ†ç»„æˆ

  - ä¸€ä¸ªæŒ‡å‘å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹çš„å†…å­˜çš„æŒ‡é’ˆ
  - ä¸€ä¸ªé•¿åº¦
  - ä¸€ä¸ªå®¹é‡

- ä¸Šé¢è¿™äº›ä¸œè¥¿æ”¾åœ¨ stack ä¸Šã€‚
- å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹çš„éƒ¨åˆ†åœ¨ heap ä¸Š
- é•¿åº¦ lenï¼Œå°±æ˜¯å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹æ‰€éœ€è¦çš„å­—èŠ‚æ•°
- å®¹é‡ capacity æ˜¯æŒ‡ String ä»æ“ä½œç³»ç»Ÿæ€»å…±è·å¾—å†…å­˜çš„æ€»å­—èŠ‚æ•°

- å½“æŠŠ s1 èµ‹ç»™ s2ï¼ŒString çš„æ•°æ®è¢«å¤åˆ¶äº†ä¸€ä»½
  - åœ¨ stack ä¸Šå¤åˆ¶äº†ä¸€ä»½æŒ‡é’ˆã€é•¿åº¦ã€å®¹é‡
  - å¹¶æ²¡æœ‰å¤åˆ¶æŒ‡é’ˆæ‰€æŒ‡å‘çš„ heap ä¸Šçš„æ•°æ®
- å½“å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼ŒRust ä¼šè‡ªåŠ¨è°ƒç”¨ drop å‡½æ•°ï¼Œå¹¶å°†å˜é‡ä½¿ç”¨çš„ heap å†…å­˜é‡Šæ”¾
- å½“ s1ã€s2 ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå®ƒä»¬éƒ½ä¼šå°è¯•é‡Šæ”¾ç›¸åŒçš„å†…å­˜ï¼š

  - äºŒæ¬¡é‡Šæ”¾ï¼ˆdouble freeï¼‰bug

- ä¸ºäº†ä¿è¯å†…å­˜å®‰å…¨ï¼š
  - Rust æ²¡æœ‰å°è¯•å¤åˆ¶è¢«åˆ†é…çš„å†…å­˜
  - Rust è®© s1 å¤±æ•ˆ
    - å½“ s1 ç¦»å¼€ä½œç”¨åŸŸçš„æ—¶å€™ï¼ŒRust ä¸éœ€è¦é‡Šæ”¾ä»»ä½•ä¸œè¥¿
- è¯•è¯•çœ‹å½“ s2 åˆ›å»ºåå†ä½¿ç”¨ s1 æ˜¯ä»€ä¹ˆæ•ˆæœ

```rust
fn main() {
    let s1 = String::from("hello");
    let s2 = s1;
    println!("{}", s1);// æŠ¥é”™ s1 å·²ç»å¤±æ•ˆäº†
}
```

- æµ…æ‹·è´ï¼ˆshallow copyï¼‰
- æ·±æ‹·è´ï¼ˆdeep copyï¼‰
- ä½ ä¹Ÿè®¸ä¼šå°†å¤åˆ¶æŒ‡é’ˆã€é•¿åº¦ã€å®¹é‡è§†ä¸ºæµ…æ‹·è´ï¼Œä½†ç”±äº Rust è®© s1 å¤±æ•ˆäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¸€ä¸ªæ–°çš„æœ¯è¯­ï¼šç§»åŠ¨ï¼ˆMoveï¼‰
- éšå«çš„ä¸€ä¸ªè®¾è®¡åŸåˆ™ï¼šRust ä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®çš„æ·±æ‹·è´
  - å°±è¿è¡Œæ—¶æ€§èƒ½è€Œè¨€ï¼Œä»»ä½•è‡ªåŠ¨èµ‹å€¼çš„æ“ä½œéƒ½æ˜¯å»‰ä»·çš„

**å˜é‡å’Œæ•°æ®äº¤äº’çš„æ–¹å¼ï¼šå…‹éš†ï¼ˆCloneï¼‰**

- å¦‚æœçœŸæƒ³å † heap ä¸Šçš„ String æ•°æ®è¿›è¡Œæ·±åº¦æ‹·è´ï¼Œè€Œä¸ä»…ä»…æ˜¯ stack ä¸Šçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ clone æ–¹æ³•

**Stack ä¸Šçš„æ•°æ®ï¼šå¤åˆ¶**

- Copy traitï¼Œå¯ä»¥ç”¨äºåƒæ•´æ•°è¿™æ ·å®Œå…¨å­˜æ”¾å† stack ä¸Šé¢çš„ç±»å‹
- å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† Copy è¿™ä¸ª traitï¼Œé‚£ä¹ˆæ—§çš„å˜é‡åœ¨èµ‹å€¼åä»ç„¶å¯ç”¨
- å¦‚æœä¸€ä¸ªç±»å‹æˆ–è€…è¯¥ç±»å‹çš„ä¸€éƒ¨åˆ†å®ç° Drop traitï¼Œé‚£ä¹ˆ Rust ä¸å…è®¸è®©å®ƒå†å»å®ç° Copy trait äº†

**ä¸€äº›æ‹¥æœ‰ Copy trait çš„ç±»å‹**

- ä»»ä½•ç®€å•æ ‡é‡çš„ç»„åˆç±»å‹éƒ½å¯ä»¥æ˜¯ Copy çš„
- ä»»ä½•éœ€è¦åˆ†é…å†…å­˜æˆ–æŸç§èµ„æºçš„éƒ½ä¸æ˜¯ Copy çš„
- ä¸€äº›æ‹¥æœ‰ Copy trait çš„ç±»å‹ï¼š
  - æ‰€æœ‰çš„æ•´æ•°ç±»å‹ï¼Œä¾‹å¦‚ u32
  - bool
  - char
  - æ‰€æœ‰çš„æµ®ç‚¹ç±»å‹ï¼Œä¾‹å¦‚ f64
  - Tupleï¼ˆå…ƒç»„ï¼‰ï¼Œå¦‚æœå…¶æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯ Copy çš„
    - (i32,i32) æ˜¯
    - (i32,String) ä¸æ˜¯

### 4.1.3 æ‰€æœ‰æƒä¸å‡½æ•°

- åœ¨è¯­ä¹‰ä¸Šï¼Œå°†å€¼ä¼ é€’ç»™å‡½æ•°å’ŒæŠŠå€¼èµ‹ç»™å˜é‡æ˜¯ç±»ä¼¼çš„ï¼š
  - å°†å€¼ä¼ é€’ç»™å‡½æ•°å°†å‘ç”Ÿç§»åŠ¨æˆ–å¤åˆ¶

```rust
fn main() {
    let s = String::from("Hello World");
    take_ownership(s);// å‡½æ•°æ‰§è¡Œå s å°±æ— æ•ˆäº†
    let x = 5;
    makes_copy(x);
    println!("x:{}", x);
}

fn take_ownership(some_string: String) {
    println!("{}", some_string);
}
fn makes_copy(some_number: i32) {
    println!("{}", some_number);
}
```

**è¿”å›å€¼ä¸ä½œç”¨åŸŸ**

- å‡½æ•°åœ¨è¿”å›å€¼çš„è¿‡ç¨‹ä¸­åŒæ ·ä¹Ÿä¼šå‘ç”Ÿæ‰€æœ‰æƒçš„è½¬ç§»
- ä¸€ä¸ªå˜é‡çš„æ‰€æœ‰æƒæ€»æ˜¯éµå¾ªåŒæ ·çš„æ¨¡å¼ï¼š
  - æŠŠä¸€ä¸ªå€¼èµ‹ç»™å…¶å®ƒå˜é‡æ—¶å°±ä¼šå‘ç”Ÿç§»åŠ¨
  - å½“ä¸€ä¸ªåŒ…å« heap æ•°æ®çš„å˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå®ƒçš„å€¼å°±ä¼šè¢« drop å‡½æ•°æ¸…ç†ï¼Œé™¤éæ•°æ®çš„æ‰€æœ‰æƒç§»åŠ¨åˆ°å¦ä¸€ä¸ªå˜é‡ä¸Š

**å¦‚ä½•è®©å‡½æ•°ä½¿ç”¨æŸä¸ªå€¼ï¼Œä½†ä¸è·å¾—å…¶æ‰€æœ‰æƒï¼Ÿ**

```rust
fn main() {
    let s1 = String::from("hello");
    let (s2, len) = calculate_length(s1);
    println!("The length of '{}' is {}.", s2, len);
}
fn calculate_length(s: String) -> (String, usize) {
    let length = s.len();
    (s, length)
}
```

## 4.2 å¼•ç”¨ä¸å€Ÿç”¨

**ä¾‹å­**

```rust
fn main() {
    let s1 = String::from("Hello");
    let len = calculate_length(&s1);
    println!("The length of '{}' is {}", s1, len);
}
fn calculate_length(s: &String) -> usize {
    s.len()
}
```

- å‚æ•°çš„ç±»å‹æ—¶&String è€Œä¸æ˜¯ String
- &ç¬¦å·å°±è¡¨ç¤ºå¼•ç”¨ï¼šå…è®¸ä½ å¼•ç”¨æŸäº›å€¼è€Œä¸å–å¾—å…¶æ‰€æœ‰æƒ

**å€Ÿç”¨**

- æˆ‘ä»¬æŠŠå¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•°è¿™ä¸ªè¡Œä¸ºå«åšå€Ÿç”¨
- æˆ‘ä»¬ä¸èƒ½ä¿®æ”¹å€Ÿç”¨çš„ä¸œè¥¿
- å’Œå˜é‡ä¸€æ ·ï¼Œé»˜è®¤æ˜¯ä¸å¯å˜çš„

**å¯å˜å¼•ç”¨**

- å¯å˜å¼•ç”¨æœ‰ä¸€ä¸ªé‡è¦çš„é™åˆ¶ï¼šåœ¨ç‰¹å®šä½œç”¨åŸŸå†…ï¼Œå †æŸä¸€å—æ•°æ®ï¼Œåªèƒ½ç”±ä¸€ä¸ªå¯å˜çš„å¼•ç”¨ã€‚
  - è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯åœ¨ç¼–è¯‘æ—¶é˜²æ­¢æ•°æ®ç«äº‰
- ä»¥ä¸‹ä¸‰ç§è¡Œä¸ºä¸‹ä¼šå‘ç”Ÿæ•°æ®ç«äº‰ï¼š
  - ä¸¤ä¸ªæˆ–å¤šä¸ªæŒ‡é’ˆåŒæ—¶è®¿é—®åŒä¸€ä¸ªæ•°æ®
  - è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆç”¨äºå†™å…¥æ•°æ®
  - æ²¡æœ‰ä½¿ç”¨ä»»ä½•æœºåˆ¶æ¥åŒæ­¥å¯¹æ•°æ®çš„è®¿é—®
- å¯ä»¥é€šè¿‡åˆ›å»ºæ–°çš„ä½œç”¨åŸŸï¼Œæ¥å…è®¸éåŒæ—¶çš„åˆ›å»ºå¤šä¸ªå¯å˜å¼• ç”¨ï¼ˆä¾‹å­ï¼‰

```rust
fn main() {
    let mut s = String::from("Hello");
    let s1 = &mut s;
    let s2 = &mut s;// æŠ¥é”™
    println!("The length of '{}' is {}.", s1, s2);
}
fn main() {
    let mut s = String::from("Hello");
    {
        let s1 = &mut s;
    }
    // ä¸æŠ¥é”™
    let s2 = &mut s;
}
```

**å¦ä¸€ä¸ªé™åˆ¶**

- ä¸å¯ä»¥åŒæ—¶æ‹¥æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨å’Œä¸€ä¸ªä¸å˜å¼•ç”¨
- å¤šä¸ªä¸å˜çš„å¼•ç”¨æ˜¯å¯è¡Œçš„

```rust
fn main() {
    let mut s = String::from("Hello");
    let r1 = &s;
    let r2 = &s;
    let s1 = &mut s;// æŠ¥é”™
    println!("{} {} {}", r1, r2, s1);
}
```

## 4.3 åˆ‡ç‰‡

- Rust çš„å¦ä¸€ç§ä¸æŒæœ‰æ‰€æœ‰æƒçš„æ•°æ®ç±»å‹ï¼šåˆ‡ç‰‡ï¼ˆsliceï¼‰
- ä¸€é“é¢˜ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼š
  - å®ƒæ¥æ”¶å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°
  - è¿”å›å®ƒåœ¨è¿™ä¸ªå­—ç¬¦ä¸²é‡Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªçš„é‚£æ¬¡
  - å¦‚æœå‡½æ•°æ²¡æ‰¾åˆ°ä»»ä½•æ§è‚¡ä¸ªï¼Œé‚£ä¹ˆæ•´ä¸ªå­—ç¬¦ä¸²å°±è¢«è¿”å›

```rust
fn main() {
    let mut s = String::from("Hello world");
    let word_index = fitst_world(&s);
    s.clear();
    println!("{}", word_index);
}
fn fitst_world(s: &String) -> usize {
    let bytes = s.as_bytes();
    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return i;
        }
    }
    s.len()
}
```

### å­—ç¬¦ä¸²åˆ‡ç‰‡

- å­—ç¬¦ä¸²åˆ‡ç‰‡æ˜¯æŒ‡å­—ç¬¦ä¸²ä¸­ä¸€éƒ¨åˆ†å†…å®¹çš„å¼•ç”¨
- å½¢å¼ï¼š[å¼€å§‹ç´¢å¼•..ç»“æŸç´¢å¼•]
  - å¼€å§‹ç´¢å¼•å°±æ˜¯åˆ‡ç‰‡èµ·å§‹ä½ç½®çš„ç´¢å¼•å€¼
  - ç»“æŸç´¢å¼•å°±æ˜¯åˆ‡ç‰‡ç»ˆæ­¢ä½ç½®çš„ä¸‹ä¸€ä¸ªç´¢å¼•å€¼

**æ³¨æ„**

- å­—ç¬¦ä¸²åˆ‡ç‰‡çš„è¿”å›ç´¢å¼•å¿…é¡»å‘ç”Ÿåœ¨æœ‰æ•ˆçš„ UTF-8 å­—ç¬¦è¾¹ç•Œå†…ã€‚
- å¦‚æœå°è¯•ä»ä¸€ä¸ªå¤šå­—èŠ‚çš„å­—ç¬¦ä¸­åˆ›å»ºå­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œç¨‹åºä¼šæŠ¥é”™å¹¶é€€å‡º

```rust
fn main() {
    let s = String::from("Hello World");
    // let hello = &s[0..5];
    // let world = &s[6..11];
    // let hello = &s[..5];
    // let world = &s[6..];
    // let world = &s[6..s.len()];
    // println!("{},{}", hello, world);
    // let whole = &s[0..s.len()];
    let whole = &s[..];
    println!("{}", whole);
}
```

**ä½¿ç”¨å­—ç¬¦ä¸²åˆ‡ç‰‡é‡å†™ä¾‹å­**

```rust
fn main() {
    let mut s = String::from("Hello world");
    let word_index = fitst_world(&s);
    s.clear();
    println!("{}", word_index);
}
fn fitst_world(s: &String) -> &str {
    let bytes = s.as_bytes();
    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[..i];
        }
    }
    &s[..]
}
```

#### å­—ç¬¦ä¸²å­—é¢å€¼æ˜¯åˆ‡ç‰‡

- å­—ç¬¦ä¸²å­—é¢å€¼è¢«ç›´æ¥å­˜å‚¨åœ¨äºŒè¿›åˆ¶ç¨‹åºä¸­
- let s = "Hello World"
- å˜é‡ s çš„ç±»å‹æ˜¯&strï¼Œä»–æ˜¯ä¸€ä¸ªæŒ‡å‘äºŒè¿›åˆ¶ç¨‹åºç‰¹å®šä½ç½®çš„åˆ‡ç‰‡
  - &str æ˜¯ä¸å¯å˜å¼•ç”¨ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²å­—é¢å€¼ä¹Ÿæ˜¯ä¸å¯å˜çš„

#### å°†å­—ç¬¦ä¸²åˆ‡ç‰‡ä½œä¸ºå‚æ•°ä¼ é€’

- fn first_word(s:&String)->&str{}
- æœ‰ç»éªŒçš„ Rust å¼€å‘è€…ä¼šé‡‡ç”¨&str ä½œä¸ºå‚æ•°ç±»å‹ï¼Œå› ä¸ºè¿™æ ·å°±å¯ä»¥åŒæ—¶æ¥æ”¶ String å’Œ&str ç±»å‹çš„å‚æ•°äº†ï¼š
- fn first_world(s:&str)->&str {}
  - ä½¿ç”¨å­—ç¬¦ä¸²åˆ‡ç‰‡ï¼Œç›´æ¥è°ƒç”¨è¯¥å‡½æ•°
  - ä½¿ç”¨ Stringï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå®Œæˆ String åˆ‡ç‰‡æ¥è°ƒç”¨è¯¥å‡½æ•°
- å®šä¹‰å‡½æ•°æ—¶ä½¿ç”¨å­—ç¬¦ä¸²åˆ‡ç‰‡æ¥ä»£æ›¿å­—ç¬¦ä¸²å¼•ç”¨ä¼šä½¿æˆ‘ä»¬çš„ API æ›´åŠ é€šç”¨ï¼Œä¸”ä¸ä¼šæŸå¤±ä»»ä½•åŠŸèƒ½ã€‚

```rust
fn main() {
    let my_string = String::from("Hello World");
    let word_index = first_world(&my_string);
    let my_string_literal = "hello world";
    let word_index = first_world(my_string_literal);
}
fn first_world(s: &str) -> &str {
    let bytes = s.as_bytes();
    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' {
            return &s[..i];
        }
    }
    &s[..]
}
```

### å…¶å®ƒç±»å‹çš„åˆ‡ç‰‡

```rust

fn main() {
    let a = [1, 2, 3, 4, 5];
    let slice = &a[1..3];
}
```

## 5.struct

### 5.1 å®šä¹‰å¹¶å®ä¾‹åŒ– struct

**ä»€ä¹ˆæ˜¯ struct**

- structï¼Œç»“æ„ä½“
  - è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹
  - ä¸ºç›¸å…³è”çš„å€¼å‘½åï¼Œæ‰“åŒ… => æœ‰æ„ä¹‰çš„ç»„åˆ

**å®šä¹‰ struct**

- ä½¿ç”¨ **struct** å…³é”®å­—ï¼Œå¹¶æœªæ•´ä¸ª struct å‘½å
- åœ¨èŠ±æ‹¬å·å†…ï¼Œä¸ºæ‰€æœ‰`å­—æ®µï¼ˆFieldï¼‰`å®šä¹‰åç§°å’Œç±»å‹
- ä¾‹å¦‚ï¼š

```rust
struct User {
    username: String,
    email: String,
    sign_in_count: u64,
    active: bool,
}
```

**å®ä¾‹åŒ– struct**

- æƒ³è¦ä½¿ç”¨ structï¼Œéœ€è¦åˆ›å»º struct çš„å®ä¾‹
  - ä¸ºæ¯ä¸ªå­—æ®µæŒ‡å®šå…·ä½“å€¼
  - æ— éœ€æŒ‰å£°æ˜çš„é¡ºåºè¿›è¡ŒæŒ‡å®š
- ä¾‹å­

```rust
let user1 = User {
        email: String::from("chovrio@....."),
        username: String::from("chovrio"),
        sign_in_count: 1,
        active: true,
    };
```

### 5.2 struct ä¸­çš„ä¾‹å­

**å–å¾— struct é‡Œé¢çš„æŸä¸ªå€¼**

- ä½¿ç”¨ç‚¹æ ‡è®°æ³•
- user1.email = String::from("Autumn@...")

```rust
let mut user1 = User {
        email: String::from("chovrio@....."),
        username: String::from("chovrio"),
        sign_in_count: 1,
        active: true,
    };
```

- ä¸€æ—¦ struct çš„å®ä¾‹æ˜¯å¯å˜çš„ï¼Œé‚£ä¹ˆå®ä¾‹ä¸­æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯å¯å˜çš„

**struct ä½œä¸ºå‡½æ•°çš„è¿”å›å€¼**

å­—æ®µåŒåå¯ä»¥ç®€åŒ–

```rust
fn build_user(email: String, username: String) -> User {
    User {
        email,
        username,
        active: true,
        sign_in_count: 1,
    }
}
```

**struct æ›´æ–°è¯­æ³•**

- å½“ä½ æƒ³è¦åŸºäºæŸä¸ª struct å®ä¾‹æ¥åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ struct æ›´æ–°è¯­æ³•ï¼š

```rust
let user2 = User {
        email: String::from("AAAA"),
        username: String::from("BBB"),
        ..user1
    };
```

**Tuple struct**

- å¯å®šä¹‰ç±»ä¼¼ tuple çš„ structï¼Œå«åš tuple struct
  - Tuple struct æ•´ä½“æœ‰ä¸ªåï¼Œä½†é‡Œé¢çš„å…ƒç´ æ²¡æœ‰å
  - é€‚ç”¨ï¼šæƒ³ç»™æ•´ä¸ª tuple èµ·åï¼Œå¹¶è®©å®ƒä¸åŒäºå…¶å®ƒ tupleï¼Œè€Œä¸”åˆä¸éœ€è¦ç»™æ¯ä¸ªå…ƒç´ å…¶èµ·å
- å®šä¹‰ tuple structï¼šä½¿ç”¨ struct å…³é”®å­—ï¼Œåè¾¹æ˜¯åå­—ï¼Œä»¥åŠé‡Œé¢å…ƒç´ çš„ç±»å‹
- black å’Œ origin æ˜¯ä¸åŒçš„ç±»å‹ï¼Œæ˜¯ä¸åŒ tuple struct çš„å®ä¾‹ã€‚

**Unit-Like Structï¼ˆæ²¡æœ‰ä»»ä½•å­—æ®µï¼‰**

- å¯ä»¥å®šä¹‰æ²¡æœ‰ä»»ä½•å­—æ®µçš„ structï¼Œå«åš Unit-Like structï¼ˆå› ä¸ºä¸()ï¼Œå•å…ƒç±»å‹ç±»ä¼¼ï¼‰
- é€‚ç”¨äºéœ€è¦åœ¨æŸä¸ªç±»å‹ä¸Šå®ç°æŸä¸ª traitï¼Œä½†æ˜¯åœ¨é‡Œé¢æœ‰æ²¡æœ‰æƒ³è¦å­˜å‚¨çš„æ•°æ®

**struct æ•°æ®çš„æ‰€æœ‰æƒ**

```rust
struct User1 {
    username: String,
    email: String,
    sign_in_count: u64,
    active: bool,
}
```

- è¿™é‡Œçš„å­—æ®µä½¿ç”¨äº† String è€Œä¸æ˜¯&strï¼š
  - è¯¥ struct å®ä¾‹æ‹¥æœ‰å…¶æ‰€æœ‰çš„æ•°æ®
  - åªè¦ struct å®ä¾‹æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆé‡Œé¢çš„å­—æ®µä¹Ÿæ˜¯æœ‰æ•ˆçš„
- struct é‡Œä¹Ÿå¯ä»¥å­˜æ”¾å¼•ç”¨ï¼Œä½†è¿™éœ€è¦ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸ -ç”Ÿå‘½å‘¨æœŸä¿è¯åªè¦ struct å®ä¾‹æ˜¯æœ‰æ•ˆçš„ï¼Œé‚£ä¹ˆé‡Œé¢çš„å¼•ç”¨ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚
- å¦‚æœ struct é‡Œé¢å­˜å‚¨å¼•ç”¨ï¼Œè€Œä¸ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸï¼Œå°±ä¼šæŠ¥é”™

```rust
struct User {
    username: &str,// æŠ¥é”™
    email: &str,// æŠ¥é”™
    sign_in_count: u64,
    active: bool,
}

fn main() {
    println!("Hello World");
    let user1 = User {
        email: "aaa",
        username: "bbb",
        active: true,
        sign_in_count: 100,
    };
}
```

**è®¡ç®—çŸ©å½¢é¢ç§¯ä¾‹å­**

**æ™®é€šç‰ˆæœ¬**

```rust
fn main() {
    let w = 30;
    let l = 50;
    println!("{}", area(w, l));
}
fn area(width: u32, length: u32) -> u32 {
    width * length
}
```

**å…ƒç»„ç‰ˆæœ¬**

```rust
fn main() {
    let rect = (30, 50);
    println!("{}", area(rect));
}
fn area(dim: (u32, u32)) -> u32 {
    dim.0 * dim.1
}
```

**ç»“æ„ä½“ç‰ˆæœ¬**

```rust
struct Rectangle {
    width: u32,
    length: u32,
}
fn main() {
    let rect = Rectangle {
        width: 30,
        length: 50,
    };
    println!("{}", area(&rect));
}
fn area(rect: &Rectangle) -> u32 {
    rect.width * rect.length
}
```

### 5.3 struct çš„æ–¹æ³•

#### 5.3.1 å®šä¹‰æ–¹æ³•

- æ–¹æ³•å’Œå‡½æ•°ç±»ä¼¼ï¼šfn å…³é”®å­—ã€åç§°ã€å‚æ•°ã€è¿”å›å€¼
- æ–¹æ³•ä¸å‡½æ•°ä¸åŒä¹‹å¤„
  - æ–¹æ³•æ˜¯åœ¨ structï¼ˆæˆ– enumã€frait å¯¹è±¡ï¼‰çš„ä¸Šä¸‹æ–‡ä¸­å®šä¹‰
  - ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ selfï¼Œè¡¨ç¤ºæ–¹æ³•è¢«è°ƒç”¨çš„ struct å®ä¾‹
- åœ¨ impl å—é‡Œå®šä¹‰æ–¹æ³•
- æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥æ˜¯&selfï¼Œä¹Ÿå¯ä»¥è·å¾—å…¶æ‰€æœ‰æƒæˆ–å¯å˜å€Ÿç”¨ã€‚å’Œå…¶å®ƒå‚æ•°ä¸€æ ·ã€‚
- æ›´è‰¯å¥½çš„ä»£ç ç»„ç»‡

```rust
#[derive(Debug)]
struct Rectangle {
    width: u32,
    length: u32,
}
impl Rectangle {
    fn area(&self) -> u32 {
        self.width * self.length
    }
}
fn main() {
    let rect = Rectangle {
        width: 30,
        length: 50,
    };
    println!("{}", rect.area());
}
```

#### 5.3.2 æ–¹æ³•è°ƒç”¨çš„è¿ç®—ç¬¦

- C/C++ï¼šobject->something()å’Œ(\*object.something()ä¸€æ ·
- Rust æ²¡æœ‰ -> è¿ç®—ç¬¦
- Rust ä¼šè‡ªåŠ¨å¼•ç”¨æˆ–è§£å¼•ç”¨
  - åœ¨è°ƒç”¨æ–¹æ³•æ—¶ï¼ŒRust æ ¹æ®æƒ…å†µè‡ªåŠ¨æ·»åŠ &ã€&mut æˆ–\*ï¼Œä»¥ä¾¿ object å¯ä»¥åŒ¹é…æ–¹æ³•çš„ç­¾åã€‚
- ä¸‹é¢ä¸¤è¡Œä»£ç æ•ˆæœç›¸åŒï¼š
  - p1.distance(&p2);
  - (&p1).distance(&p2)

#### 5.3.3 æ–¹æ³•å‚æ•°

- æ–¹æ³•å¯ä»¥æœ‰å¤šä¸ªå‚æ•°

```rust
#[derive(Debug)]
struct Rectangle {
   width: u32,
   length: u32,
}
impl Rectangle {
   fn can_hold(&self, other: &Rectangle) -> bool {
       self.width > other.width && self.length > other.length
   }
}
fn main() {
   let rect1 = Rectangle {
       width: 30,
       length: 50,
   };
   let rect2 = Rectangle {
       width: 10,
       length: 40,
   };
   let rect3 = Rectangle {
       width: 35,
       length: 55,
   };
   println!("{}", rect1.can_hold(&rect2)); // true
   println!("{}", rect2.can_hold(&rect3)); // false
}
```

#### 5.3.4 å…³è”å‡½æ•°

- å¯ä»¥åœ¨ impl å—é‡Œå®šä¹‰ä¸æŠŠ self ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå®ƒä»¬å«å…³è”å‡½æ•°ï¼ˆä¸å«æ–¹æ³•ï¼‰
  - ä¾‹å¦‚ï¼šString::from()
- å…³è”å‡½æ•°é€šå¸¸ç”¨äºæ„é€ å™¨ï¼ˆä¾‹å­ï¼‰
- ::ç¬¦å·
  - å…³è”å‡½æ•°
  - æ¨¡å—åˆ›å»ºçš„å‘½åç©ºé—´

#### 5.3.5 å¤šä¸ª impl å—

- æ¯ä¸ª struct å…è®¸æ‹¥æœ‰å¤šä¸ª impl å—ï¼ˆä¾‹å­ï¼‰

## 6.æšä¸¾ä¸æ¨¡å¼åŒ¹é…

- æšä¸¾å…è®¸æˆ‘ä»¬åˆ—ä¸¾æ‰€æœ‰å¯èƒ½çš„å€¼æ¥å®šä¹‰ä¸€ä¸ªç±»å‹

### 6.1 å®šä¹‰æšä¸¾

- IP åœ°å€ï¼šIPv4ã€IPv6

```rust
enum ip_addrkind {
  V4,
  V6
}
```

#### 6.1.1 æšä¸¾å€¼

- ä¾‹å­ï¼š
- let four = ip_addrkind::V4;
- let six = ip_addrkind::V6;

**å°†æ•°æ®é™„åŠ åˆ°æšä¸¾çš„å˜ä½“ä¸­**

```rust
enum IpAddr {
  V4(String),
  V6(String),
}
```

- ä¼˜ç‚¹ï¼š
  - ä¸éœ€è¦é¢å¤–ä½¿ç”¨ struct
  - æ¯ä¸ªå˜ä½“å¯ä»¥æ‹¥æœ‰ä¸åŒçš„ç±»å‹ä»¥åŠå…³è”çš„æ•°æ®é‡
- ä¾‹å¦‚ï¼š

```rust
enum IpAddrKind  {
  V4(u8,u8,u8,u8),
  V6(String)
}
```

### 6.1.2 æ ‡å‡†åº“ä¸­çš„ IpAddr

```rust
struct Ipv4Addr {
    // --snip--
}
struct Ipv6Addr {
    // --snip--
}
enum IpAddr {
    V4(Ipv4Addr),
    V6(Ipv6Addr),
}
enum Message {
    Quit,
    Move { x: i32, y: i32 },
    Write(String),
    ChangeColor(i32, i32, i32),
}

fn main() {
    let q = Message::Quit;
    let m = Message::Move { x: 12, y: 24 };
    let w = Message::Write(String::from("Hello"));
    let c = Message::ChangeColor(0, 255, 255);
}
```

### 6.1.3 ä¸ºæšä¸¾å®šä¹‰æ–¹æ³•

åŒæ ·ä½¿ç”¨ `impl`

```rust
impl Message {
   fn call(&self) {}
}
```

### 6.2 Option æšä¸¾

- å®šä¹‰äºæ ‡å‡†åº“ä¸­
- åœ¨ Preludeï¼ˆé¢„å¯¼å…¥æ¨¡å—ï¼‰ä¸­
- æè¿°äº†ï¼šæŸä¸ªå€¼å¯èƒ½å­˜åœ¨ï¼ˆæŸç§ç±»å‹ï¼‰æˆ–ä¸å­˜åœ¨çš„æƒ…å†µ

#### 6.2.1 Rust æ²¡æœ‰ Null

- å…¶å®ƒè¯­è¨€ä¸­ï¼š
  - Null æ˜¯ä¸€ä¸ªå€¼ï¼Œå®ƒè¡¨ç¤ºâ€œæ²¡æœ‰å€¼â€
  - ä¸€ä¸ªå˜é‡å¯ä»¥å¤„äºä¸¤ç§çŠ¶æ€ï¼šç©ºå€¼ï¼ˆnullï¼‰ã€éç©º
- Null å¼•ç”¨ï¼šBillion Dollar Mistake
- Null çš„é—®é¢˜åœ¨äºï¼šå½“ä½ å°è¯•ä½¿ç”¨é Null å€¼é‚£æ ·ä½¿ç”¨ Null å€¼çš„æ—¶å€™ï¼Œå°±ä¼šå¼•èµ·æŸç§é”™è¯¯
- Null çš„æ¦‚å¿µè¿˜æ˜¯æœ‰ç”¨çš„ï¼šå› æŸç§åŸå› è€Œå˜ä¸ºæ— æ•ˆæˆ–ç¼ºå¤±çš„å€¼

#### 6.2.2 Rust ä¸­ç±»ä¼¼ Null æ¦‚å¿µçš„æšä¸¾ - `Option<T>`

- æ ‡å‡†åº“ä¸­çš„å®šä¹‰

```rust
enum Option<T> {
  Some(T),
  None,
}
```

- å®ƒåŒ…å«åœ¨ Preludeï¼ˆé¢„å¯¼å…¥æ¨¡å—ï¼‰ä¸­ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š

  - `Option<T>`
  - Some(T)
  - None

- ä¾‹å­

```rust
let some_number = Some(5);
    let some_string = Some("A String");
    let absent_number: Option<i32> = None;
```

#### `Option<T>`æ¯” Null å¥½åœ¨å“ªï¼Ÿ

- `Option<T>`å’Œ`T`æ˜¯ä¸åŒçš„ç±»å‹ï¼Œä¸å¯ä»¥æŠŠ`Option<T>`ç›´æ¥å½“æˆ`T`
- è‹¥æƒ³ä½¿ç”¨`Option<T>`ä¸­çš„`T`ï¼Œå¿…é¡»å°†å®ƒè½¬ä¸º`T`
- è€Œåœ¨ C#ä¸­ï¼š
  - string a = null;
  - string b = a + "123456";

### 6.3 æ§åˆ¶æµè¿ç®—ç¬¦ - match

#### 6.3.1 å¼ºå¤§çš„æ§åˆ¶æµè¿ç®—ç¬¦ - match

- å…è®¸ä¸€ä¸ªå€¼ä¸ä¸€ç³»åˆ—æ¨¡å¼è¿›è¡ŒåŒ¹é…ï¼Œå¹¶æ‰§è¡ŒåŒ¹é…çš„æ¨¡å¼å¯¹åº”çš„ä»£ç 
- æ¨¡å¼å¯ä»¥æ˜¯å­—é¢å€¼ã€å˜é‡ã€é€šé…ç¬¦...

#### 6.3.2 ç»‘å®šå€¼çš„æ¨¡å¼

- åŒ¹é…çš„åˆ†æ”¯å¯ä»¥ç»‘å®šåˆ°è¢«åŒ¹é…å¯¹è±¡çš„éƒ¨åˆ†å€¼
  - å› æ­¤ï¼Œå¯ä»¥ä» enum å˜ä½“ä¸­æå–å€¼

```rust
#[derive(Debug)]
enum UsState {
    Alabame,
    Alaska,
}

enum Coin {
    Penny,
    Nickel,
    Dime,
    Quarter(UsState),
}
fn value_in_cents(coin: Coin) -> u8 {
    match coin {
        Coin::Penny => 1,
        Coin::Nickel => 5,
        Coin::Dime => 10,
        Coin::Quarter(state) => {
            println!("State quarter from {:?}", state);
            25
        }
    }
}
fn main() {
    let c = Coin::Quarter(UsState::Alaska);
    println!("{}", value_in_cents(c));
}
```

#### 6.3.3 åŒ¹é…`Option<T>`

**æ³¨æ„ match åŒ¹é…å¿…é¡»ç©·ä¸¾æ‰€æœ‰çš„å¯èƒ½**

```rust
fn main() {
    let five = Some(5);
    let six = plus_one(five);
    let none = plus_one(None);
}
fn plus_one(x: Option<i32>) -> Option<i32> {
    match x {
        None => None,
        Some(i) => Some(i + 1),
    }
}
```

#### match`_`é€šé…ç¬¦

```rust
fn main() {
    let v = 0u8;
    match v {
        1 => println!("one"),
        3 => println!("three"),
        5 => println!("five"),
        _ => (),
    }
}
```

### 6.4 if let

- å¤„ç†åªå…³å¿ƒä¸€ç§åŒ¹é…è€Œå¿½ç•¥å…¶å®ƒåŒ¹é…çš„æƒ…å†µ
- æ›´å°‘çš„ä»£ç ï¼Œæ›´å°‘çš„ç¼©è¿›ï¼Œæ›´å°‘çš„æ¨¡æ¿ä»£ç 
- æ”¾å¼ƒäº†ç©·ä¸¾çš„å¯èƒ½
- å¯ä»¥æŠŠ if let çœ‹ä½œæ˜¯ match çš„è¯­æ³•ç³–
- æ­é… else

```rust
fn main() {
    let v = Some(0u8);
    match v {
        Some(3) => println!("three"),
        _ => println!("others"),
    }
    if let Some(3) = v {
        println!("three");
    } else {
        println!("others");
    }
}
```

## 7.Packageï¼ŒCrateï¼ŒModule

### 7.1 Packageã€Crateã€å®šä¹‰ Module

#### 7.1.1 Rust çš„ä»£ç ç»„ç»‡

- ä»£ç ç»„ç»‡ä¸»è¦åŒ…æ‹¬ï¼š
  - å“ªäº›ç»†èŠ‚å¯ä»¥æš´éœ²ï¼Œå“ªäº›ç»†èŠ‚æ˜¯ç§æœ‰çš„
  - ä½œç”¨åŸŸå†…å“ªäº›åç§°æœ‰æ•ˆ
  - ...
- æ¨¡å—ç³»ç»Ÿï¼š
  - `Packageï¼ˆåŒ…ï¼‰`ï¼šCargo çš„ç‰¹æ€§ï¼Œè®©ä½ æ„å»ºã€æµ‹è¯•ã€å…±äº« crate
  - `Crateï¼ˆå•å…ƒåŒ…ï¼‰`ï¼šä¸€ä¸ªæ¨¡å—æ ‘ï¼Œå®ƒå¯äº§ç”Ÿä¸€ä¸ª library æˆ–å¯æ‰§è¡Œæ–‡ä»¶
  - `Moduleï¼ˆæ¨¡å—ï¼‰`ã€useï¼šè®©ä½ æ§åˆ¶ä»£ç çš„ç»„ç»‡ã€ä½œç”¨åŸŸã€ç§æœ‰è·¯å¾„
  - `Pathï¼ˆè·¯å¾„ï¼‰`ï¼šä¸º structã€function æˆ– module ç­‰é¡¹å‘½åçš„æ–¹å¼

#### 7.1.2 Package å’Œ Crate

- **Crate** çš„ç±»å‹ï¼š
  - **binary**ï¼ˆäºŒè¿›åˆ¶ï¼‰
  - **library**ï¼ˆåº“ï¼‰
- **Crate Root**ï¼š
  - æ˜¯æºä»£ç æ–‡ä»¶
  - Rust ç¼–è¯‘å™¨ä»è¿™é‡Œå¼€å§‹ï¼Œç»„æˆä½ çš„ Crate çš„æ ¹ Module
- ä¸€ä¸ª**Package**ï¼š
  - åŒ…å« 1 ä¸ª Cargo.tomlï¼Œå®ƒæè¿°äº†å¦‚ä½•æ„å»ºè¿™äº› Crates
  - åªèƒ½åŒ…å« 0-1 ä¸ª library crate
  - å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„ binary crate

#### 7.1.3 Cargo çš„æƒ¯ä¾‹

- src/main.rs:
  - binary crate çš„ crate root
  - crate åä¸ package åç›¸åŒ
- src/lib.rsï¼š
  - package åŒ…å«ä¸€ä¸ª library crate
  - library crate çš„ crate root
  - crate åä¸ package åç›¸åŒ
- Cargo æŠŠ crate root æ–‡ä»¶äº¤ç»™ rustc æ¥æ„å»º library æˆ– binary
- ä¸€ä¸ª Package å¯ä»¥åŒæ—¶åŒ…å« src/main.rs å’Œ src/lib.rs
  - ä¸€ä¸ª binary createï¼Œä¸€ä¸ª library create
  - åç§°ä¸ package åç›¸åŒ
- ä¸€ä¸ª Package å¯ä»¥æœ‰å¤šä¸ª binary crateï¼š
  - æ–‡ä»¶æ”¾åœ¨ï¼šsrc/bin
  - æ¯ä¸ªæ–‡ä»¶æ˜¯å•ç‹¬çš„ binary crate

#### 7.1.4 Crate çš„ä½œç”¨

- å°†ç›¸å…³åŠŸèƒ½ç»„åˆåˆ°ä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œä¾¿äºåœ¨é¡¹ç›®å°†è¿›è¡Œå…±äº«
  - é˜²æ­¢å†²çª
- ä¾‹å¦‚ rand crateï¼Œè®¿é—®å®ƒçš„åŠŸèƒ½éœ€è¦é€šè¿‡å®ƒçš„åå­—ï¼šrand

#### 7.1.5 å®šä¹‰ module æ¥æ§åˆ¶ä½œç”¨åŸŸå’Œç§æœ‰æ€§

- Moduleï¼š
  - åœ¨ä¸€ä¸ª crate å†…ï¼Œå°†ä»£ç è¿›è¡Œåˆ†ç»„
  - å¢åŠ å¯è¯»æ€§ï¼Œæ˜“äºå¤ç”¨
  - æ§åˆ¶é¡¹ç›®ï¼ˆitemï¼‰çš„ç§æœ‰æ€§ã€‚publicã€private
- å»ºç«‹ module
  - mod å…³é”®å­—
  - å¯åµŒå¥—
  - å¯åŒ…å«å…¶å®ƒé¡¹ï¼ˆstructï¼Œenumï¼Œå¸¸é‡ï¼Œtraitï¼Œå‡½æ•°ç­‰ï¼‰çš„å®šä¹‰
- src/main.rs å’Œ src/lib.rs å«åš crate rootsï¼š
  - è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼ˆä»»æ„ä¸€ä¸ªï¼‰çš„å†…å®¹å½¢æˆäº†åä¸º crate çš„æ¨¡å—ï¼Œä½äºæ•´ä¸ªæ¨¡å—æ ‘çš„æ ¹éƒ¨

```rust
mod front_of_house {
    mod hosting {
        fn add_to_waitlist() {}
        fn seat_at_table() {}
    }
    mod serving {
        fn take_order() {}
        fn serve_order() {}
        fn take_payment() {}
    }
}
```

### 7.2 è·¯å¾„

- ä¸ºäº†åœ¨ Rust çš„æ¨¡å—ä¸­æ‰¾åˆ°æŸä¸ªæ¡ç›®ï¼Œéœ€è¦ä½¿ç”¨`è·¯å¾„`ã€‚
- è·¯å¾„çš„ä¸¤ç§å½¢å¼ï¼š
  - ç»å¯¹è·¯å¾„ï¼šä» crate root å¼€å§‹ï¼Œä½¿ç”¨ crate åæˆ–å­—é¢å€¼ crate
  - ç›¸å¯¹è·¯å¾„ï¼šä»å½“å‰æ¨¡å—å¼€å§‹ï¼Œä½¿ç”¨ selfï¼Œsuper æˆ–å½“å‰æ¨¡å—çš„æ ‡è¯†ç¬¦
- è·¯å¾„è‡³å°‘ç”±ä¸€ä¸ªæ ‡è¯†ç¬¦ç»„æˆï¼Œæ ‡è¯†ç¬¦ä¹‹é—´ä½¿ç”¨::ã€‚

#### 7.2.1 ç§æœ‰è¾¹ç•Œï¼ˆprivacy boundaryï¼‰

- æ¨¡å—ä¸ä»…å¯ä»¥ç»„ç»‡ä»£ç ï¼Œè¿˜å¯ä»¥å®šä¹‰ç§æœ‰è¾¹ç•Œã€‚
- å¦‚æœæƒ³æŠŠå‡½æ•°æˆ– struct ç­‰è®¾ä¸ºç§æœ‰ï¼Œå¯ä»¥å°†å®ƒæ”¾åœ¨æŸä¸ªæ¨¡å—ä¸­ã€‚
- Rust ä¸­æ‰€æœ‰çš„æ¡ç›®ï¼ˆå‡½æ•°ï¼Œæ–¹æ³•ï¼Œstructï¼Œenumï¼Œæ¨¡å—ï¼Œå¸¸é‡ï¼‰é»˜è®¤æ˜¯ç§æœ‰çš„
- çˆ¶çº§æ¨¡å—æ— æ³•è®¿é—®å­æ¨¡å—ä¸­çš„ç§æœ‰æ¡ç›®
- å­æ¨¡å—é‡Œå¯ä»¥ä½¿ç”¨æ‰€æœ‰ç¥–å…ˆæ¨¡å—ä¸­çš„æ¡ç›®

#### 7.2.1 pub å…³é”®å­—

- ä½¿ç”¨ pub å…³é”®å­—æ¥å°†æŸäº›æ¡ç›®æ ‡è®°ä¸ºå…¬å…±çš„

```rust
mod front_of_house {
    pub mod hosting {
        pub fn add_to_waitlist() {}
    }
}
pub fn eat_at_restaurant() {
    crate::front_of_house::hosting::add_to_waitlist();
    front_of_house::hosting::add_to_waitlist();
}
```

#### 7.2.2 super å…³é”®å­—

- `super`:ç”¨æ¥è®¿é—®çˆ¶çº§æ¨¡å—è·¯å¾„ä¸­çš„å†…å®¹ï¼Œç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿä¸­çš„..

```rust
fn serve_order() {}
mod back_of_house {
    use crate::cook_order;

    fn fix_incorrect_order() {
        cook_order();
        super::serve_order(); // ç›¸å¯¹
        crate::serve_order(); // ç»å¯¹
    }
}
fn cook_order() {}
```

#### 7.2.3 pub struct å…³é”®å­—

- pub æ”¾åœ¨ struct å‰ï¼š
  - struct æ˜¯å…¬å…±çš„
  - struct çš„å­—æ®µé»˜è®¤æ˜¯ç§æœ‰çš„
- struct çš„å­—æ®µéœ€è¦å•ç‹¬è®¾ç½® pub æ¥å˜æˆå…±æœ‰

```rust
mod back_of_house {
    pub struct BreakFast {
        pub toast: String,
        seasonal_fruit: String,
    }
    impl BreakFast {
        pub fn summer(toast: &str) -> BreakFast {
            BreakFast {
                toast: String::from(toast),
                seasonal_fruit: String::from("peaches"),
            }
        }
    }
}
pub fn eat_at_restaurant() {
    let mut meal = back_of_house::BreakFast::summer("Rye");
    meal.toast= String::from("Wheat");
    println!("I'd like {} toast please", meal.toast);
    meal.seasonal_fruit = String::from("blueberries");// æŠ¥é”™
}
```

#### 7.2.4 pub enum

- pub æ”¾åœ¨ enum å‰ :
  - enum æ˜¯`å…¬å…±`çš„
  - enum çš„å˜ä½“ä¹Ÿéƒ½æ˜¯`å…¬å…±`çš„

### 7.3 use å…³é”®å­—

- å¯ä»¥ä½¿ç”¨`use`å…³é”®å­—å°†è·¯å¾„å¯¼å…¥åˆ°ä½œç”¨åŸŸå†…
  - ä»éµå¾ªç§æœ‰æ€§è§„åˆ™
- ä½¿ç”¨ use æ¥æŒ‡å®šç›¸å¯¹è·¯å¾„

#### 7.3.1 use çš„ä¹ æƒ¯ç”¨æ³•

- å‡½æ•°ï¼šå°†å‡½æ•°çš„çˆ¶çº§æ¨¡å—å¼•å…¥ä½œç”¨åŸŸï¼ˆæŒ‡å®šåˆ°çˆ¶çº§ï¼‰
- structï¼Œenumï¼Œå…¶å®ƒï¼šæŒ‡å®šå®Œæ•´è·¯å¾„ï¼ˆæŒ‡å®šåˆ°æœ¬èº«ï¼‰
- åŒåæ¡ç›®ï¼šæŒ‡å®šåˆ°çˆ¶çº§

#### 7.3.2 ä½¿ç”¨ pub use é‡æ–°å¯¼å…¥åç§°

- ä½¿ç”¨ use å°†è·¯å¾„ï¼ˆåç§°ï¼‰å¯¼å…¥åˆ°ä½œç”¨åŸŸå†…åï¼Œè¯¥åç§°åœ¨æ­¤ä½œç”¨åŸŸå†…æ˜¯`ç§æœ‰`çš„
- pub useï¼šé‡å¯¼å‡º
  - å°†æ¡ç›®å¼•å…¥ä½œç”¨åŸŸ
  - è¯¥æ¡ç›®å¯ä»¥è¢«å¤–éƒ¨ä»£ç å¼•å…¥åˆ°å®ƒä»¬çš„ä½œç”¨åŸŸ

#### 7.3.3 ä½¿ç”¨å¤–éƒ¨åŒ…ï¼ˆpackageï¼‰

1. Cargo.toml æ·»åŠ ä¾èµ–çš„åŒ…ï¼ˆpackageï¼‰

- https://crates.io/

2. use å°†ç‰¹å®šæ¡ç›®å¼•å…¥ä½œç”¨åŸŸ

- æ ‡å‡†åº“ï¼ˆstdï¼‰ä¹Ÿè¢«å½“åšå¤–éƒ¨åŒ…
  - ä¸éœ€è¦ä¿®æ”¹ Cargo.toml æ–‡ä»¶æ¥åŒ…å« std
  - éœ€è¦ä½¿ç”¨ use å°† std ä¸­çš„ç‰¹å®šæ¡ç›®å¼•å…¥å½“å‰ä½œç”¨åŸŸ

#### 7.3.4 ä½¿ç”¨`åµŒå¥—è·¯å¾„`æ¸…ç†å¤§é‡çš„ use è¯­å¥

- å¦‚æœä½¿ç”¨åŒä¸€ä¸ªåŒ…æˆ–æ¨¡å—ä¸‹çš„å¤šä¸ªæ¡ç›®ï¼ˆä¾‹å­ï¼‰
- å¯ä»¥ä½¿ç”¨åµŒå¥—è·¯å¾„åœ¨åŒä¸€è¡Œå†…å°†ä¸Šè¿°æ¡ç›®è¿›è¡Œå¼•å…¥ï¼š
  - è·¯å¾„ç›¸åŒçš„éƒ¨åˆ†::{è·¯å¾„å·®å¼‚çš„éƒ¨åˆ†}

```rust
use std::cmp::Ordering;
use std::io;
use std::{cmp::Ordering, io};
use std::io::{self,Write}
```

#### 7.3.5 é€šé…ç¬¦\*

- ä½¿ç”¨\*å¯ä»¥æŠŠè·¯å¾„ä¸­æ‰€æœ‰çš„å…¬å…±æ¡ç›®éƒ½å¼•å…¥åˆ°ä½œç”¨åŸŸ

```rust
use std::collections::*;
```

- æ³¨æ„ï¼šè°¨æ…ä½¿ç”¨
- å¼•ç”¨åœºæ™¯ï¼š
  - æµ‹è¯•ï¼Œå°†æ‰€æœ‰è¢«æµ‹è¯•ä»£ç å¼•å…¥ tests æ¨¡å—
  - æœ‰æ—¶è¢«ç”¨äºé¢„å¯¼å…¥ï¼ˆpreludeï¼‰æ¨¡å—

### 7.4 å°†æ¨¡å—æ‹†åˆ†ä¸ºä¸åŒæ–‡ä»¶

#### 7.4.1 å°†æ¨¡å—å†…å®¹ç§»åŠ¨åˆ°å…¶å®ƒæ–‡ä»¶

- æ¨¡å—å®šä¹‰æ—¶ï¼Œå¦‚æœæ¨¡å—ååè¾¹æ˜¯â€œ;â€ï¼Œè€Œä¸æ˜¯ä»£ç å—ï¼š
  - Rust ä¼šä»ä¸æ¨¡å—åŒåçš„æ–‡ä»¶ä¸­åŠ è½½å†…å®¹
  - æ¨¡å—æ ‘çš„ç»“æ„ä¸ä¼šå‘ç”Ÿå˜åŒ–
- éšç€æ¨¡å—é€æ¸å˜å¤§ï¼Œè¯¥æŠ€æœ¯è®©ä½ å¯ä»¥æŠŠæ¨¡å—çš„å†…å®¹ç§»åŠ¨åˆ°å…¶å®ƒæ–‡ä»¶ä¸­
